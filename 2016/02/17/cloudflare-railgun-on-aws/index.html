<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.15.1 by Michael Rose
  Copyright 2013-2019 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>CloudFlare Railgun on AWS - Edge Cloud</title>
<meta name="description" content="Instructions for configuring a highly available CloudFlare Railgun setup within Amazon Web Services (AWS), using ElastiCache, AutoScaling and Elastic Load Balancing (ELB).">


  <meta name="author" content="Christian Elsen">


<meta property="og:type" content="article">
<meta property="og:locale" content="en_US">
<meta property="og:site_name" content="Edge Cloud">
<meta property="og:title" content="CloudFlare Railgun on AWS">
<meta property="og:url" content="https://www.edge-cloud.net/2016/02/17/cloudflare-railgun-on-aws/">

<meta property="og:description" content="Instructions for configuring a highly available CloudFlare Railgun setup within Amazon Web Services (AWS), using ElastiCache, AutoScaling and Elastic Load Balancing (ELB).">


<meta property="og:image" content="https://www.edge-cloud.net/assets/images/og-image.jpg">



<meta name="twitter:site" content="@ChristianElsen">
<meta name="twitter:title" content="CloudFlare Railgun on AWS">
<meta name="twitter:description" content="Instructions for configuring a highly available CloudFlare Railgun setup within Amazon Web Services (AWS), using ElastiCache, AutoScaling and Elastic Load Balancing (ELB).">
<meta name="twitter:url" content="https://www.edge-cloud.net/2016/02/17/cloudflare-railgun-on-aws/">
<meta name="twitter:card" content="summary">

<meta name="twitter:image" content="https://www.edge-cloud.net/assets/images/og-image.jpg">




<meta property="article:published_time" content="2016-02-17T00:00:51-08:00">







<link rel="canonical" href="https://www.edge-cloud.net/2016/02/17/cloudflare-railgun-on-aws/">





  <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "Organization",
      "url": "https://www.edge-cloud.net",
      "logo": "https://www.edge-cloud.net/assets/images/og-image.jpg"
    }
  </script>



  <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "Person",
      "name": "Christian Elsen",
      "url": "https://www.edge-cloud.net",
      "sameAs": ["https://twitter.com/ChristianElsen","https://www.linkedin.com/in/christianelsen/"]
    }
  </script>



  <meta name="google-site-verification" content="ZPKuOb9ie7OuRgxLoRK2REKxFW6bC0_7VaNFcTNQQxM" />





<!-- end _includes/seo.html -->


<link href="/feed.xml" type="application/atom+xml" rel="alternate" title="Edge Cloud Feed">

<!-- https://t.co/dKP3o1e -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">

<!--[if IE ]>
  <style>
    /* old IE unsupported flexbox fixes */
    .greedy-nav .site-title {
      padding-right: 3em;
    }
    .greedy-nav button {
      position: absolute;
      top: 0;
      right: 0;
      height: 100%;
    }
  </style>
<![endif]-->



    <!-- start custom head snippets -->

<!-- insert favicons. use https://realfavicongenerator.net/ -->
<link rel="apple-touch-icon" sizes="180x180" href="/assets/images/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/assets/images/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/assets/images/favicon-16x16.png">
<link rel="manifest" href="/assets/images/site.webmanifest">
<link rel="mask-icon" href="/assets/images/safari-pinned-tab.svg" color="#5bbad5">
<link rel="shortcut icon" href="/assets/images/favicon.ico">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="msapplication-config" content="/assets/images/browserconfig.xml">
<meta name="theme-color" content="#ffffff">

<link rel="preload" href="/assets/js/main.min.js" as="script">
<link rel="preload" href="/assets/js/lazysizes.min.js" as="script">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.3.3/dist/instantsearch.min.js" as="script">

<link rel="preload" href="/assets/css/main.css" as="style">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.3.3/dist/instantsearch.min.css" as="style">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.3.3/dist/instantsearch-theme-algolia.min.css" as="style">

<link rel="dns-prefetch" href="https://www.google-analytics.com">
<link rel="dns-prefetch" href="https://googleads.g.doubleclick.net">
<link rel="dns-prefetch" href="https://pagead2.googlesyndication.com">
<link rel="dns-prefetch" href="https://adservice.google.com">
<link rel="dns-prefetch" href="http://5xvqigedj8-dsn.algolia.net">

<link rel="preconnnect" href="https://www.google-analytics.com">
<link rel="preconnnect" href="https://googleads.g.doubleclick.net">
<link rel="preconnnect" href="https://pagead2.googlesyndication.com">
<link rel="preconnnect" href="https://adservice.google.com">
<link rel="preconnnect" href="https://5xvqigedj8-dsn.algolia.net">

<!-- end custom head snippets -->

  </head>

  <body class="layout--single">

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->

    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        
          <a class="site-logo webfeedsFeaturedVisual" href="/"><img src="/assets/images/edgecloud.png" alt="Edge Cloud"></a>
        
        <a class="site-title" href="/"> On the edge of cloud computing</a>
        <ul class="visible-links">
<li class="masthead__menu-item">
              <a href="/">Home</a>
            </li>
<li class="masthead__menu-item">
              <a href="/tags/#aws">AWS</a>
            </li>
<li class="masthead__menu-item">
              <a href="/tags/#ipv6">IPv6</a>
            </li>
<li class="masthead__menu-item">
              <a href="/tags/">Tags</a>
            </li>
<li class="masthead__menu-item">
              <a href="/about/">About</a>
            </li>
</ul>
        
        <button class="search__toggle" type="button">
          <span class="visually-hidden">Toggle search</span>
          <svg class="icon" width="16" height="16" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 15.99 16">
            <path d="M15.5,13.12L13.19,10.8a1.69,1.69,0,0,0-1.28-.55l-0.06-.06A6.5,6.5,0,0,0,5.77,0,6.5,6.5,0,0,0,2.46,11.59a6.47,6.47,0,0,0,7.74.26l0.05,0.05a1.65,1.65,0,0,0,.5,1.24l2.38,2.38A1.68,1.68,0,0,0,15.5,13.12ZM6.4,2A4.41,4.41,0,1,1,2,6.4,4.43,4.43,0,0,1,6.4,2Z" transform="translate(-.01)"></path>
          </svg>
        </button>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Toggle menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


    <div class="initial-content">
      



<div id="main" role="main">
  
  <div class="sidebar sticky">
  


<div itemscope itemtype="https://schema.org/Person">

  
    <div class="author__avatar">
      

      
        <img src="/assets/images/chriselsen.jpg" alt="Christian Elsen" itemprop="image">
      
    </div>
  

  <div class="author__content">
    
      <h3 class="author__name" itemprop="name">Christian Elsen</h3>
    
    
      <p class="author__bio" itemprop="description">
        Technology Generalist
      </p>
    
  </div>

  <div class="author__urls-wrapper">
    <button class="btn btn--inverse">Follow</button>
    <ul class="author__urls social-icons">
      
        <li itemprop="homeLocation" itemscope itemtype="https://schema.org/Place">
          <i class="fas fa-fw fa-map-marker-alt" aria-hidden="true"></i> <span itemprop="name">San Francisco, CA</span>
        </li>
      

      
        
          
            <li><a href="https://chris.elsen.xyz" rel="noopener noreferrer" target="_blank"><i class="fas fa-fw fa-link" aria-hidden="true"></i> Website</a></li>
          
        
          
            <li><a href="https://twitter.com/ChristianElsen" rel="noopener noreferrer" target="_blank"><i class="fab fa-fw fa-twitter-square" aria-hidden="true"></i> Twitter</a></li>
          
        
          
            <li><a href="https://www.linkedin.com/in/christianelsen/" rel="noopener noreferrer" target="_blank"><i class="fab fa-fw fa-linkedin" aria-hidden="true"></i> LinkedIn</a></li>
          
        
          
            <li><a href="https://github.com/chriselsen/" rel="noopener noreferrer" target="_blank"><i class="fab fa-fw fa-github" aria-hidden="true"></i> GitHub</a></li>
          
        
          
            <li><a href="https://as213151.net/" rel="noopener noreferrer" target="_blank"><i class="fas fa-fw fa-network-wired" aria-hidden="true"></i> AS213151</a></li>
          
        
      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      <!--
  <li>
    <a href="http://link-to-whatever-social-network.com/user/" itemprop="sameAs" rel="nofollow noopener noreferrer">
      <i class="fas fa-fw" aria-hidden="true"></i> Custom Social Profile Link
    </a>
  </li>
-->
    </ul>
  </div>
</div>

  
  </div>


  <article class="page" itemscope itemtype="https://schema.org/CreativeWork">
    <meta itemprop="headline" content="CloudFlare Railgun on AWS">
    <meta itemprop="description" content="Instructions for configuring a highly available CloudFlare Railgun setup within Amazon Web Services (AWS), using ElastiCache, AutoScaling and Elastic Load Balancing (ELB).">
    <meta itemprop="datePublished" content="February 17, 2016">
    

    <div class="page__inner-wrap">
      
        <header>
          <h1 id="page-title" class="page__title" itemprop="headline">CloudFlare Railgun on AWS
</h1>
          
            <p class="page__meta"><i class="far fa-clock" aria-hidden="true"></i> 




  13 minute read
</p>
          
        </header>
      

      <section class="page__content" itemprop="text">
        
          <aside class="sidebar__right ">
            <nav class="toc">
              <header><h4 class="nav__title">
<i class="fas fa-file-alt"></i> On this page</h4></header>
              <ul class="toc__menu">
  <li><a href="#about-cloudflare-railgun">About CloudFlare Railgun</a></li>
  <li>
<a href="#setup-overview">Setup Overview</a>
    <ul>
      <li><a href="#vpc-setup">VPC Setup</a></li>
      <li><a href="#elasticache-setup">ElastiCache Setup</a></li>
      <li><a href="#elastic-load-balancer-elb-setup">Elastic Load Balancer (ELB) Setup</a></li>
      <li><a href="#auto-scaling-setup">Auto Scaling Setup</a></li>
    </ul>
  </li>
  <li><a href="#testing-the-setup">Testing the setup</a></li>
  <li><a href="#summary">Summary</a></li>
</ul>
            </nav>
          </aside>
        
        <p>This tutorial will show you how to configure <a href="https://www.cloudflare.com/website-optimization/railgun/" target="_blank" rel="noopener noreferrer">CloudFlare Railgun</a> within <a href="https://aws.amazon.com/" target="_blank" rel="noopener noreferrer">Amazon Web Services (AWS)</a>. We will leverage <a href="https://aws.amazon.com/elasticache/" target="_blank" rel="noopener noreferrer">Amazon ElastiCache</a> together with <a href="https://aws.amazon.com/elasticloadbalancing/" target="_blank" rel="noopener noreferrer">AWS Elastic Load Balancing</a>, <a href="https://aws.amazon.com/autoscaling/" target="_blank" rel="noopener noreferrer">AWS Auto Scaling</a> and <a href="https://aws.amazon.com/ec2/" target="_blank" rel="noopener noreferrer">Amazon EC2</a> to quickly and simply achieve this goal (See Figure 1).</p>

<figure class="">








<a href="/content/uploads/2016/02/cloudcraft-CloudFlare-Railgun.png" title="Figure 1: CloudFlare Railgun Setup with Amazon Web Services (AWS) " class="image-popup">
<picture>
  <source type="image/webp" data-srcset="        /content/resized/2016/02/cloudcraft-CloudFlare-Railgun-320.webp 320w,         /content/resized/2016/02/cloudcraft-CloudFlare-Railgun-384.webp 384w,         /content/resized/2016/02/cloudcraft-CloudFlare-Railgun-512.webp 512w,         /content/resized/2016/02/cloudcraft-CloudFlare-Railgun-683.webp 683w,         /content/resized/2016/02/cloudcraft-CloudFlare-Railgun-800.webp 800w,         /content/resized/2016/02/cloudcraft-CloudFlare-Railgun-960.webp 960w, " sizes="1400px"></source>
  <source data-srcset="    /content/resized/2016/02/cloudcraft-CloudFlare-Railgun-320.png 320w,     /content/resized/2016/02/cloudcraft-CloudFlare-Railgun-384.png 384w,     /content/resized/2016/02/cloudcraft-CloudFlare-Railgun-512.png 512w,     /content/resized/2016/02/cloudcraft-CloudFlare-Railgun-683.png 683w,     /content/resized/2016/02/cloudcraft-CloudFlare-Railgun-800.png 800w,     /content/resized/2016/02/cloudcraft-CloudFlare-Railgun-960.png 960w, " sizes="1400px"></source>
  <img src="/content/resized/2016/02/cloudcraft-CloudFlare-Railgun-320.png" data-src="/content/uploads/2016/02/cloudcraft-CloudFlare-Railgun.png" class="blur-up lazyautosizes lazyload" alt="Figure 1: CloudFlare Railgun Setup with Amazon Web Services (AWS) ">
</picture>
</a>



  <figcaption>Figure 1: CloudFlare Railgun Setup with Amazon Web Services (AWS)
</figcaption>

</figure>

<p>This setup should especially be appealing to CloudFlare customers, operating their origin servers in one or more Amazon Web Services (AWS) regions, and who want to leverage the power of AWS to compensate automatically against failures of the CloudFlare Railgun Listener application.</p>

<h1 id="about-cloudflare-railgun">About CloudFlare Railgun</h1>

<p><a href="https://www.cloudflare.com/website-optimization/railgun/" target="_blank" rel="noopener noreferrer">CloudFlare Railgun</a> accelerates the connection between each CloudFlare point-of-presence (PoP) and a customer origin server so that requests that cannot be served from the CloudFlare cache are nevertheless served very fast. By leveraging techniques similar to those used in the compression of high-quality video, Railgun compresses previously uncacheable web objects up to 99.6%.</p>

<p>Railgun consists of two software components: the Listener and Sender. The Railgun Listener is installed on a server close to the customer origin server, or in some cases on the origin server itself. It’s a small piece of software that runs on a standard server and services requests from CloudFlare using the encrypted, binary Railgun protocol. Railgun Listener is a single executable whose only dependency is a running Memcache instance. It runs on 64-bit Linux and BSD systems as a daemon.</p>

<p>The Listener requires a single port (TCP/2408) open from the Internet for the Railgun protocol so that CloudFlare PoPs can contact it. And it requires access to the website to be accelerated via HTTP and HTTPS. The website still needs to be accessible over ports TCP/80 and TCP/443 by the CloudFlare PoPs, as a fallback path in case of Railgun experiencing any issues.</p>

<p>Ideally, the Listener would be placed on a server with fast access to the Internet and low latency. Installation is simply a matter of installing via an RPM or .deb file.</p>

<p>Railgun is available for customers with a CloudFlare <a href="https://www.cloudflare.com/plans/" target="_blank" rel="noopener noreferrer">Business</a> or <a href="https://www.cloudflare.com/plans/enterprise/" target="_blank" rel="noopener noreferrer">Enterprise</a> plan or customers hosted with an <a href="https://www.cloudflare.com/partners/view-partners/" target="_blank" rel="noopener noreferrer">Optimized Hosting Partner</a>.</p>

<h1 id="setup-overview">Setup Overview</h1>

<p>As outlined in Figure 1, the setup will consist of the following elements:</p>

<ul>
  <li>
<a href="https://aws.amazon.com/vpc/" target="_blank" rel="noopener noreferrer">Amazon Virtual Private Cloud (VPC)</a>: Provide network isolation with a public subnet to operate the Railgun nodes and a private subnet to operate the Railgun to Memcached connection.</li>
  <li>
<a href="https://aws.amazon.com/elasticache/" target="_blank" rel="noopener noreferrer">Amazon ElastiCache</a>: A managed Memcached cluster to fulfill the Railgun requirements. The cluster can contain one or more nodes.</li>
  <li>
<a href="https://aws.amazon.com/elasticloadbalancing/" target="_blank" rel="noopener noreferrer">AWS Elastic Load Balancing</a>: A managed load balancer to distribute traffic across multiple Railgun instances within the same AWS region.</li>
  <li>
<a href="https://aws.amazon.com/autoscaling/" target="_blank" rel="noopener noreferrer">AWS Auto Scaling</a>: Automatically replace failed Railgun instances.</li>
  <li>
<a href="https://aws.amazon.com/ec2/" target="_blank" rel="noopener noreferrer">Amazon EC2</a>: Run a 64-bit Linux and automatically install the latest version of CloudFlare Railgun.</li>
</ul>

<p>The following sections walk you step-by-step through the setup. In this example we will use a Memcached cluster with 2 nodes, spread across two <a href="http://docs.aws.amazon.com/AWSEC2/latest/UserGuide/using-regions-availability-zones.html" target="_blank" rel="noopener noreferrer">AWS Availability Zones</a>, as well as 2 Railgun nodes, spread across two AWS Availability Zones. While this setup will provide ideal redundancy, it might not suit your direct business needs. Therefore please adapt the setup accordingly.</p>

<h2 id="vpc-setup">VPC Setup</h2>

<p>We will use <a href="https://aws.amazon.com/vpc/" target="_blank" rel="noopener noreferrer">Amazon Virtual Private Cloud (VPC)</a> to provide network isolation. The Railgun nodes will be placed on two public network segments, so that they are reachable from the public Internet and therefore from the CloudFlare PoPs. Two private network segments will be used for traffic between the Railgun nodes and the ElastiCache based Memcached instances.</p>

<p>Two security groups, one for Railgun and one for ElastiCache, will be used to ensure that only valid traffic can reach the nodes.</p>

<p>Let’s get started by creating a VPC of type <strong>VPC with Public and Private Subnets</strong> (See Figure 2).</p>

<figure class="">








<a href="/content/uploads/2016/02/001-VPC01.png" title="Figure 2: VPC with Public and Private Subnets - Step 1 " class="image-popup">
<picture>
  <source width="1048" type="image/webp" data-srcset="        /content/resized/2016/02/001-VPC01-320.webp 320w,         /content/resized/2016/02/001-VPC01-384.webp 384w,         /content/resized/2016/02/001-VPC01-512.webp 512w,         /content/resized/2016/02/001-VPC01-683.webp 683w,         /content/resized/2016/02/001-VPC01-800.webp 800w,         /content/resized/2016/02/001-VPC01-960.webp 960w,  /content/uploads/2016/02/001-VPC01.webp 1048w" sizes="1048px"></source>
  <source width="1048" data-srcset="    /content/resized/2016/02/001-VPC01-320.png 320w,     /content/resized/2016/02/001-VPC01-384.png 384w,     /content/resized/2016/02/001-VPC01-512.png 512w,     /content/resized/2016/02/001-VPC01-683.png 683w,     /content/resized/2016/02/001-VPC01-800.png 800w,     /content/resized/2016/02/001-VPC01-960.png 960w,  /content/uploads/2016/02/001-VPC01.png 1048w" sizes="1048px"></source>
  <img src="/content/resized/2016/02/001-VPC01-320.png" data-src="/content/uploads/2016/02/001-VPC01.png" class="blur-up lazyautosizes lazyload" alt="Figure 2: VPC with Public and Private Subnets - Step 1 ">
</picture>
</a>



  <figcaption>Figure 2: VPC with Public and Private Subnets - Step 1
</figcaption>

</figure>

<p>Choose your preferred IP CIDR block and provide a meaningful VPC name, such as <strong>Railgun-HA</strong>. Consciously pick an Availability Zone for both subnets and include the AZ identifier in the subnet name. This will later help you identify which subnet is used for what purpose and resides in what AZ. For the NAT instance information chose <strong>Use a NAT gateway instead</strong> (see Figure 3).</p>

<figure class="">








<a href="/content/uploads/2016/02/002-VPC02.png" title="Figure 3: VPC with Public and Private Subnets - Step 2 " class="image-popup">
<picture>
  <source width="1159" type="image/webp" data-srcset="        /content/resized/2016/02/002-VPC02-320.webp 320w,         /content/resized/2016/02/002-VPC02-384.webp 384w,         /content/resized/2016/02/002-VPC02-512.webp 512w,         /content/resized/2016/02/002-VPC02-683.webp 683w,         /content/resized/2016/02/002-VPC02-800.webp 800w,         /content/resized/2016/02/002-VPC02-960.webp 960w,  /content/uploads/2016/02/002-VPC02.webp 1159w" sizes="1159px"></source>
  <source width="1159" data-srcset="    /content/resized/2016/02/002-VPC02-320.png 320w,     /content/resized/2016/02/002-VPC02-384.png 384w,     /content/resized/2016/02/002-VPC02-512.png 512w,     /content/resized/2016/02/002-VPC02-683.png 683w,     /content/resized/2016/02/002-VPC02-800.png 800w,     /content/resized/2016/02/002-VPC02-960.png 960w,  /content/uploads/2016/02/002-VPC02.png 1159w" sizes="1159px"></source>
  <img src="/content/resized/2016/02/002-VPC02-320.png" data-src="/content/uploads/2016/02/002-VPC02.png" class="blur-up lazyautosizes lazyload" alt="Figure 3: VPC with Public and Private Subnets - Step 2 ">
</picture>
</a>



  <figcaption>Figure 3: VPC with Public and Private Subnets - Step 2
</figcaption>

</figure>

<p>The VPC template for <em>VPC with Public and Private Subnets</em> will only create a single public and private subnet. But we will want to leverage two public and two private subnets, across two AZ in order to build a true highly available solution. Therefore we now need to create another public and private subnet within the VPC.</p>

<p>Let’s start by creating another public subnet. Pick a different AZ to the one that was selected when creating the VPC. Also try to come up with a pattern for assigning the CIDR blocks. Here I use even numbers for the third octet in case it is a public subnet and uneven numbers in case it is a private subnet (See Figure 4).</p>

<figure class="">








<a href="/content/uploads/2016/02/003-VPC03.png" title="Figure 4: Add another Public subnet " class="image-popup">
<picture>
  <source width="655" type="image/webp" data-srcset="        /content/resized/2016/02/003-VPC03-320.webp 320w,         /content/resized/2016/02/003-VPC03-384.webp 384w,         /content/resized/2016/02/003-VPC03-512.webp 512w,  /content/uploads/2016/02/003-VPC03.webp 655w" sizes="655px"></source>
  <source width="655" data-srcset="    /content/resized/2016/02/003-VPC03-320.png 320w,     /content/resized/2016/02/003-VPC03-384.png 384w,     /content/resized/2016/02/003-VPC03-512.png 512w,  /content/uploads/2016/02/003-VPC03.png 655w" sizes="655px"></source>
  <img src="/content/resized/2016/02/003-VPC03-320.png" data-src="/content/uploads/2016/02/003-VPC03.png" class="blur-up lazyautosizes lazyload" alt="Figure 4: Add another Public subnet ">
</picture>
</a>



  <figcaption>Figure 4: Add another Public subnet
</figcaption>

</figure>

<p>In order to make the newly created subnet a public subnet, you have to change the routing policy, so that the destination 0.0.0.0/0 points to an internet gateway, which is indicated via the target name prefix of <em>igw</em> (See Figure 5).</p>

<figure class="">








<a href="/content/uploads/2016/02/005-VPC05.png" title="Figure 5: Configure the Internet Gateway for the Public Subnet " class="image-popup">
<picture>
  <source width="620" type="image/webp" data-srcset="        /content/resized/2016/02/005-VPC05-320.webp 320w,         /content/resized/2016/02/005-VPC05-384.webp 384w,         /content/resized/2016/02/005-VPC05-512.webp 512w,  /content/uploads/2016/02/005-VPC05.webp 620w" sizes="620px"></source>
  <source width="620" data-srcset="    /content/resized/2016/02/005-VPC05-320.png 320w,     /content/resized/2016/02/005-VPC05-384.png 384w,     /content/resized/2016/02/005-VPC05-512.png 512w,  /content/uploads/2016/02/005-VPC05.png 620w" sizes="620px"></source>
  <img src="/content/resized/2016/02/005-VPC05-320.png" data-src="/content/uploads/2016/02/005-VPC05.png" class="blur-up lazyautosizes lazyload" alt="Figure 5: Configure the Internet Gateway for the Public Subnet ">
</picture>
</a>



  <figcaption>Figure 5: Configure the Internet Gateway for the Public Subnet
</figcaption>

</figure>

<p>Next create another private subnet. Here also pick a different AZ to the one that was selected for the first private subnet when creating the VPC (See Figure 6).</p>

<figure class="">








<a href="/content/uploads/2016/02/004-VPC04.png" title="Figure 6: Add another Private subnet " class="image-popup">
<picture>
  <source width="657" type="image/webp" data-srcset="        /content/resized/2016/02/004-VPC04-320.webp 320w,         /content/resized/2016/02/004-VPC04-384.webp 384w,         /content/resized/2016/02/004-VPC04-512.webp 512w,  /content/uploads/2016/02/004-VPC04.webp 657w" sizes="657px"></source>
  <source width="657" data-srcset="    /content/resized/2016/02/004-VPC04-320.png 320w,     /content/resized/2016/02/004-VPC04-384.png 384w,     /content/resized/2016/02/004-VPC04-512.png 512w,  /content/uploads/2016/02/004-VPC04.png 657w" sizes="657px"></source>
  <img src="/content/resized/2016/02/004-VPC04-320.png" data-src="/content/uploads/2016/02/004-VPC04.png" class="blur-up lazyautosizes lazyload" alt="Figure 6: Add another Private subnet ">
</picture>
</a>



  <figcaption>Figure 6: Add another Private subnet
</figcaption>

</figure>

<p>After successfully creating all the necessary subnets, it’s time to create the security groups. One will be used to allow Railgun traffic and another one will be used to allow Memcached traffic.</p>

<p>Let’s start by creating the Security Group for Memcached traffic (See Figure 7).</p>

<figure class="">








<a href="/content/uploads/2016/02/005-VPC06.png" title="Figure 7: Create a Security Group for Memcached " class="image-popup">
<picture>
  <source width="654" type="image/webp" data-srcset="        /content/resized/2016/02/005-VPC06-320.webp 320w,         /content/resized/2016/02/005-VPC06-384.webp 384w,         /content/resized/2016/02/005-VPC06-512.webp 512w,  /content/uploads/2016/02/005-VPC06.webp 654w" sizes="654px"></source>
  <source width="654" data-srcset="    /content/resized/2016/02/005-VPC06-320.png 320w,     /content/resized/2016/02/005-VPC06-384.png 384w,     /content/resized/2016/02/005-VPC06-512.png 512w,  /content/uploads/2016/02/005-VPC06.png 654w" sizes="654px"></source>
  <img src="/content/resized/2016/02/005-VPC06-320.png" data-src="/content/uploads/2016/02/005-VPC06.png" class="blur-up lazyautosizes lazyload" alt="Figure 7: Create a Security Group for Memcached ">
</picture>
</a>



  <figcaption>Figure 7: Create a Security Group for Memcached
</figcaption>

</figure>

<p>For the newly created Memcached security group, add an Inbound Rule. Select “Custom TCP Rule” with the protocol TCP and the port range 11211. As the Source you can select the IP range of your newly created VPC or limit it even further to the public subnets (See Figure 8).</p>

<figure class="">








<a href="/content/uploads/2016/02/005-VPC07.png" title="Figure 8: Configure the Inbound Rules for the Memcached Security Group " class="image-popup">
<picture>
  <source width="936" type="image/webp" data-srcset="        /content/resized/2016/02/005-VPC07-320.webp 320w,         /content/resized/2016/02/005-VPC07-384.webp 384w,         /content/resized/2016/02/005-VPC07-512.webp 512w,         /content/resized/2016/02/005-VPC07-683.webp 683w,         /content/resized/2016/02/005-VPC07-800.webp 800w,  /content/uploads/2016/02/005-VPC07.webp 936w" sizes="936px"></source>
  <source width="936" data-srcset="    /content/resized/2016/02/005-VPC07-320.png 320w,     /content/resized/2016/02/005-VPC07-384.png 384w,     /content/resized/2016/02/005-VPC07-512.png 512w,     /content/resized/2016/02/005-VPC07-683.png 683w,     /content/resized/2016/02/005-VPC07-800.png 800w,  /content/uploads/2016/02/005-VPC07.png 936w" sizes="936px"></source>
  <img src="/content/resized/2016/02/005-VPC07-320.png" data-src="/content/uploads/2016/02/005-VPC07.png" class="blur-up lazyautosizes lazyload" alt="Figure 8: Configure the Inbound Rules for the Memcached Security Group ">
</picture>
</a>



  <figcaption>Figure 8: Configure the Inbound Rules for the Memcached Security Group
</figcaption>

</figure>

<p>Next, create a Security Group for Railgun traffic (See Figure 9).</p>

<figure class="">








<a href="/content/uploads/2016/02/005-VPC08.png" title="Figure 9: Create a Security Group for Railgun " class="image-popup">
<picture>
  <source width="655" type="image/webp" data-srcset="        /content/resized/2016/02/005-VPC08-320.webp 320w,         /content/resized/2016/02/005-VPC08-384.webp 384w,         /content/resized/2016/02/005-VPC08-512.webp 512w,  /content/uploads/2016/02/005-VPC08.webp 655w" sizes="655px"></source>
  <source width="655" data-srcset="    /content/resized/2016/02/005-VPC08-320.png 320w,     /content/resized/2016/02/005-VPC08-384.png 384w,     /content/resized/2016/02/005-VPC08-512.png 512w,  /content/uploads/2016/02/005-VPC08.png 655w" sizes="655px"></source>
  <img src="/content/resized/2016/02/005-VPC08-320.png" data-src="/content/uploads/2016/02/005-VPC08.png" class="blur-up lazyautosizes lazyload" alt="Figure 9: Create a Security Group for Railgun ">
</picture>
</a>



  <figcaption>Figure 9: Create a Security Group for Railgun
</figcaption>

</figure>

<p>For the newly created Railgun security group, add an Inbound Rule. Select “Custom TCP Rule” with the protocol TCP and the port range 2408. As the Source you can select 0.0.0.0/0 to open up access to all of the public Internet. As an alternative you could limit access even further to the <a href="https://www.cloudflare.com/ips/" target="_blank" rel="noopener noreferrer">CloudFlare IP ranges</a> only (See Figure 8).</p>

<figure class="">








<a href="/content/uploads/2016/02/005-VPC09.png" title="Figure 10: Configure the Inbound Rules for the Railgun Security Group " class="image-popup">
<picture>
  <source width="942" type="image/webp" data-srcset="        /content/resized/2016/02/005-VPC09-320.webp 320w,         /content/resized/2016/02/005-VPC09-384.webp 384w,         /content/resized/2016/02/005-VPC09-512.webp 512w,         /content/resized/2016/02/005-VPC09-683.webp 683w,         /content/resized/2016/02/005-VPC09-800.webp 800w,  /content/uploads/2016/02/005-VPC09.webp 942w" sizes="942px"></source>
  <source width="942" data-srcset="    /content/resized/2016/02/005-VPC09-320.png 320w,     /content/resized/2016/02/005-VPC09-384.png 384w,     /content/resized/2016/02/005-VPC09-512.png 512w,     /content/resized/2016/02/005-VPC09-683.png 683w,     /content/resized/2016/02/005-VPC09-800.png 800w,  /content/uploads/2016/02/005-VPC09.png 942w" sizes="942px"></source>
  <img src="/content/resized/2016/02/005-VPC09-320.png" data-src="/content/uploads/2016/02/005-VPC09.png" class="blur-up lazyautosizes lazyload" alt="Figure 10: Configure the Inbound Rules for the Railgun Security Group ">
</picture>
</a>



  <figcaption>Figure 10: Configure the Inbound Rules for the Railgun Security Group
</figcaption>

</figure>

<p>This completes the setup steps for the VPC and the Security Groups.</p>

<h2 id="elasticache-setup">ElastiCache Setup</h2>

<p>One of the pre-requisites for running CloudFlare Railgun is access to Memcached. ElastiCache provides us a managed Memcached cluster. While a Memcached cluster does not provide full protection against the failure of a cluster node, the impact of such a failure would at least be compensated. In case of a two node cluster, only approximately half of the keys would be lost in case one node fails.</p>

<p>In this tutorial we will create a two node ElastiCache cluster with the engine Memcached. Before we can do this, we need to create a Cache Subnet Group. A Cache Subnet Group attaches the nodes of an ElastiCache cluster to a certain VPC subnet. Here we want to attach our ElastiCache cluster to the private subnet, that we created in the previous step.</p>

<p>Lookup the subnet IDs for the two private subnets that you created and start the creation of the Cache Subnet Group. Pick the VPC that you created, and for each of the two Availability Zones, specify the two private subnets (See Figure 11).</p>

<figure class="">








<a href="/content/uploads/2016/02/006-ElastiCache01.png" title="Figure 11: Create a Cache Subnet Group for Memcached " class="image-popup">
<picture>
  <source width="854" type="image/webp" data-srcset="        /content/resized/2016/02/006-ElastiCache01-320.webp 320w,         /content/resized/2016/02/006-ElastiCache01-384.webp 384w,         /content/resized/2016/02/006-ElastiCache01-512.webp 512w,         /content/resized/2016/02/006-ElastiCache01-683.webp 683w,         /content/resized/2016/02/006-ElastiCache01-800.webp 800w,  /content/uploads/2016/02/006-ElastiCache01.webp 854w" sizes="854px"></source>
  <source width="854" data-srcset="    /content/resized/2016/02/006-ElastiCache01-320.png 320w,     /content/resized/2016/02/006-ElastiCache01-384.png 384w,     /content/resized/2016/02/006-ElastiCache01-512.png 512w,     /content/resized/2016/02/006-ElastiCache01-683.png 683w,     /content/resized/2016/02/006-ElastiCache01-800.png 800w,  /content/uploads/2016/02/006-ElastiCache01.png 854w" sizes="854px"></source>
  <img src="/content/resized/2016/02/006-ElastiCache01-320.png" data-src="/content/uploads/2016/02/006-ElastiCache01.png" class="blur-up lazyautosizes lazyload" alt="Figure 11: Create a Cache Subnet Group for Memcached ">
</picture>
</a>



  <figcaption>Figure 11: Create a Cache Subnet Group for Memcached
</figcaption>

</figure>

<p>Next start the creation of a new ElastiCache cluster and chose the engine type “Memcached” (See Figure 12).</p>

<figure class="">








<a href="/content/uploads/2016/02/007-ElastiCache02.png" title="Figure 12: Create an ElastiCache cluster with the engine Memcached - Step 1 " class="image-popup">
<picture>
  <source width="987" type="image/webp" data-srcset="        /content/resized/2016/02/007-ElastiCache02-320.webp 320w,         /content/resized/2016/02/007-ElastiCache02-384.webp 384w,         /content/resized/2016/02/007-ElastiCache02-512.webp 512w,         /content/resized/2016/02/007-ElastiCache02-683.webp 683w,         /content/resized/2016/02/007-ElastiCache02-800.webp 800w,         /content/resized/2016/02/007-ElastiCache02-960.webp 960w,  /content/uploads/2016/02/007-ElastiCache02.webp 987w" sizes="987px"></source>
  <source width="987" data-srcset="    /content/resized/2016/02/007-ElastiCache02-320.png 320w,     /content/resized/2016/02/007-ElastiCache02-384.png 384w,     /content/resized/2016/02/007-ElastiCache02-512.png 512w,     /content/resized/2016/02/007-ElastiCache02-683.png 683w,     /content/resized/2016/02/007-ElastiCache02-800.png 800w,     /content/resized/2016/02/007-ElastiCache02-960.png 960w,  /content/uploads/2016/02/007-ElastiCache02.png 987w" sizes="987px"></source>
  <img src="/content/resized/2016/02/007-ElastiCache02-320.png" data-src="/content/uploads/2016/02/007-ElastiCache02.png" class="blur-up lazyautosizes lazyload" alt="Figure 12: Create an ElastiCache cluster with the engine Memcached - Step 1 ">
</picture>
</a>



  <figcaption>Figure 12: Create an ElastiCache cluster with the engine Memcached - Step 1
</figcaption>

</figure>

<p>Chose the node type depending on your performance needs and select the number of nodes that you want in your cluster. In this example we will use 2 nodes, in order to achieve a certain level of redundancy (See Figure 13).</p>

<figure class="">








<a href="/content/uploads/2016/02/008-ElastiCache03.png" title="Figure 13: Create an ElastiCache cluster with the engine Memcached - Step 2 " class="image-popup">
<picture>
  <source width="966" type="image/webp" data-srcset="        /content/resized/2016/02/008-ElastiCache03-320.webp 320w,         /content/resized/2016/02/008-ElastiCache03-384.webp 384w,         /content/resized/2016/02/008-ElastiCache03-512.webp 512w,         /content/resized/2016/02/008-ElastiCache03-683.webp 683w,         /content/resized/2016/02/008-ElastiCache03-800.webp 800w,         /content/resized/2016/02/008-ElastiCache03-960.webp 960w,  /content/uploads/2016/02/008-ElastiCache03.webp 966w" sizes="966px"></source>
  <source width="966" data-srcset="    /content/resized/2016/02/008-ElastiCache03-320.png 320w,     /content/resized/2016/02/008-ElastiCache03-384.png 384w,     /content/resized/2016/02/008-ElastiCache03-512.png 512w,     /content/resized/2016/02/008-ElastiCache03-683.png 683w,     /content/resized/2016/02/008-ElastiCache03-800.png 800w,     /content/resized/2016/02/008-ElastiCache03-960.png 960w,  /content/uploads/2016/02/008-ElastiCache03.png 966w" sizes="966px"></source>
  <img src="/content/resized/2016/02/008-ElastiCache03-320.png" data-src="/content/uploads/2016/02/008-ElastiCache03.png" class="blur-up lazyautosizes lazyload" alt="Figure 13: Create an ElastiCache cluster with the engine Memcached - Step 2 ">
</picture>
</a>



  <figcaption>Figure 13: Create an ElastiCache cluster with the engine Memcached - Step 2
</figcaption>

</figure>

<p>Select the Cache Subnet Group that you created at the beginning of this section. Use the Availability Zone policy of “Spread Nodes Across Zones”. This will ensure that in case of a Availability Zone failure, you still have one ElastiCache node left. For the VPC Security Group select the “Memcached” security group that you created (See Figure 14).</p>

<figure class="">








<a href="/content/uploads/2016/02/009-ElastiCache04.png" title="Figure 14: Create an ElastiCache cluster with the engine Memcached - Step 3 " class="image-popup">
<picture>
  <source width="998" type="image/webp" data-srcset="        /content/resized/2016/02/009-ElastiCache04-320.webp 320w,         /content/resized/2016/02/009-ElastiCache04-384.webp 384w,         /content/resized/2016/02/009-ElastiCache04-512.webp 512w,         /content/resized/2016/02/009-ElastiCache04-683.webp 683w,         /content/resized/2016/02/009-ElastiCache04-800.webp 800w,         /content/resized/2016/02/009-ElastiCache04-960.webp 960w,  /content/uploads/2016/02/009-ElastiCache04.webp 998w" sizes="998px"></source>
  <source width="998" data-srcset="    /content/resized/2016/02/009-ElastiCache04-320.png 320w,     /content/resized/2016/02/009-ElastiCache04-384.png 384w,     /content/resized/2016/02/009-ElastiCache04-512.png 512w,     /content/resized/2016/02/009-ElastiCache04-683.png 683w,     /content/resized/2016/02/009-ElastiCache04-800.png 800w,     /content/resized/2016/02/009-ElastiCache04-960.png 960w,  /content/uploads/2016/02/009-ElastiCache04.png 998w" sizes="998px"></source>
  <img src="/content/resized/2016/02/009-ElastiCache04-320.png" data-src="/content/uploads/2016/02/009-ElastiCache04.png" class="blur-up lazyautosizes lazyload" alt="Figure 14: Create an ElastiCache cluster with the engine Memcached - Step 3 ">
</picture>
</a>



  <figcaption>Figure 14: Create an ElastiCache cluster with the engine Memcached - Step 3
</figcaption>

</figure>

<p>Wait for the ElastiCache cluster to be created and note down the configuration endpoint address (See Figure 15). You will need this address in a later step.</p>

<figure class="">








<a href="/content/uploads/2016/02/010-ElastiCache06.png" title="Figure 15: Lookup the Memcached endpoint address " class="image-popup">
<picture>
  <source width="1197" type="image/webp" data-srcset="        /content/resized/2016/02/010-ElastiCache06-320.webp 320w,         /content/resized/2016/02/010-ElastiCache06-384.webp 384w,         /content/resized/2016/02/010-ElastiCache06-512.webp 512w,         /content/resized/2016/02/010-ElastiCache06-683.webp 683w,         /content/resized/2016/02/010-ElastiCache06-800.webp 800w,         /content/resized/2016/02/010-ElastiCache06-960.webp 960w,  /content/uploads/2016/02/010-ElastiCache06.webp 1197w" sizes="1197px"></source>
  <source width="1197" data-srcset="    /content/resized/2016/02/010-ElastiCache06-320.png 320w,     /content/resized/2016/02/010-ElastiCache06-384.png 384w,     /content/resized/2016/02/010-ElastiCache06-512.png 512w,     /content/resized/2016/02/010-ElastiCache06-683.png 683w,     /content/resized/2016/02/010-ElastiCache06-800.png 800w,     /content/resized/2016/02/010-ElastiCache06-960.png 960w,  /content/uploads/2016/02/010-ElastiCache06.png 1197w" sizes="1197px"></source>
  <img src="/content/resized/2016/02/010-ElastiCache06-320.png" data-src="/content/uploads/2016/02/010-ElastiCache06.png" class="blur-up lazyautosizes lazyload" alt="Figure 15: Lookup the Memcached endpoint address ">
</picture>
</a>



  <figcaption>Figure 15: Lookup the Memcached endpoint address
</figcaption>

</figure>

<p>This completes the setup steps for the ElastiCache Memcached cluster.</p>

<h2 id="elastic-load-balancer-elb-setup">Elastic Load Balancer (ELB) Setup</h2>

<p>The Elastic Load Balancer (ELB) serves the purpose of distributing incoming traffic from the CloudFlare PoPs among the active Railgun nodes. As the ELB and its hostname serve as the termination point for CloudFlare Railgun traffic, it is very simple to replace a failed Railgun node behind the ELB, without making any configuration changes to the Railgun setup.</p>

<p>This configuration also allows to scale out the number of Railgun nodes or scale up the size of the Railgun nodes, without impacting production traffic.</p>

<p>Create a new ELB inside the VPC that you are using for the Railgun setup. For the Listener Configuration chose TCP as the Load Balancer as well as Instance protocol. Enter “2408” as the Load Balancer and Instance port. For the subnets, select the two public subnets that you created earlier (See Figure 16).</p>

<figure class="">








<a href="/content/uploads/2016/02/011-ELB01.png" title="Figure 16: Define an Elastic Load Balancer - Step 1 " class="image-popup">
<picture>
  <source width="1182" type="image/webp" data-srcset="        /content/resized/2016/02/011-ELB01-320.webp 320w,         /content/resized/2016/02/011-ELB01-384.webp 384w,         /content/resized/2016/02/011-ELB01-512.webp 512w,         /content/resized/2016/02/011-ELB01-683.webp 683w,         /content/resized/2016/02/011-ELB01-800.webp 800w,         /content/resized/2016/02/011-ELB01-960.webp 960w,  /content/uploads/2016/02/011-ELB01.webp 1182w" sizes="1182px"></source>
  <source width="1182" data-srcset="    /content/resized/2016/02/011-ELB01-320.png 320w,     /content/resized/2016/02/011-ELB01-384.png 384w,     /content/resized/2016/02/011-ELB01-512.png 512w,     /content/resized/2016/02/011-ELB01-683.png 683w,     /content/resized/2016/02/011-ELB01-800.png 800w,     /content/resized/2016/02/011-ELB01-960.png 960w,  /content/uploads/2016/02/011-ELB01.png 1182w" sizes="1182px"></source>
  <img src="/content/resized/2016/02/011-ELB01-320.png" data-src="/content/uploads/2016/02/011-ELB01.png" class="blur-up lazyautosizes lazyload" alt="Figure 16: Define an Elastic Load Balancer - Step 1 ">
</picture>
</a>



  <figcaption>Figure 16: Define an Elastic Load Balancer - Step 1
</figcaption>

</figure>

<p>Next assign the security group Railgun, which you have created in an earlier step. This will ensure that only Railgun traffic is allowed through the ELB (See Figure 17).</p>

<figure class="">








<a href="/content/uploads/2016/02/012-ELB02.png" title="Figure 17: Define an Elastic Load Balancer - Step 2 " class="image-popup">
<picture>
  <source width="1180" type="image/webp" data-srcset="        /content/resized/2016/02/012-ELB02-320.webp 320w,         /content/resized/2016/02/012-ELB02-384.webp 384w,         /content/resized/2016/02/012-ELB02-512.webp 512w,         /content/resized/2016/02/012-ELB02-683.webp 683w,         /content/resized/2016/02/012-ELB02-800.webp 800w,         /content/resized/2016/02/012-ELB02-960.webp 960w,  /content/uploads/2016/02/012-ELB02.webp 1180w" sizes="1180px"></source>
  <source width="1180" data-srcset="    /content/resized/2016/02/012-ELB02-320.png 320w,     /content/resized/2016/02/012-ELB02-384.png 384w,     /content/resized/2016/02/012-ELB02-512.png 512w,     /content/resized/2016/02/012-ELB02-683.png 683w,     /content/resized/2016/02/012-ELB02-800.png 800w,     /content/resized/2016/02/012-ELB02-960.png 960w,  /content/uploads/2016/02/012-ELB02.png 1180w" sizes="1180px"></source>
  <img src="/content/resized/2016/02/012-ELB02-320.png" data-src="/content/uploads/2016/02/012-ELB02.png" class="blur-up lazyautosizes lazyload" alt="Figure 17: Define an Elastic Load Balancer - Step 2 ">
</picture>
</a>



  <figcaption>Figure 17: Define an Elastic Load Balancer - Step 2
</figcaption>

</figure>

<p>Next, configure the Health Check. This will determine how the ELB will probe the Railgun nodes and determine whether they are healthy. As the ping protocol select TCP with the ping port of 2408. This is necessary as the protocol between Railgun Listener and Railgun Sender is a binary protocol and not HTTP or HTTPS. Under Advanced Details you can reduce the timeout, interval and thresholds to the minimum values for a fast failover reaction (See Figure 18).</p>

<figure class="">








<a href="/content/uploads/2016/02/013-ELB03.png" title="Figure 18: Define an Elastic Load Balancer - Step 3 " class="image-popup">
<picture>
  <source width="1183" type="image/webp" data-srcset="        /content/resized/2016/02/013-ELB03-320.webp 320w,         /content/resized/2016/02/013-ELB03-384.webp 384w,         /content/resized/2016/02/013-ELB03-512.webp 512w,         /content/resized/2016/02/013-ELB03-683.webp 683w,         /content/resized/2016/02/013-ELB03-800.webp 800w,         /content/resized/2016/02/013-ELB03-960.webp 960w,  /content/uploads/2016/02/013-ELB03.webp 1183w" sizes="1183px"></source>
  <source width="1183" data-srcset="    /content/resized/2016/02/013-ELB03-320.png 320w,     /content/resized/2016/02/013-ELB03-384.png 384w,     /content/resized/2016/02/013-ELB03-512.png 512w,     /content/resized/2016/02/013-ELB03-683.png 683w,     /content/resized/2016/02/013-ELB03-800.png 800w,     /content/resized/2016/02/013-ELB03-960.png 960w,  /content/uploads/2016/02/013-ELB03.png 1183w" sizes="1183px"></source>
  <img src="/content/resized/2016/02/013-ELB03-320.png" data-src="/content/uploads/2016/02/013-ELB03.png" class="blur-up lazyautosizes lazyload" alt="Figure 18: Define an Elastic Load Balancer - Step 3 ">
</picture>
</a>



  <figcaption>Figure 18: Define an Elastic Load Balancer - Step 3
</figcaption>

</figure>

<p>In the next step you would add the various instances to the ELB. As we have not yet created any Railgun instances, we will not add any instance here.</p>

<p>Instead we will solely ensure that the box for “Enable Cross-Zone Load Balancing” has been ticked (See Figure 19).</p>

<figure class="">








<a href="/content/uploads/2016/02/014-ELB04.png" title="Figure 19: Define an Elastic Load Balancer - Step 4 " class="image-popup">
<picture>
  <source width="1183" type="image/webp" data-srcset="        /content/resized/2016/02/014-ELB04-320.webp 320w,         /content/resized/2016/02/014-ELB04-384.webp 384w,         /content/resized/2016/02/014-ELB04-512.webp 512w,         /content/resized/2016/02/014-ELB04-683.webp 683w,         /content/resized/2016/02/014-ELB04-800.webp 800w,         /content/resized/2016/02/014-ELB04-960.webp 960w,  /content/uploads/2016/02/014-ELB04.webp 1183w" sizes="1183px"></source>
  <source width="1183" data-srcset="    /content/resized/2016/02/014-ELB04-320.png 320w,     /content/resized/2016/02/014-ELB04-384.png 384w,     /content/resized/2016/02/014-ELB04-512.png 512w,     /content/resized/2016/02/014-ELB04-683.png 683w,     /content/resized/2016/02/014-ELB04-800.png 800w,     /content/resized/2016/02/014-ELB04-960.png 960w,  /content/uploads/2016/02/014-ELB04.png 1183w" sizes="1183px"></source>
  <img src="/content/resized/2016/02/014-ELB04-320.png" data-src="/content/uploads/2016/02/014-ELB04.png" class="blur-up lazyautosizes lazyload" alt="Figure 19: Define an Elastic Load Balancer - Step 4 ">
</picture>
</a>



  <figcaption>Figure 19: Define an Elastic Load Balancer - Step 4
</figcaption>

</figure>

<p>You can tag the ELB with a name (See Figure 20).</p>

<figure class="">








<a href="/content/uploads/2016/02/015-ELB05.png" title="Figure 20: Define an Elastic Load Balancer - Step 5 " class="image-popup">
<picture>
  <source width="1178" type="image/webp" data-srcset="        /content/resized/2016/02/015-ELB05-320.webp 320w,         /content/resized/2016/02/015-ELB05-384.webp 384w,         /content/resized/2016/02/015-ELB05-512.webp 512w,         /content/resized/2016/02/015-ELB05-683.webp 683w,         /content/resized/2016/02/015-ELB05-800.webp 800w,         /content/resized/2016/02/015-ELB05-960.webp 960w,  /content/uploads/2016/02/015-ELB05.webp 1178w" sizes="1178px"></source>
  <source width="1178" data-srcset="    /content/resized/2016/02/015-ELB05-320.png 320w,     /content/resized/2016/02/015-ELB05-384.png 384w,     /content/resized/2016/02/015-ELB05-512.png 512w,     /content/resized/2016/02/015-ELB05-683.png 683w,     /content/resized/2016/02/015-ELB05-800.png 800w,     /content/resized/2016/02/015-ELB05-960.png 960w,  /content/uploads/2016/02/015-ELB05.png 1178w" sizes="1178px"></source>
  <img src="/content/resized/2016/02/015-ELB05-320.png" data-src="/content/uploads/2016/02/015-ELB05.png" class="blur-up lazyautosizes lazyload" alt="Figure 20: Define an Elastic Load Balancer - Step 5 ">
</picture>
</a>



  <figcaption>Figure 20: Define an Elastic Load Balancer - Step 5
</figcaption>

</figure>

<p>Before completing the creation of the ELB, you can validate that all settings have been configured correctly (See Figure 21).</p>

<figure class="">








<a href="/content/uploads/2016/02/016-ELB06.png" title="Figure 21: Define an Elastic Load Balancer - Step 6 " class="image-popup">
<picture>
  <source width="1180" type="image/webp" data-srcset="        /content/resized/2016/02/016-ELB06-320.webp 320w,         /content/resized/2016/02/016-ELB06-384.webp 384w,         /content/resized/2016/02/016-ELB06-512.webp 512w,         /content/resized/2016/02/016-ELB06-683.webp 683w,         /content/resized/2016/02/016-ELB06-800.webp 800w,         /content/resized/2016/02/016-ELB06-960.webp 960w,  /content/uploads/2016/02/016-ELB06.webp 1180w" sizes="1180px"></source>
  <source width="1180" data-srcset="    /content/resized/2016/02/016-ELB06-320.png 320w,     /content/resized/2016/02/016-ELB06-384.png 384w,     /content/resized/2016/02/016-ELB06-512.png 512w,     /content/resized/2016/02/016-ELB06-683.png 683w,     /content/resized/2016/02/016-ELB06-800.png 800w,     /content/resized/2016/02/016-ELB06-960.png 960w,  /content/uploads/2016/02/016-ELB06.png 1180w" sizes="1180px"></source>
  <img src="/content/resized/2016/02/016-ELB06-320.png" data-src="/content/uploads/2016/02/016-ELB06.png" class="blur-up lazyautosizes lazyload" alt="Figure 21: Define an Elastic Load Balancer - Step 6 ">
</picture>
</a>



  <figcaption>Figure 21: Define an Elastic Load Balancer - Step 6
</figcaption>

</figure>

<p>Once the ELB has been created successfully, lookup the DNS name and note it down (See Figure 22). You will need it in a subsequent step.</p>

<figure class="">








<a href="/content/uploads/2016/02/017-ELB07.png" title="Figure 22: Lookup the ELB DNS name " class="image-popup">
<picture>
  <source width="1232" type="image/webp" data-srcset="        /content/resized/2016/02/017-ELB07-320.webp 320w,         /content/resized/2016/02/017-ELB07-384.webp 384w,         /content/resized/2016/02/017-ELB07-512.webp 512w,         /content/resized/2016/02/017-ELB07-683.webp 683w,         /content/resized/2016/02/017-ELB07-800.webp 800w,         /content/resized/2016/02/017-ELB07-960.webp 960w,  /content/uploads/2016/02/017-ELB07.webp 1232w" sizes="1232px"></source>
  <source width="1232" data-srcset="    /content/resized/2016/02/017-ELB07-320.png 320w,     /content/resized/2016/02/017-ELB07-384.png 384w,     /content/resized/2016/02/017-ELB07-512.png 512w,     /content/resized/2016/02/017-ELB07-683.png 683w,     /content/resized/2016/02/017-ELB07-800.png 800w,     /content/resized/2016/02/017-ELB07-960.png 960w,  /content/uploads/2016/02/017-ELB07.png 1232w" sizes="1232px"></source>
  <img src="/content/resized/2016/02/017-ELB07-320.png" data-src="/content/uploads/2016/02/017-ELB07.png" class="blur-up lazyautosizes lazyload" alt="Figure 22: Lookup the ELB DNS name ">
</picture>
</a>



  <figcaption>Figure 22: Lookup the ELB DNS name
</figcaption>

</figure>

<p>This completes the setup steps for the Elastic Load Balancer (ELB).</p>

<h2 id="auto-scaling-setup">Auto Scaling Setup</h2>

<p>In this setup we will use Auto Scaling primarily to automatically replace failed Railgun instances. To do so, we configure an auto scaling group with a minimum of 2 instances.</p>

<p>Part of the Auto Scaling configuration is a launch group, where instead of using a pre-built Railgun AMI, we will built a Linux OS with the latest Railgun version on the fly. This will dramatically reduce the overhead for managing and updating custom OS images.</p>

<p>Start by creating a Launch Configuration, where you select the latest Ubuntu Server LTS version as your prefered AMI (See Figure 23).</p>

<figure class="">








<a href="/content/uploads/2016/02/018-EC2_01.png" title="Figure 23: Create a Launch Configuration - Step 1 " class="image-popup">
<picture>
  <source type="image/webp" data-srcset="        /content/resized/2016/02/018-EC2_01-320.webp 320w,         /content/resized/2016/02/018-EC2_01-384.webp 384w,         /content/resized/2016/02/018-EC2_01-512.webp 512w,         /content/resized/2016/02/018-EC2_01-683.webp 683w,         /content/resized/2016/02/018-EC2_01-800.webp 800w,         /content/resized/2016/02/018-EC2_01-960.webp 960w, " sizes="1400px"></source>
  <source data-srcset="    /content/resized/2016/02/018-EC2_01-320.png 320w,     /content/resized/2016/02/018-EC2_01-384.png 384w,     /content/resized/2016/02/018-EC2_01-512.png 512w,     /content/resized/2016/02/018-EC2_01-683.png 683w,     /content/resized/2016/02/018-EC2_01-800.png 800w,     /content/resized/2016/02/018-EC2_01-960.png 960w, " sizes="1400px"></source>
  <img src="/content/resized/2016/02/018-EC2_01-320.png" data-src="/content/uploads/2016/02/018-EC2_01.png" class="blur-up lazyautosizes lazyload" alt="Figure 23: Create a Launch Configuration - Step 1 ">
</picture>
</a>



  <figcaption>Figure 23: Create a Launch Configuration - Step 1
</figcaption>

</figure>

<p>As mentioned we will instruct the launch configuration to install and configure the latest version of CloudFlare Railgun on the fly. This can be done via the EC2 <a href="http://docs.aws.amazon.com/AWSEC2/latest/UserGuide/user-data.html" target="_blank" rel="noopener noreferrer">Cloud Init</a> method, where we pass a shell script into the newly created Linux OS.</p>

<p>Below is the script that will be executed upon boot. It will install and configure CloudFlare Railgun. You will have to replace three values within the script:</p>

<ul>
  <li>Railgun Activation token: You can find this token within the CloudFlare Web UI.</li>
  <li>Railgun Host: The hostname of the ELB. You should have noted this down in an earlier step.</li>
  <li>
    <p>Memcached Server: The hostname of the ElastiCache Memcached cluster. You should have noted this down in an earlier step.</p>

    <p>#!/bin/bash
  echo ‘deb http://pkg.cloudflare.com/ ‘<code class="language-plaintext highlighter-rouge">lsb_release -c -s</code>’ main’ | tee /etc/apt/sources.list.d/cloudflare-main.list
  curl -C - https://pkg.cloudflare.com/pubkey.gpg | sudo apt-key add -
  apt-get update
  apt-get install -y railgun-stable
  sed -i “s/memcached.servers = 127.0.0.1:11211/memcached.servers = railgun-ha.zazcvl.cfg.euc1.cache.amazonaws.com:11211/” /etc/railgun/railgun.conf
  sed -i “s/activation.token = YOUR_TOKEN_HERE/activation.token = 123a4567bc123d4e567abcd89012345a/” /etc/railgun/railgun.conf
  sed -i “s/activation.railgun_host = YOUR_PUBLIC_IP_OR_HOSTNAME/activation.railgun_host = Railgun-HA-1142856350.eu-central-1.elb.amazonaws.com/” /etc/railgun/railgun.conf
  service railgun start</p>
  </li>
</ul>

<p>Give your Launch Configuration a name and paste the above script into User Data field (See Figure 24).</p>

<figure class="">








<a href="/content/uploads/2016/02/019-EC2_02.png" title="Figure 24: Create a Launch Configuration - Step 2 " class="image-popup">
<picture>
  <source width="1036" type="image/webp" data-srcset="        /content/resized/2016/02/019-EC2_02-320.webp 320w,         /content/resized/2016/02/019-EC2_02-384.webp 384w,         /content/resized/2016/02/019-EC2_02-512.webp 512w,         /content/resized/2016/02/019-EC2_02-683.webp 683w,         /content/resized/2016/02/019-EC2_02-800.webp 800w,         /content/resized/2016/02/019-EC2_02-960.webp 960w,  /content/uploads/2016/02/019-EC2_02.webp 1036w" sizes="1036px"></source>
  <source width="1036" data-srcset="    /content/resized/2016/02/019-EC2_02-320.png 320w,     /content/resized/2016/02/019-EC2_02-384.png 384w,     /content/resized/2016/02/019-EC2_02-512.png 512w,     /content/resized/2016/02/019-EC2_02-683.png 683w,     /content/resized/2016/02/019-EC2_02-800.png 800w,     /content/resized/2016/02/019-EC2_02-960.png 960w,  /content/uploads/2016/02/019-EC2_02.png 1036w" sizes="1036px"></source>
  <img src="/content/resized/2016/02/019-EC2_02-320.png" data-src="/content/uploads/2016/02/019-EC2_02.png" class="blur-up lazyautosizes lazyload" alt="Figure 24: Create a Launch Configuration - Step 2 ">
</picture>
</a>



  <figcaption>Figure 24: Create a Launch Configuration - Step 2
</figcaption>

</figure>

<p>Within the Security Group configuration step, select the existing security group “Railgun” (See Figure 25). You have configured this security group in a previous step.</p>

<figure class="">








<a href="/content/uploads/2016/02/020-EC2_03.png" title="Figure 25: Create a Launch Configuration - Step 3 " class="image-popup">
<picture>
  <source type="image/webp" data-srcset="        /content/resized/2016/02/020-EC2_03-320.webp 320w,         /content/resized/2016/02/020-EC2_03-384.webp 384w,         /content/resized/2016/02/020-EC2_03-512.webp 512w,         /content/resized/2016/02/020-EC2_03-683.webp 683w,         /content/resized/2016/02/020-EC2_03-800.webp 800w,         /content/resized/2016/02/020-EC2_03-960.webp 960w, " sizes="1400px"></source>
  <source data-srcset="    /content/resized/2016/02/020-EC2_03-320.png 320w,     /content/resized/2016/02/020-EC2_03-384.png 384w,     /content/resized/2016/02/020-EC2_03-512.png 512w,     /content/resized/2016/02/020-EC2_03-683.png 683w,     /content/resized/2016/02/020-EC2_03-800.png 800w,     /content/resized/2016/02/020-EC2_03-960.png 960w, " sizes="1400px"></source>
  <img src="/content/resized/2016/02/020-EC2_03-320.png" data-src="/content/uploads/2016/02/020-EC2_03.png" class="blur-up lazyautosizes lazyload" alt="Figure 25: Create a Launch Configuration - Step 3 ">
</picture>
</a>



  <figcaption>Figure 25: Create a Launch Configuration - Step 3
</figcaption>

</figure>

<p>Next we have to create the Auto Scaling Group, which ties the Launch Configuration, Elastic Load Balancer and VPCs together to automatically launch the Railgun nodes.</p>

<p>Under Network chose the VPC that you are using for this Railgun setup and under subnet select the two public subnets of the VPC.</p>

<p>Select the ELB that you configured under Load Balancing and pick ELB as the Health Check Type (See Figure 26). This will ensure that Railgun nodes that do not accept connections over TCP/2408 anymore are considered unhealthy, will be terminated and replaced.</p>

<figure class="">








<a href="/content/uploads/2016/02/021-EC2_04.png" title="Figure 26: Create an Auto Scaling Group - Step 1 " class="image-popup">
<picture>
  <source width="861" type="image/webp" data-srcset="        /content/resized/2016/02/021-EC2_04-320.webp 320w,         /content/resized/2016/02/021-EC2_04-384.webp 384w,         /content/resized/2016/02/021-EC2_04-512.webp 512w,         /content/resized/2016/02/021-EC2_04-683.webp 683w,         /content/resized/2016/02/021-EC2_04-800.webp 800w,  /content/uploads/2016/02/021-EC2_04.webp 861w" sizes="861px"></source>
  <source width="861" data-srcset="    /content/resized/2016/02/021-EC2_04-320.png 320w,     /content/resized/2016/02/021-EC2_04-384.png 384w,     /content/resized/2016/02/021-EC2_04-512.png 512w,     /content/resized/2016/02/021-EC2_04-683.png 683w,     /content/resized/2016/02/021-EC2_04-800.png 800w,  /content/uploads/2016/02/021-EC2_04.png 861w" sizes="861px"></source>
  <img src="/content/resized/2016/02/021-EC2_04-320.png" data-src="/content/uploads/2016/02/021-EC2_04.png" class="blur-up lazyautosizes lazyload" alt="Figure 26: Create an Auto Scaling Group - Step 1 ">
</picture>
</a>



  <figcaption>Figure 26: Create an Auto Scaling Group - Step 1
</figcaption>

</figure>

<p>As we are solely using the Auto Scaling capability to replace failed Railgun nodes, pick “Keep this group at its initial size” for the scaling policy (See Figure 27).</p>

<figure class="">








<a href="/content/uploads/2016/02/022-EC2_05.png" title="Figure 27: Create an Auto Scaling Group - Step 2 " class="image-popup">
<picture>
  <source type="image/webp" data-srcset="        /content/resized/2016/02/022-EC2_05-320.webp 320w,         /content/resized/2016/02/022-EC2_05-384.webp 384w,         /content/resized/2016/02/022-EC2_05-512.webp 512w,         /content/resized/2016/02/022-EC2_05-683.webp 683w,         /content/resized/2016/02/022-EC2_05-800.webp 800w,         /content/resized/2016/02/022-EC2_05-960.webp 960w, " sizes="1400px"></source>
  <source data-srcset="    /content/resized/2016/02/022-EC2_05-320.png 320w,     /content/resized/2016/02/022-EC2_05-384.png 384w,     /content/resized/2016/02/022-EC2_05-512.png 512w,     /content/resized/2016/02/022-EC2_05-683.png 683w,     /content/resized/2016/02/022-EC2_05-800.png 800w,     /content/resized/2016/02/022-EC2_05-960.png 960w, " sizes="1400px"></source>
  <img src="/content/resized/2016/02/022-EC2_05-320.png" data-src="/content/uploads/2016/02/022-EC2_05.png" class="blur-up lazyautosizes lazyload" alt="Figure 27: Create an Auto Scaling Group - Step 2 ">
</picture>
</a>



  <figcaption>Figure 27: Create an Auto Scaling Group - Step 2
</figcaption>

</figure>

<p>Next provide what tags you want to apply to all EC2 instances that are created as part of the Auto Scaling group. It is highly recommended to at least define the tag “Name” (See Figure 28).</p>

<figure class="">








<a href="/content/uploads/2016/02/023-EC2_06.png" title="Figure 28: Create an Auto Scaling Group - Step 3 " class="image-popup">
<picture>
  <source type="image/webp" data-srcset="        /content/resized/2016/02/023-EC2_06-320.webp 320w,         /content/resized/2016/02/023-EC2_06-384.webp 384w,         /content/resized/2016/02/023-EC2_06-512.webp 512w,         /content/resized/2016/02/023-EC2_06-683.webp 683w,         /content/resized/2016/02/023-EC2_06-800.webp 800w,         /content/resized/2016/02/023-EC2_06-960.webp 960w, " sizes="1400px"></source>
  <source data-srcset="    /content/resized/2016/02/023-EC2_06-320.png 320w,     /content/resized/2016/02/023-EC2_06-384.png 384w,     /content/resized/2016/02/023-EC2_06-512.png 512w,     /content/resized/2016/02/023-EC2_06-683.png 683w,     /content/resized/2016/02/023-EC2_06-800.png 800w,     /content/resized/2016/02/023-EC2_06-960.png 960w, " sizes="1400px"></source>
  <img src="/content/resized/2016/02/023-EC2_06-320.png" data-src="/content/uploads/2016/02/023-EC2_06.png" class="blur-up lazyautosizes lazyload" alt="Figure 28: Create an Auto Scaling Group - Step 3 ">
</picture>
</a>



  <figcaption>Figure 28: Create an Auto Scaling Group - Step 3
</figcaption>

</figure>

<p>This not only concludes the configuration of the Auto Scaling setup, but of your entire setup. AWS should now automatically spin up EC2 images, automatically install and configure CloudFlare Railgun inside of them and add them to the ELB load balancer. Have a look at the next section for learning how to test your setup.</p>

<h1 id="testing-the-setup">Testing the setup</h1>

<p>Now, with the setup in place it’s time to wait for the Railgun nodes to boot up and configure correctly. You can head over to the ELB setup and look at the instances under the configured load balancer. While the nodes are still initializing you should see the status “OutOfService” displayed (See Figure 29).</p>

<figure class="">








<a href="/content/uploads/2016/02/024-STAT01.png" title="Figure 29: Monitor the Load Balancer Instances " class="image-popup">
<picture>
  <source width="1234" type="image/webp" data-srcset="        /content/resized/2016/02/024-STAT01-320.webp 320w,         /content/resized/2016/02/024-STAT01-384.webp 384w,         /content/resized/2016/02/024-STAT01-512.webp 512w,         /content/resized/2016/02/024-STAT01-683.webp 683w,         /content/resized/2016/02/024-STAT01-800.webp 800w,         /content/resized/2016/02/024-STAT01-960.webp 960w,  /content/uploads/2016/02/024-STAT01.webp 1234w" sizes="1234px"></source>
  <source width="1234" data-srcset="    /content/resized/2016/02/024-STAT01-320.png 320w,     /content/resized/2016/02/024-STAT01-384.png 384w,     /content/resized/2016/02/024-STAT01-512.png 512w,     /content/resized/2016/02/024-STAT01-683.png 683w,     /content/resized/2016/02/024-STAT01-800.png 800w,     /content/resized/2016/02/024-STAT01-960.png 960w,  /content/uploads/2016/02/024-STAT01.png 1234w" sizes="1234px"></source>
  <img src="/content/resized/2016/02/024-STAT01-320.png" data-src="/content/uploads/2016/02/024-STAT01.png" class="blur-up lazyautosizes lazyload" alt="Figure 29: Monitor the Load Balancer Instances ">
</picture>
</a>



  <figcaption>Figure 29: Monitor the Load Balancer Instances
</figcaption>

</figure>

<p>After a few minutes the status of the instances should change to “InService”, indicating that the Railgun Listener nodes are up and running and accept traffic over port TCP/2408 (See Figure 30).</p>

<figure class="">








<a href="/content/uploads/2016/02/024-STAT01-.png" title="Figure 30: ELB instances in status &lt;em&gt;InService&lt;/em&gt; " class="image-popup">
<picture>
  <source width="909" type="image/webp" data-srcset="        /content/resized/2016/02/024-STAT01--320.webp 320w,         /content/resized/2016/02/024-STAT01--384.webp 384w,         /content/resized/2016/02/024-STAT01--512.webp 512w,         /content/resized/2016/02/024-STAT01--683.webp 683w,         /content/resized/2016/02/024-STAT01--800.webp 800w,  /content/uploads/2016/02/024-STAT01-.webp 909w" sizes="909px"></source>
  <source width="909" data-srcset="    /content/resized/2016/02/024-STAT01--320.png 320w,     /content/resized/2016/02/024-STAT01--384.png 384w,     /content/resized/2016/02/024-STAT01--512.png 512w,     /content/resized/2016/02/024-STAT01--683.png 683w,     /content/resized/2016/02/024-STAT01--800.png 800w,  /content/uploads/2016/02/024-STAT01-.png 909w" sizes="909px"></source>
  <img src="/content/resized/2016/02/024-STAT01--320.png" data-src="/content/uploads/2016/02/024-STAT01-.png" class="blur-up lazyautosizes lazyload" alt="Figure 30: ELB instances in status &lt;em&gt;InService&lt;/em&gt; ">
</picture>
</a>



  <figcaption>Figure 30: ELB instances in status <em>InService</em>
</figcaption>

</figure>

<p>Now you can login to the CloudFlare Dashboard and test the Railgun setup. If everything is working you should see a “compression_ratio”, as well as “origin_response_time” displayed (See Figure 31).</p>

<figure class="">








<a href="/content/uploads/2016/02/023-RG01.png" title="Figure 31: Validate the functionality of Railgun " class="image-popup">
<picture>
  <source width="602" type="image/webp" data-srcset="        /content/resized/2016/02/023-RG01-320.webp 320w,         /content/resized/2016/02/023-RG01-384.webp 384w,         /content/resized/2016/02/023-RG01-512.webp 512w,  /content/uploads/2016/02/023-RG01.webp 602w" sizes="602px"></source>
  <source width="602" data-srcset="    /content/resized/2016/02/023-RG01-320.png 320w,     /content/resized/2016/02/023-RG01-384.png 384w,     /content/resized/2016/02/023-RG01-512.png 512w,  /content/uploads/2016/02/023-RG01.png 602w" sizes="602px"></source>
  <img src="/content/resized/2016/02/023-RG01-320.png" data-src="/content/uploads/2016/02/023-RG01.png" class="blur-up lazyautosizes lazyload" alt="Figure 31: Validate the functionality of Railgun ">
</picture>
</a>



  <figcaption>Figure 31: Validate the functionality of Railgun
</figcaption>

</figure>

<h1 id="summary">Summary</h1>

<p>This tutorial showed you how to use Amazon Web Services (AWS), with the services <a href="https://aws.amazon.com/elasticache/" target="_blank" rel="noopener noreferrer">Amazon ElastiCache</a> together with <a href="https://aws.amazon.com/elasticloadbalancing/" target="_blank" rel="noopener noreferrer">AWS Elastic Load Balancing</a>, <a href="https://aws.amazon.com/autoscaling/" target="_blank" rel="noopener noreferrer">AWS Auto Scaling</a> and <a href="https://aws.amazon.com/ec2/" target="_blank" rel="noopener noreferrer">Amazon EC2</a> to quickly and easily setup a highly available CloudFlare Railgun Listener setup.</p>

        
      </section>

      <footer class="page__meta">
        
        
  


  
  
  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-tags" aria-hidden="true"></i> Tags: </strong>
    <span itemprop="keywords">
    
      
      
      <a href="/tags/#aws" class="page__taxonomy-item" rel="tag">AWS</a><span class="sep">, </span>
    
      
      
      <a href="/tags/#cloudflare" class="page__taxonomy-item" rel="tag">Cloudflare</a>
    
    </span>
  </p>




        
          <p class="page__date"><strong><i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> Updated:</strong> <time datetime="2016-02-17T00:00:51-08:00">February 17, 2016</time></p>
        
      </footer>

      <section class="page__share">
  
    <h4 class="page__share-title">Share on</h4>
  

  <a href="https://twitter.com/intent/tweet?via=ChristianElsen&amp;text=CloudFlare+Railgun+on+AWS%20https%3A%2F%2Fwww.edge-cloud.net%2F2016%2F02%2F17%2Fcloudflare-railgun-on-aws%2F" class="btn share-button btn--twitter" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Twitter" target="_blank" rel="noopener noreferrer"><i class="fab fa-fw fa-twitter" aria-hidden="true"></i><span> Twitter</span></a>

  <a href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fwww.edge-cloud.net%2F2016%2F02%2F17%2Fcloudflare-railgun-on-aws%2F" class="btn share-button btn--facebook" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Facebook" target="_blank" rel="noopener noreferrer"><i class="fab fa-fw fa-facebook" aria-hidden="true"></i><span> Facebook</span></a>

  <a href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3A%2F%2Fwww.edge-cloud.net%2F2016%2F02%2F17%2Fcloudflare-railgun-on-aws%2F" class="btn share-button btn--linkedin" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on LinkedIn" target="_blank" rel="noopener noreferrer"><i class="fab fa-fw fa-linkedin" aria-hidden="true"></i><span> LinkedIn</span></a>
  
  <a href="https://getpocket.com/save?url=https%3A%2F%2Fwww.edge-cloud.net%2F2016%2F02%2F17%2Fcloudflare-railgun-on-aws%2F&amp;title=CloudFlare+Railgun+on+AWS" class="btn share-button btn--pocket" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Pocket" target="_blank" rel="noopener noreferrer"><i class="fab fa-fw fa-get-pocket" aria-hidden="true"></i><span> Pocket</span></a>
</section>


      
  <nav class="pagination">
    
      <a href="/2016/02/05/rum-light-with-cloudflare/" class="pagination--pager" title="RUM “Light” with CloudFlare and Google Analytics
">Previous</a>
    
    
      <a href="/2016/05/16/processing-flowroute-text-messages-aws-lambda/" class="pagination--pager" title="Processing Flowroute text messages with AWS Lambda
">Next</a>
    
  </nav>

    </div>

    
  </article>

  
  
    <div class="page__related">
      <h4 class="page__related-title">You may also enjoy</h4>
      <div class="grid__wrapper">
        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="/2022/06/28/dx-overview/" rel="permalink">AWS Direct Connect overview
</a>
      
    </h2>
    
      <p class="page__meta"><i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> <time datetime="2016-02-17T00:00:51-08:00">June 28, 2022</time> ·
    
    
      <i class="far fa-clock" aria-hidden="true"></i> 




  10 minute read
 ·      
    
      
      <i class="fas fa-tags" aria-hidden="true"></i> #AWS, #Network
    
    </p>
    <p class="archive__item-excerpt" itemprop="description">Overview of AWS Direct Connect, with which you can establish private connectivity between AWS and your data center, office, factory or collocated environment.
</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="/2020/09/28/understanding-bgp/" rel="permalink">Better understanding BGP
</a>
      
    </h2>
    
      <p class="page__meta"><i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> <time datetime="2016-02-17T00:00:51-08:00">September 28, 2020</time> ·
    
    
      <i class="far fa-clock" aria-hidden="true"></i> 




  9 minute read
 ·      
    
      
      <i class="fas fa-tags" aria-hidden="true"></i> #BGP, #Network
    
    </p>
    <p class="archive__item-excerpt" itemprop="description">Primer to better understanding BGP
</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="/2020/09/18/understanding-routing/" rel="permalink">Better understanding IP Routing
</a>
      
    </h2>
    
      <p class="page__meta"><i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> <time datetime="2016-02-17T00:00:51-08:00">September 18, 2020</time> ·
    
    
      <i class="far fa-clock" aria-hidden="true"></i> 




  10 minute read
 ·      
    
      
      <i class="fas fa-tags" aria-hidden="true"></i> #BGP, #Network
    
    </p>
    <p class="archive__item-excerpt" itemprop="description">Look at fundamental principles of IP routing to better design and troubleshoot networks
</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="/2020/09/11/aws-ipsec-vpn-ipv6/" rel="permalink">AWS Site-to-Site VPN (IPSec) with IPv6
</a>
      
    </h2>
    
      <p class="page__meta"><i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> <time datetime="2016-02-17T00:00:51-08:00">September 11, 2020</time> ·
    
    
      <i class="far fa-clock" aria-hidden="true"></i> 




  7 minute read
 ·      
    
      
      <i class="fas fa-tags" aria-hidden="true"></i> #AWS, #Network, #IPv6
    
    </p>
    <p class="archive__item-excerpt" itemprop="description">How to setup the AWS Site-to-Site VPN (IPSec) with IPv6
</p>
  </article>
</div>

        
      </div>
    </div>
  
  
  
  
  
</div>






    </div>

    
      <div class="search-content">
        <div class="search-content__inner-wrap">
<script src="https://cdn.jsdelivr.net/npm/instantsearch.js@2.3.3/dist/instantsearch.min.js"></script>
    <div class="search-searchbar"></div>
    <div class="search-hits"></div>
</div>

      </div>
    
    
    <div class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->

        <div align="center" class="page__footer-follow">
  <ul class="social-icons">
    
      <li><strong>Follow:</strong></li>
    

    
      
        
          <li><a href="http://twitter.com/ChristianElsen" rel="noopener noreferrer" target="_blank"><i class="fab fa-fw fa-twitter-square" aria-hidden="true"></i> Twitter</a></li>
        
      
        
          <li><a href="https://www.linkedin.com/in/christianelsen/" rel="noopener noreferrer" target="_blank"><i class="fab fa-fw fa-linkedin" aria-hidden="true"></i> LinkedIn</a></li>
        
      
        
          <li><a href="https://github.com/chriselsen/" rel="noopener noreferrer" target="_blank"><i class="fab fa-fw fa-github" aria-hidden="true"></i> Github</a></li>
        
      
    

    <li><a href="/feed.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
  </ul>
</div>

<div align="center" class="page__footer-copyright">© 2013 - 2022 Christian Elsen. <a href="/terms/">Terms &amp; Privacy Policy</a>.</div>

      </footer>
    </div>

    
  <script src="/assets/js/main.min.js"></script>
  <script src="/assets/js/lazysizes.min.js"></script>

  <script defer src="https://use.fontawesome.com/releases/v5.6.0/js/all.js" integrity="sha384-z9ZOvGHHo21RqN5De4rfJMoAxYpaVoiYhuJXPyVmSs8yn20IE3PmBM534CffwSJI" crossorigin="anonymous"></script>





<!-- Including InstantSearch.js library and styling -->
<script async src="https://cdn.jsdelivr.net/npm/instantsearch.js@2.3.3/dist/instantsearch.min.js"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.3.3/dist/instantsearch.min.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.3.3/dist/instantsearch-theme-algolia.min.css">

<script>
// Instanciating InstantSearch.js with Algolia credentials
const search = instantsearch({
  appId: '5XVQIGEDJ8',
  apiKey: '4e0733cbaacd194a6cf59b61024f966f',
  indexName: 'edge-cloud-net',
  searchParameters: {
    restrictSearchableAttributes: [
      'title',
      'content'
    ]
  }
});

const hitTemplate = function(hit) {
  const url = hit.url;
  const title = hit._highlightResult.title.value;
  const content = hit._highlightResult.html.value;

  return `
    <div class="list__item">
      <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
        <h2 class="archive__item-title" itemprop="headline"><a href="${url}">${title}</a></h2>
        <div class="archive__item-excerpt" itemprop="description">${content}</div>
      </article>
    </div>
  `;
}

// Adding searchbar and results widgets
search.addWidget(
  instantsearch.widgets.searchBox({
    container: '.search-searchbar',
    poweredBy: true,
    placeholder: 'Enter your search term...'
  })
);
search.addWidget(
  instantsearch.widgets.hits({
    container: '.search-hits',
    templates: {
      item: hitTemplate
    }
  })
);

// Starting the search
search.start();
</script>





    <script>
  'use strict';

  (function() {
    var commentContainer = document.querySelector('#utterances-comments');

    if (!commentContainer) {
      return;
    }

    var script = document.createElement('script');
    script.setAttribute('src', 'https://utteranc.es/client.js');
    script.setAttribute('repo', 'edge-cloud/www.edge-cloud.net');
    script.setAttribute('issue-term', 'pathname');
    script.setAttribute('theme', 'github-light');
    script.setAttribute('crossorigin', 'anonymous');

    commentContainer.appendChild(script);
  })();
</script>

  



  </body>
</html>
