<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.15.1 by Michael Rose
  Copyright 2013-2019 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>Architecture Design: vSphere with IPv6 - Edge Cloud</title>
<meta name="description" content="An architecture design recommendation for using VMware vSphere 5.x with IPv6.">


  <meta name="author" content="Christian Elsen">


<meta property="og:type" content="article">
<meta property="og:locale" content="en_US">
<meta property="og:site_name" content="Edge Cloud">
<meta property="og:title" content="Architecture Design: vSphere with IPv6">
<meta property="og:url" content="https://www.edge-cloud.net/2014/03/11/architecture-design-vsphere-ipv6/">

<meta property="og:description" content="An architecture design recommendation for using VMware vSphere 5.x with IPv6.">


<meta property="og:image" content="https://www.edge-cloud.net/assets/images/og-image.jpg">



<meta name="twitter:site" content="@ChristianElsen">
<meta name="twitter:title" content="Architecture Design: vSphere with IPv6">
<meta name="twitter:description" content="An architecture design recommendation for using VMware vSphere 5.x with IPv6.">
<meta name="twitter:url" content="https://www.edge-cloud.net/2014/03/11/architecture-design-vsphere-ipv6/">
<meta name="twitter:card" content="summary">

<meta name="twitter:image" content="https://www.edge-cloud.net/assets/images/og-image.jpg">




<meta property="article:published_time" content="2014-03-11T01:00:42-07:00">







<link rel="canonical" href="https://www.edge-cloud.net/2014/03/11/architecture-design-vsphere-ipv6/">





  <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "Organization",
      "url": "https://www.edge-cloud.net",
      "logo": "https://www.edge-cloud.net/assets/images/og-image.jpg"
    }
  </script>



  <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "Person",
      "name": "Christian Elsen",
      "url": "https://www.edge-cloud.net",
      "sameAs": ["https://twitter.com/ChristianElsen","https://www.linkedin.com/in/christianelsen/"]
    }
  </script>



  <meta name="google-site-verification" content="ZPKuOb9ie7OuRgxLoRK2REKxFW6bC0_7VaNFcTNQQxM" />





<!-- end _includes/seo.html -->


<link href="/feed.xml" type="application/atom+xml" rel="alternate" title="Edge Cloud Feed">

<!-- https://t.co/dKP3o1e -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">

<!--[if IE ]>
  <style>
    /* old IE unsupported flexbox fixes */
    .greedy-nav .site-title {
      padding-right: 3em;
    }
    .greedy-nav button {
      position: absolute;
      top: 0;
      right: 0;
      height: 100%;
    }
  </style>
<![endif]-->



    <!-- start custom head snippets -->

<!-- insert favicons. use https://realfavicongenerator.net/ -->
<link rel="apple-touch-icon" sizes="180x180" href="/assets/images/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/assets/images/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/assets/images/favicon-16x16.png">
<link rel="manifest" href="/assets/images/site.webmanifest">
<link rel="mask-icon" href="/assets/images/safari-pinned-tab.svg" color="#5bbad5">
<link rel="shortcut icon" href="/assets/images/favicon.ico">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="msapplication-config" content="/assets/images/browserconfig.xml">
<meta name="theme-color" content="#ffffff">

<link rel="preload" href="/assets/js/main.min.js" as="script">
<link rel="preload" href="/assets/js/lazysizes.min.js" as="script">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.3.3/dist/instantsearch.min.js" as="script">

<link rel="preload" href="/assets/css/main.css" as="style">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.3.3/dist/instantsearch.min.css" as="style">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.3.3/dist/instantsearch-theme-algolia.min.css" as="style">

<link rel="dns-prefetch" href="https://www.google-analytics.com">
<link rel="dns-prefetch" href="https://googleads.g.doubleclick.net">
<link rel="dns-prefetch" href="https://pagead2.googlesyndication.com">
<link rel="dns-prefetch" href="https://adservice.google.com">
<link rel="dns-prefetch" href="http://5xvqigedj8-dsn.algolia.net">

<link rel="preconnnect" href="https://www.google-analytics.com">
<link rel="preconnnect" href="https://googleads.g.doubleclick.net">
<link rel="preconnnect" href="https://pagead2.googlesyndication.com">
<link rel="preconnnect" href="https://adservice.google.com">
<link rel="preconnnect" href="https://5xvqigedj8-dsn.algolia.net">

<!-- end custom head snippets -->

  </head>

  <body class="layout--single">

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->

    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        
          <a class="site-logo webfeedsFeaturedVisual" href="/"><img src="/assets/images/edgecloud.png" alt="Edge Cloud"></a>
        
        <a class="site-title" href="/"> On the edge of cloud computing</a>
        <ul class="visible-links">
<li class="masthead__menu-item">
              <a href="/">Home</a>
            </li>
<li class="masthead__menu-item">
              <a href="/tags/#aws">AWS</a>
            </li>
<li class="masthead__menu-item">
              <a href="/tags/#ipv6">IPv6</a>
            </li>
<li class="masthead__menu-item">
              <a href="/tags/">Tags</a>
            </li>
<li class="masthead__menu-item">
              <a href="/about/">About</a>
            </li>
</ul>
        
        <button class="search__toggle" type="button">
          <span class="visually-hidden">Toggle search</span>
          <svg class="icon" width="16" height="16" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 15.99 16">
            <path d="M15.5,13.12L13.19,10.8a1.69,1.69,0,0,0-1.28-.55l-0.06-.06A6.5,6.5,0,0,0,5.77,0,6.5,6.5,0,0,0,2.46,11.59a6.47,6.47,0,0,0,7.74.26l0.05,0.05a1.65,1.65,0,0,0,.5,1.24l2.38,2.38A1.68,1.68,0,0,0,15.5,13.12ZM6.4,2A4.41,4.41,0,1,1,2,6.4,4.43,4.43,0,0,1,6.4,2Z" transform="translate(-.01)"></path>
          </svg>
        </button>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Toggle menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


    <div class="initial-content">
      



<div id="main" role="main">
  
  <div class="sidebar sticky">
  


<div itemscope itemtype="https://schema.org/Person">

  
    <div class="author__avatar">
      

      
        <img src="/assets/images/chriselsen.jpg" alt="Christian Elsen" itemprop="image">
      
    </div>
  

  <div class="author__content">
    
      <h3 class="author__name" itemprop="name">Christian Elsen</h3>
    
    
      <p class="author__bio" itemprop="description">
        Technology Generalist
      </p>
    
  </div>

  <div class="author__urls-wrapper">
    <button class="btn btn--inverse">Follow</button>
    <ul class="author__urls social-icons">
      
        <li itemprop="homeLocation" itemscope itemtype="https://schema.org/Place">
          <i class="fas fa-fw fa-map-marker-alt" aria-hidden="true"></i> <span itemprop="name">San Francisco, CA</span>
        </li>
      

      
        
          
            <li><a href="https://chris.elsen.xyz" rel="noopener noreferrer" target="_blank"><i class="fas fa-fw fa-link" aria-hidden="true"></i> Website</a></li>
          
        
          
            <li><a href="https://twitter.com/ChristianElsen" rel="noopener noreferrer" target="_blank"><i class="fab fa-fw fa-twitter-square" aria-hidden="true"></i> Twitter</a></li>
          
        
          
            <li><a href="https://www.linkedin.com/in/christianelsen/" rel="noopener noreferrer" target="_blank"><i class="fab fa-fw fa-linkedin" aria-hidden="true"></i> LinkedIn</a></li>
          
        
          
            <li><a href="https://github.com/chriselsen/" rel="noopener noreferrer" target="_blank"><i class="fab fa-fw fa-github" aria-hidden="true"></i> GitHub</a></li>
          
        
      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      <!--
  <li>
    <a href="http://link-to-whatever-social-network.com/user/" itemprop="sameAs" rel="nofollow noopener noreferrer">
      <i class="fas fa-fw" aria-hidden="true"></i> Custom Social Profile Link
    </a>
  </li>
-->
    </ul>
  </div>
</div>

  
  </div>


  <article class="page" itemscope itemtype="https://schema.org/CreativeWork">
    <meta itemprop="headline" content="Architecture Design: vSphere with IPv6">
    <meta itemprop="description" content="An architecture design recommendation for using VMware vSphere 5.x with IPv6.">
    <meta itemprop="datePublished" content="March 11, 2014">
    

    <div class="page__inner-wrap">
      
        <header>
          <h1 id="page-title" class="page__title" itemprop="headline">Architecture Design: vSphere with IPv6
</h1>
          
        </header>
      

      <section class="page__content" itemprop="text">
        
          <aside class="sidebar__right ">
            <nav class="toc">
              <header><h4 class="nav__title">
<i class="fas fa-file-alt"></i> On this page</h4></header>
              <ul class="toc__menu">
  <li><a href="#motivation">Motivation</a></li>
  <li>
<a href="#use-cases">Use Cases</a>
    <ul>
      <li><a href="#use-case-1-providing-ipv6-access-to-guest-vms--tenants">Use Case 1: Providing IPv6 access to guest VMs / tenants</a></li>
      <li><a href="#use-case-2-using-ipv6-for-management-to-save-ipv4-addresses-for-production-usage">Use Case 2: Using IPv6 for management to save IPv4 addresses for production usage</a></li>
    </ul>
  </li>
  <li><a href="#vsphere-cluster">vSphere Cluster</a></li>
  <li>
<a href="#design-components">Design Components</a>
    <ul>
      <li><a href="#phase-1">Phase 1</a></li>
      <li><a href="#phase-2">Phase 2</a></li>
    </ul>
  </li>
  <li><a href="#final-architecture">Final Architecture</a></li>
  <li><a href="#reality">Reality</a></li>
  <li><a href="#summary">Summary</a></li>
</ul>
            </nav>
          </aside>
        
        <p>In this post I will present an architecture design recommendation for using VMware vSphere 5.x with IPv6. Instead of taking an “all has to be IPv6” approach, we will look at the use case for IPv6 along with the enterprise hypervisor platform VMware vSphere and create a recommended design.</p>

<p>Afterwards we will shed some light on whether it is currently possible to implement such design with VMware vSphere 5.x, or not and what could be interim steps.</p>

<h1 id="motivation">Motivation</h1>

<p>I have come across various cases where customers want to use IPv6 with VMware vSphere. Unfortunately the question about the desired use case for IPv6, or the question about what components or features of vSphere should be used with IPv6 is often answered with: “All of it!”. Such an approach is unrealistic at this point and will most likely not lead to any success in using IPv6 with vSphere. As sad as it is, but IPv6 is not yet en par with IPv4 when it comes to product support. Most vendors - and <a href="/2013/08/07/ipv6-link-local-addresses-as-default-gateway/">VMware is one of them</a> - lag behind IPv4 with their IPv6 support today. Instead let’s shed some light on the reasons of why one would want to use VMware vSphere with IPv6 and how to design - potentially in a phased approach - an architecture design to fulfill the use case needs.</p>

<h1 id="use-cases">Use Cases</h1>

<p>Before we dive into the use cases for IPv6 with VMware vSphere, let’s ensure we understand that VMware vSphere as a platform has a very well defined purpose: Provide the ability to host virtual machines (VMs) - servers and desktops - and offer them necessary resources (compute, storage and network) from a shared pool.</p>

<p>With this we will quickly arrive at our first and most important use case:</p>

<h2 id="use-case-1-providing-ipv6-access-to-guest-vms--tenants">Use Case 1: Providing IPv6 access to guest VMs / tenants</h2>

<p>Virtual machines running on a VMware vSphere environment are typically “owned” by an internal or external stakeholder and serve a well defined purpose. This can reach from hosting an application on one or multiple server to providing a remote desktop. These VMs also typically require some kind of network access as part of their duty. Here the requirement for IPv6 is driven by the owner of the VM - potentially a customer of our virtualization platform - who wants to or needs to leverage IPv6 for the specific use case of the application. It is also possible that despite any current demand, we need to proactively provide IPv6 connectivity for VMs, so that application owners can plan ahead and incorporate IPv6 capabilities into their offerings.</p>

<p>The second use case is derived from the fact the actual platform to host virtual machines also needs to be managed and maintained. This task requires the platform components to be accessible via a network.</p>

<p>With this we arrive at our second use case:</p>

<h2 id="use-case-2-using-ipv6-for-management-to-save-ipv4-addresses-for-production-usage">Use Case 2: Using IPv6 for management to save IPv4 addresses for production usage</h2>

<p>The idea here is that IPv4 addresses - whether public or private (<a href="https://tools.ietf.org/html/rfc1918" target="_blank" rel="noopener noreferrer">RFC1918</a>) - are treated as a precious commodity, thus reserving it for where it is really badly needed. One such place could be the customer or tenant networks that host (public facing) applications. All other non essential networks with only a support function - such as internal management - should be freed up from the precious commodity and use IPv6 instead. Such an approach might eventually led to the concept of a <a href="https://ripe64.ripe.net/presentations/67-20120417-RIPE64-The_Case_for_IPv6_Only_Data_Centres.pdf" target="_blank" rel="noopener noreferrer">IPv6-only data center</a>.</p>

<h1 id="vsphere-cluster">vSphere Cluster</h1>

<p>Before we dive into the individual design components let’s recall how a vSphere Cluster is typically designed when it comes to a network-centric perspective. Such a cluster usually includes up to 5 groups of network types - some internal only to the cluster, some leaving the cluster (See Figure 1):</p>

<figure class="">








<a href="/content/uploads/2014/02/ArchitectureDesignVsphereWithIpv6.png" title="Figure 1 : Typical Architecture Design for a vSphere 5.x Cluster " class="image-popup">
<picture>
  <source width="565" type="image/webp" data-srcset="

    
    /content/resized/2014/02/ArchitectureDesignVsphereWithIpv6-320.webp 320w, 

    
    /content/resized/2014/02/ArchitectureDesignVsphereWithIpv6-384.webp 384w, 

    
    /content/resized/2014/02/ArchitectureDesignVsphereWithIpv6-512.webp 512w, 

 /content/uploads/2014/02/ArchitectureDesignVsphereWithIpv6.webp 565w" sizes="565px"></source>
  <source width="565" data-srcset="

    /content/resized/2014/02/ArchitectureDesignVsphereWithIpv6-320.png 320w, 

    /content/resized/2014/02/ArchitectureDesignVsphereWithIpv6-384.png 384w, 

    /content/resized/2014/02/ArchitectureDesignVsphereWithIpv6-512.png 512w, 

 /content/uploads/2014/02/ArchitectureDesignVsphereWithIpv6.png 565w" sizes="565px"></source>
  <img src="//:0" data-src="/content/uploads/2014/02/ArchitectureDesignVsphereWithIpv6.png" class="blur-up lazyautosizes lazyload" alt="Figure 1 : Typical Architecture Design for a vSphere 5.x Cluster ">
</picture>
</a>



  <figcaption>Figure 1 : Typical Architecture Design for a vSphere 5.x Cluster
</figcaption>

</figure>

<ul>
  <li>
<strong><em>Management Network:</em></strong> This network is used for the administrative staff to interact with the vSphere cluster, e.g. connecting to the vSphere Web Client from a browser. But it is also used for communication with other corporate management systems, ranging from time synchronization via NTP to central log management via Syslog.</li>
  <li>
<strong>VM / Tenant Network:</strong> This network is used for workload VMs residing on the cluster to connect to the outside world. It is very well possible that multiple such networks exist, e.g. in the case where multiple tenants share a vSphere cluster and each tenant shall connect to a dedicated network.</li>
  <li>
<strong>VXLAN Transport Network:</strong> This network is used to transport the VXLAN overlay traffic, also often called the outer VXLAN traffic. If VXLAN are to span across clusters, this transport network also needs to span across clusters. Unless the controller-based VXLAN implementation is chosen, this network requires to be enabled for transporting Multicast traffic.</li>
  <li>
<strong>Storage Network:</strong> In the case that a network based storage solution - such as NFS or iSCSI - is used, this network carries the storage traffic between a central storage array and the ESXi servers within a vSphere cluster. All major network vendors recommend that this network doesn’t extend beyond a L2 boundary and is therefore not routed. The storage network often remains local to the vSphere cluster only, with the storage array assigned to the specific cluster. Also there might be multiple storage networks per cluster, depending on how many storage arrays are used.</li>
  <li>
<strong>VMotion / FT Network:</strong> This network is used for VMotion and/or Fault Tolerance (FT) traffic between the ESXi hosts. It is highly recommended that this network also doesn’t extend beyond a L2 boundary and is therefore not routed. Instead it is local to a vSphere cluster only.</li>
</ul>

<h1 id="design-components">Design Components</h1>

<p>Now we will have a closer look at our use cases again with the above typical vSphere Cluster setup in mind.</p>

<h2 id="phase-1">Phase 1</h2>

<p>Let’s start with the use case of providing IPv6 access to guest VMs / tenants, being the more crucial one and therefore the one to tackle first.</p>

<p>Here a simple network connectivity for a VM will include multiple elements, which all need to be enabled to support carrying and/or processing both IPv4 and IPv6 traffic (See Figure 2).</p>

<p>The following capabilities in each of these design elements are necessary to support the use case.</p>

<figure class="">








<a href="/content/uploads/2014/03/Tenant_IPv6_Simple.png" title="Figure 2: Simple network connectivity for VMs " class="image-popup">
<picture>
  <source width="476" type="image/webp" data-srcset="

    
    /content/resized/2014/03/Tenant_IPv6_Simple-320.webp 320w, 

    
    /content/resized/2014/03/Tenant_IPv6_Simple-384.webp 384w, 

 /content/uploads/2014/03/Tenant_IPv6_Simple.webp 476w" sizes="476px"></source>
  <source width="476" data-srcset="

    /content/resized/2014/03/Tenant_IPv6_Simple-320.png 320w, 

    /content/resized/2014/03/Tenant_IPv6_Simple-384.png 384w, 

 /content/uploads/2014/03/Tenant_IPv6_Simple.png 476w" sizes="476px"></source>
  <img src="//:0" data-src="/content/uploads/2014/03/Tenant_IPv6_Simple.png" class="blur-up lazyautosizes lazyload" alt="Figure 2: Simple network connectivity for VMs ">
</picture>
</a>



  <figcaption>Figure 2: Simple network connectivity for VMs
</figcaption>

</figure>

<ul>
  <li>
<strong>Workload:</strong> The workload itself needs to support IPv4 and/or IPv6 and needs to be configured for it. But also the Virtualization platform needs to support IPv6 besides IPv4 in the VM, e.g. as part of the OS guest customization or by ensuring the <a href="https://en.wikipedia.org/wiki/DHCPv6#DHCP_Unique_Identifier" target="_blank" rel="noopener noreferrer">DHCP Unique Identifier (DUID)</a> is either maintained or regenerated during a cloning operation - similar to the MAC address. Windows had some <a href="https://support.microsoft.com/en-us/kb/2711727" target="_blank" rel="noopener noreferrer">problems re-generating the DUID</a> when setting up a new machine via Sysprep.</li>
  <li>
<strong>vNIC:</strong> The vNIC connects the workload to the virtual switch. In order to achieve the same performance with IPv6 traffic as with IPv4 traffic, the vNIC should not only support IPv4 as part of the <a href="https://en.wikipedia.org/wiki/TCP_offload_engine" target="_blank" rel="noopener noreferrer">TCP offload engine</a>, but also IPv6. VMware vSphere has received numerous <a href="http://blogs.vmware.com/performance/2013/09/ipv6-performance-improvements-in-vsphere-5-5.html" target="_blank" rel="noopener noreferrer">performance improvements</a> in version vSphere 5.5. The vNIC might also be the enforcement point for a network security policy. Such a policy also needs to support IPv6.</li>
  <li>
<strong>Virtual Switch:</strong> As a layer 2 device the virtual switch should not have any difficulty transporting IPv6 packets. But this is not enough. As the vSwitch acts as the access layer switch for the VM workloads it also needs to support common <a href="http://www.cisco.com/c/en/us/products/ios-nx-os-software/ipv6-first-hop-security-fhs/index.html" target="_blank" rel="noopener noreferrer">First Hop Security Mechanism</a> such as IPv6 RA Guard and IPv6 ND Inspection. With a virtualization platform in the picture it is not sufficient to implement these features in the physical switch, as this switch is usually not aware of the individual workloads but only the Hypervisor host. And enforcing security at this level is clearly not sufficient.</li>
  <li>
<strong>Physical Switch:</strong> The physical switch will connect the individual Hypervisor hosts with each other and the upstream router. With regards to IPv6 this device usually does not need to provide any special capabilities.</li>
  <li>
<strong>Layer 3 Gateway / Router:</strong> The Layer 3 Gateway - also known as the router - is the boundary of the local layer 2 and provides the ability to reach other hosts via L3 - also known as routing. This gateway can either be a physical device or a virtual appliance, such as the VMware vShield Edge. As such, this device needs to support the L3 protocol of IPv6. It needs to be able to configure interfaces with IPv6 addresses and support static and dynamic routing of the IPv6 protocol. For <a href="https://www.edge-cloud.net/2013/11/18/ipv6-address-management-hosts/">IPv6 address management</a> it needs to support the functionality of acting as a DHCPv6 relay and/or provide DHCPv6 functionality itself. Support for Stateless Address Auto Configuration (SLLAC) is also crucial within this device.</li>
</ul>

<p>A slight modification of the above setup comes into play when overlay networks - such as <a href="https://en.wikipedia.org/wiki/Virtual_Extensible_LAN" target="_blank" rel="noopener noreferrer">VXLAN</a> - are used. In this case the communication between two workload VMs might traverse the overlay tunnel as an encapsulated packet (See Figure 3). While the tunnel transport protocol - the outer encapsulated packets - does not need to use IPv6, it does need to provide the ability to transport IPv6 traffic. In the case of VXLAN this is possible as VXLAN can transport any kind of L3 protocol including IPv6. But one needs to keep <a href="https://tools.ietf.org/html/rfc2460" target="_blank" rel="noopener noreferrer">RFC 2460</a> in mind, which asks for a minimum MTU of 1280 bytes for an IPv6 path. Along with a IPv6 header usually being 20 bytes larger than the IPv4 header, VXLAN must be configured to transport this increased payload size. This is usually the case as the MTU settings for VXLAN default to 1600.</p>

<figure class="">








<a href="/content/uploads/2014/03/Tenant_IPv6_Advanced.png" title="Figure 3: Advanced network connectivity for VMs " class="image-popup">
<picture>
  <source width="570" type="image/webp" data-srcset="

    
    /content/resized/2014/03/Tenant_IPv6_Advanced-320.webp 320w, 

    
    /content/resized/2014/03/Tenant_IPv6_Advanced-384.webp 384w, 

    
    /content/resized/2014/03/Tenant_IPv6_Advanced-512.webp 512w, 

 /content/uploads/2014/03/Tenant_IPv6_Advanced.webp 570w" sizes="570px"></source>
  <source width="570" data-srcset="

    /content/resized/2014/03/Tenant_IPv6_Advanced-320.png 320w, 

    /content/resized/2014/03/Tenant_IPv6_Advanced-384.png 384w, 

    /content/resized/2014/03/Tenant_IPv6_Advanced-512.png 512w, 

 /content/uploads/2014/03/Tenant_IPv6_Advanced.png 570w" sizes="570px"></source>
  <img src="//:0" data-src="/content/uploads/2014/03/Tenant_IPv6_Advanced.png" class="blur-up lazyautosizes lazyload" alt="Figure 3: Advanced network connectivity for VMs ">
</picture>
</a>



  <figcaption>Figure 3: Advanced network connectivity for VMs
</figcaption>

</figure>

<h2 id="phase-2">Phase 2</h2>

<p>Next we will look at the use case of using IPv6 for management to save IPv4 addresses for production usage. In this case all management traffic leaving the vSphere cluster needs to be IPv6, while all traffic remaining within the cluster can remain IPv4. The reason for not having to move everything to IPv6 is that traffic such as VMotion will not only stay within the vSphere cluster but is anyways not routed beyond the cluster boundaries. It is therefore no problem to re-use the same IP address range for e.g. VMotion in all clusters or even re-use the same IP range outside of the VMware vSphere setup for completely different purposes.</p>

<p>The networks that do not leave the cluster and can therefore remain operating solely with IPv4 are for the VMotion / FT Network as well as the storage network.</p>

<p>On the other hand the network that need to carry IPv6 traffic - as they connect outside the cluster - are the VM / Tenant Network - as discussed already, the Management Network and the VXLAN Transport Network.</p>

<p>Over the Management Network all functionality that is required for managing the cluster needs to support IPv6. What this means in particular depends on the existing design of the environment:</p>

<ul>
  <li>vCenter server: All communication with the vCenter Server needs to be able to use IPv6. This e.g. includes using the vSphere Web Client interface, but also communication with outside components such as the database used for vCenter or Active Directory for authentication and authorization. Last but not least, the communication between the vCenter server and the ESXi hosts also needs to support IPv6.</li>
  <li>ESXi hosts: Any management functionality where the vSphere cluster integrates with third party components needs to support IPv6. This includes integration with network management tools via SNMP, central log aggregation via Syslog or time synchronization via NTP.</li>
</ul>

<p>The VXLAN Transport Network usually not only needs to span an overlay network within the same cluster, but also across a cluster (See Figure 4). For this it is necessary that the VTEPs support IPv6 and the VXLAN Transport traffic can use IPv6.</p>

<figure class="">








<a href="/content/uploads/2014/03/VXLAN_VTEP.png" title="Figure 4: VXLAN transport traffic between vSphere cluster " class="image-popup">
<picture>
  <source width="574" type="image/webp" data-srcset="

    
    /content/resized/2014/03/VXLAN_VTEP-320.webp 320w, 

    
    /content/resized/2014/03/VXLAN_VTEP-384.webp 384w, 

    
    /content/resized/2014/03/VXLAN_VTEP-512.webp 512w, 

 /content/uploads/2014/03/VXLAN_VTEP.webp 574w" sizes="574px"></source>
  <source width="574" data-srcset="

    /content/resized/2014/03/VXLAN_VTEP-320.png 320w, 

    /content/resized/2014/03/VXLAN_VTEP-384.png 384w, 

    /content/resized/2014/03/VXLAN_VTEP-512.png 512w, 

 /content/uploads/2014/03/VXLAN_VTEP.png 574w" sizes="574px"></source>
  <img src="//:0" data-src="/content/uploads/2014/03/VXLAN_VTEP.png" class="blur-up lazyautosizes lazyload" alt="Figure 4: VXLAN transport traffic between vSphere cluster ">
</picture>
</a>



  <figcaption>Figure 4: VXLAN transport traffic between vSphere cluster
</figcaption>

</figure>

<h1 id="final-architecture">Final Architecture</h1>

<p>The final proposed architecture would cover both presented use cases - potentially in a phased approach - and look as follows (See Figure 5):</p>

<p>Phase 1:</p>

<ul>
  <li>VM / Tenant Network: Support both IPv4 and IPv6 in a Dualstack setup to give tenants and individual workloads the maximum choice.</li>
</ul>

<p>Phase 2:</p>

<ul>
  <li>Management Network: Support for handling all management traffic between vSphere cluster and external systems via IPv6-only.</li>
  <li>VXLAN Transport Network: Support for IPv6 only to create an overlay network across multiple vSphere cluster.</li>
</ul>

<p>Other:</p>

<ul>
  <li>Storage Network: This traffic can remain IPv4 as it is unrouted and will never leave the vSphere cluster.</li>
  <li>VMotion / FT Network: This traffic can also remain IPv4 as it is unrouted and will never leave the vSphere cluster.</li>
</ul>

<figure class="">








<a href="/content/uploads/2014/02/ArchitectureDesignVsphereWithIpv6AddressTypeMapping.png" title="Figure 5 : Architecture Design for vSphere 5.x with IPv6 - Protocol mapping " class="image-popup">
<picture>
  <source width="473" type="image/webp" data-srcset="

    
    /content/resized/2014/02/ArchitectureDesignVsphereWithIpv6AddressTypeMapping-320.webp 320w, 

    
    /content/resized/2014/02/ArchitectureDesignVsphereWithIpv6AddressTypeMapping-384.webp 384w, 

 /content/uploads/2014/02/ArchitectureDesignVsphereWithIpv6AddressTypeMapping.webp 473w" sizes="473px"></source>
  <source width="473" data-srcset="

    /content/resized/2014/02/ArchitectureDesignVsphereWithIpv6AddressTypeMapping-320.png 320w, 

    /content/resized/2014/02/ArchitectureDesignVsphereWithIpv6AddressTypeMapping-384.png 384w, 

 /content/uploads/2014/02/ArchitectureDesignVsphereWithIpv6AddressTypeMapping.png 473w" sizes="473px"></source>
  <img src="//:0" data-src="/content/uploads/2014/02/ArchitectureDesignVsphereWithIpv6AddressTypeMapping.png" class="blur-up lazyautosizes lazyload" alt="Figure 5 : Architecture Design for vSphere 5.x with IPv6 - Protocol mapping ">
</picture>
</a>



  <figcaption>Figure 5 : Architecture Design for vSphere 5.x with IPv6 - Protocol mapping
</figcaption>

</figure>

<h1 id="reality">Reality</h1>

<p>Now that we have a solid design for a vSphere setup with IPv6, let’s have a look if this can actually be implemented today:</p>

<p>Phase 1:</p>

<ul>
  <li>
<strong>VM / Tenant Network:</strong> This is mostly working and supported today. Small limitations do exist around Guest Customization via Sysprep. You can also expect to stumble over <a href="http://kb.vmware.com/kb/2040850" target="_blank" rel="noopener noreferrer">one</a> or <a href="http://kb.vmware.com/kb/2001653" target="_blank" rel="noopener noreferrer">two</a> bugs here. But the largest limitation exist in the virtual switch. Neither the VMware standard nor the distributed vSwitch support IPv6 first hop security capabilities. At least the vCloud Networking and Security Edge supports basic IPv6 features with the ability to manually configure its interfaces for IPv6, configure static routing in IPv6 and use the Firewall and Load Balancer feature with IPv6. And also the vCloud Networking and Security App Firewall <a href="https://blogs.vmware.com/vsphere/2013/06/vcloud-networking-and-security-5-1-app-firewall-best-practices.html" target="_blank" rel="noopener noreferrer">supports IPv6</a>. But you have to be careful here, because all of this IPv6 doesn’t come with vCNS - which is part of the vCloud Suite - but only with NSX for vSphere - which has to be licensed separately.</li>
</ul>

<p>Phase 2:</p>

<ul>
  <li>
<strong>Management Network:</strong> Here your mileage will vary depending on the components you’re using and the features you are attempting to use: While a <a href="http://kb.vmware.com/kb/2003790" target="_blank" rel="noopener noreferrer">Windows-based vCenter does support IPv6</a>, the <a href="http://kb.vmware.com/kb/2002531" target="_blank" rel="noopener noreferrer">vCenter Server Appliance does not</a>. The mandatory use of vSphere SSO will limit you further, as <a href="http://kb.vmware.com/kb/2035454" target="_blank" rel="noopener noreferrer">SSO does not work on a IPv6-only host</a>. While the Windows version of the vSphere client supports IPv6, the Web Client does not. Also while ESXi can export Syslog data via IPv6, vSphere can not ingest them via the Syslog and Dump collector. At least basic network protocols such as NTP and SNMP for the ESXi hosts work over IPv6.
    <ul>
      <li>
<strong>VXLAN Transport Network:</strong> The <a href="https://tools.ietf.org/html/draft-mahalingam-dutt-dcops-vxlan-00" target="_blank" rel="noopener noreferrer">original VXLAN Internet-Draft</a> addressed only IPv4 and dealt with IPv6 only via the sentence “Use of VXLAN with IPv6 transport will be addressed in a future version of this draft”. Needless to say that this is pretty sad for a protocol proposal published in August 2012. Luckily that <a href="https://tools.ietf.org/html/draft-mahalingam-dutt-dcops-vxlan-03" target="_blank" rel="noopener noreferrer">future version</a> came in February 2013. But so far VXLAN over IPv6 has not been implemented by any of the major vendors.</li>
    </ul>
  </li>
</ul>

<p>Other:</p>

<ul>
  <li>
<strong>Storage Network:</strong> While we stated that this traffic can remain IPv4-only, it is possible to use both iSCSI (at least via the software initiator) as well as NFS via IPv6. Unfortunately doing so is considered experimental or not even supported <a href="http://kb.vmware.com/kb/1021769" target="_blank" rel="noopener noreferrer">depending on your vSphere version</a>. Unfortunately this also highlights the dilemma that some features might appear to “work” with IPv6, but their full breadth hasn’t been tested by VMware’s engineering organization, which in return means that the feature is not officially supported by <a href="https://www.vmware.com/support/services.html" target="_blank" rel="noopener noreferrer">VMware GSS</a>
</li>
  <li>
<strong>VMotion / FT Network:</strong> Here we also stated that this traffic can remain IPv4-only. But also here it is possible to use at least VMotion over a IPv6-only network and it even appears to be supported.</li>
</ul>

<h1 id="summary">Summary</h1>

<p>Today it is unfortunately not possible to implement the full IPv6 for vSphere architecture design above. Only parts of it can be implemented with a greatly reduced functionality set. If IPv6 with vSphere is for you greatly depends on your use case and what functionality you are willing to give up.</p>

        
      </section>

      <footer class="page__meta">
        
        
  


  
  
  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-tags" aria-hidden="true"></i> Tags: </strong>
    <span itemprop="keywords">
    
      
      
      <a href="/tags/#architecture" class="page__taxonomy-item" rel="tag">Architecture</a><span class="sep">, </span>
    
      
      
      <a href="/tags/#ipv6" class="page__taxonomy-item" rel="tag">IPv6</a><span class="sep">, </span>
    
      
      
      <a href="/tags/#vmware" class="page__taxonomy-item" rel="tag">VMware</a>
    
    </span>
  </p>




        
          <p class="page__date"><strong><i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> Updated:</strong> <time datetime="2014-03-11T01:00:42-07:00">March 11, 2014</time></p>
        
      </footer>

      <section class="page__share">
  
    <h4 class="page__share-title">Share on</h4>
  

  <a href="https://twitter.com/intent/tweet?via=ChristianElsen&amp;text=Architecture+Design%3A+vSphere+with+IPv6%20https%3A%2F%2Fwww.edge-cloud.net%2F2014%2F03%2F11%2Farchitecture-design-vsphere-ipv6%2F" class="btn share-button btn--twitter" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Twitter" target="_blank" rel="noopener noreferrer"><i class="fab fa-fw fa-twitter" aria-hidden="true"></i><span> Twitter</span></a>

  <a href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fwww.edge-cloud.net%2F2014%2F03%2F11%2Farchitecture-design-vsphere-ipv6%2F" class="btn share-button btn--facebook" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Facebook" target="_blank" rel="noopener noreferrer"><i class="fab fa-fw fa-facebook" aria-hidden="true"></i><span> Facebook</span></a>

  <a href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3A%2F%2Fwww.edge-cloud.net%2F2014%2F03%2F11%2Farchitecture-design-vsphere-ipv6%2F" class="btn share-button btn--linkedin" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on LinkedIn" target="_blank" rel="noopener noreferrer"><i class="fab fa-fw fa-linkedin" aria-hidden="true"></i><span> LinkedIn</span></a>
  
  <a href="https://getpocket.com/save?url=https%3A%2F%2Fwww.edge-cloud.net%2F2014%2F03%2F11%2Farchitecture-design-vsphere-ipv6%2F&amp;title=Architecture+Design%3A+vSphere+with+IPv6" class="btn share-button btn--pocket" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Pocket" target="_blank" rel="noopener noreferrer"><i class="fab fa-fw fa-get-pocket" aria-hidden="true"></i><span> Pocket</span></a>
</section>


      
  <nav class="pagination">
    
      <a href="/2014/02/14/deploy-wordpress-aws-opsworks/" class="pagination--pager" title="Deploy WordPress with AWS OpsWorks
">Previous</a>
    
    
      <a href="/2014/06/02/monitoring-ipv6-websites-via-thousandeyes/" class="pagination--pager" title="Monitoring IPv6 websites and SaaS apps via ThousandEyes
">Next</a>
    
  </nav>

    </div>

    
  </article>

  
  
    <div class="page__related">
      <h4 class="page__related-title">You may also enjoy</h4>
      <div class="grid__wrapper">
        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="/2020/09/28/understanding-bgp/" rel="permalink">Better understanding BGP
</a>
      
    </h2>
    
    <p class="archive__item-excerpt" itemprop="description">Primer to better understanding BGP
</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="/2020/09/18/understanding-routing/" rel="permalink">Better understanding IP Routing
</a>
      
    </h2>
    
    <p class="archive__item-excerpt" itemprop="description">Look at fundamental principles of IP routing to better design and troubleshoot networks
</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="/2020/09/11/aws-ipsec-vpn-ipv6/" rel="permalink">AWS Site-to-Site VPN (IPSec) with IPv6
</a>
      
    </h2>
    
    <p class="archive__item-excerpt" itemprop="description">How to setup the AWS Site-to-Site VPN (IPSec) with IPv6
</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="/2020/05/01/tgw-multicast-intro/" rel="permalink">Multicast with AWS Transit Gateway
</a>
      
    </h2>
    
    <p class="archive__item-excerpt" itemprop="description">Walkthrough for setup and testing IP Multicast with AWS Transit Gateway (TGW)
</p>
  </article>
</div>

        
      </div>
    </div>
  
  
  
  
  
</div>






    </div>

    
      <div class="search-content">
        <div class="search-content__inner-wrap">
<script src="https://cdn.jsdelivr.net/npm/instantsearch.js@2.3.3/dist/instantsearch.min.js"></script>
    <div class="search-searchbar"></div>
    <div class="search-hits"></div>
</div>

      </div>
    
    
    <div class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->

        <div align="center" class="page__footer-follow">
  <ul class="social-icons">
    
      <li><strong>Follow:</strong></li>
    

    
      
        
          <li><a href="http://twitter.com/ChristianElsen" rel="noopener noreferrer" target="_blank"><i class="fab fa-fw fa-twitter-square" aria-hidden="true"></i> Twitter</a></li>
        
      
        
          <li><a href="https://www.linkedin.com/in/christianelsen/" rel="noopener noreferrer" target="_blank"><i class="fab fa-fw fa-linkedin" aria-hidden="true"></i> LinkedIn</a></li>
        
      
        
          <li><a href="https://github.com/chriselsen/" rel="noopener noreferrer" target="_blank"><i class="fab fa-fw fa-github" aria-hidden="true"></i> Github</a></li>
        
      
    

    <li><a href="/feed.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
  </ul>
</div>

<div align="center" class="page__footer-copyright">© 2013 - 2022 Christian Elsen. <a href="/terms/">Terms &amp; Privacy Policy</a>.</div>

      </footer>
    </div>

    
  <script src="/assets/js/main.min.js"></script>
  <script src="/assets/js/lazysizes.min.js"></script>

  <script defer src="https://use.fontawesome.com/releases/v5.6.0/js/all.js" integrity="sha384-z9ZOvGHHo21RqN5De4rfJMoAxYpaVoiYhuJXPyVmSs8yn20IE3PmBM534CffwSJI" crossorigin="anonymous"></script>





<!-- Including InstantSearch.js library and styling -->
<script async src="https://cdn.jsdelivr.net/npm/instantsearch.js@2.3.3/dist/instantsearch.min.js"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.3.3/dist/instantsearch.min.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.3.3/dist/instantsearch-theme-algolia.min.css">

<script>
// Instanciating InstantSearch.js with Algolia credentials
const search = instantsearch({
  appId: '5XVQIGEDJ8',
  apiKey: '4e0733cbaacd194a6cf59b61024f966f',
  indexName: 'edge-cloud-net',
  searchParameters: {
    restrictSearchableAttributes: [
      'title',
      'content'
    ]
  }
});

const hitTemplate = function(hit) {
  const url = hit.url;
  const title = hit._highlightResult.title.value;
  const content = hit._highlightResult.html.value;

  return `
    <div class="list__item">
      <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
        <h2 class="archive__item-title" itemprop="headline"><a href="${url}">${title}</a></h2>
        <div class="archive__item-excerpt" itemprop="description">${content}</div>
      </article>
    </div>
  `;
}

// Adding searchbar and results widgets
search.addWidget(
  instantsearch.widgets.searchBox({
    container: '.search-searchbar',
    poweredBy: true,
    placeholder: 'Enter your search term...'
  })
);
search.addWidget(
  instantsearch.widgets.hits({
    container: '.search-hits',
    templates: {
      item: hitTemplate
    }
  })
);

// Starting the search
search.start();
</script>





    <script>
  'use strict';

  (function() {
    var commentContainer = document.querySelector('#utterances-comments');

    if (!commentContainer) {
      return;
    }

    var script = document.createElement('script');
    script.setAttribute('src', 'https://utteranc.es/client.js');
    script.setAttribute('repo', 'edge-cloud/www.edge-cloud.net');
    script.setAttribute('issue-term', 'pathname');
    script.setAttribute('theme', 'github-light');
    script.setAttribute('crossorigin', 'anonymous');

    commentContainer.appendChild(script);
  })();
</script>

  



  </body>
</html>
