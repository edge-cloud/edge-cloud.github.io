<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.15.1 by Michael Rose
  Copyright 2013-2019 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>Limitations of Anycast for distributed content delivery - Edge Cloud</title>
<meta name="description" content="Exploring the limitations of Anycast using AWS Global Accelerator and RIPE Atlas, through visualizing the real life results.">


  <meta name="author" content="Christian Elsen">


<meta property="og:type" content="article">
<meta property="og:locale" content="en_US">
<meta property="og:site_name" content="Edge Cloud">
<meta property="og:title" content="Limitations of Anycast for distributed content delivery">
<meta property="og:url" content="https://www.edge-cloud.net/2019/04/08/limitations-of-anycast/">

<meta property="og:description" content="Exploring the limitations of Anycast using AWS Global Accelerator and RIPE Atlas, through visualizing the real life results.">


<meta property="og:image" content="https://www.edge-cloud.net/assets/images/og-image.jpg">



<meta name="twitter:site" content="@ChristianElsen">
<meta name="twitter:title" content="Limitations of Anycast for distributed content delivery">
<meta name="twitter:description" content="Exploring the limitations of Anycast using AWS Global Accelerator and RIPE Atlas, through visualizing the real life results.">
<meta name="twitter:url" content="https://www.edge-cloud.net/2019/04/08/limitations-of-anycast/">
<meta name="twitter:card" content="summary">

<meta name="twitter:image" content="https://www.edge-cloud.net/assets/images/og-image.jpg">




<meta property="article:published_time" content="2019-04-08T00:00:00-07:00">







<link rel="canonical" href="https://www.edge-cloud.net/2019/04/08/limitations-of-anycast/">





  <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "Organization",
      "url": "https://www.edge-cloud.net",
      "logo": "https://www.edge-cloud.net/assets/images/og-image.jpg"
    }
  </script>



  <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "Person",
      "name": "Christian Elsen",
      "url": "https://www.edge-cloud.net",
      "sameAs": ["https://twitter.com/ChristianElsen","https://www.linkedin.com/in/christianelsen/"]
    }
  </script>



  <meta name="google-site-verification" content="ZPKuOb9ie7OuRgxLoRK2REKxFW6bC0_7VaNFcTNQQxM" />





<!-- end _includes/seo.html -->


<link href="/feed.xml" type="application/atom+xml" rel="alternate" title="Edge Cloud Feed">

<!-- https://t.co/dKP3o1e -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">

<!--[if IE ]>
  <style>
    /* old IE unsupported flexbox fixes */
    .greedy-nav .site-title {
      padding-right: 3em;
    }
    .greedy-nav button {
      position: absolute;
      top: 0;
      right: 0;
      height: 100%;
    }
  </style>
<![endif]-->



    <!-- start custom head snippets -->

<!-- insert favicons. use https://realfavicongenerator.net/ -->
<link rel="apple-touch-icon" sizes="180x180" href="/assets/images/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/assets/images/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/assets/images/favicon-16x16.png">
<link rel="manifest" href="/assets/images/site.webmanifest">
<link rel="mask-icon" href="/assets/images/safari-pinned-tab.svg" color="#5bbad5">
<link rel="shortcut icon" href="/assets/images/favicon.ico">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="msapplication-config" content="/assets/images/browserconfig.xml">
<meta name="theme-color" content="#ffffff">

<link rel="preload" href="/assets/js/main.min.js" as="script">
<link rel="preload" href="/assets/js/lazysizes.min.js" as="script">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.3.3/dist/instantsearch.min.js" as="script">

<link rel="preload" href="/assets/css/main.css" as="style">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.3.3/dist/instantsearch.min.css" as="style">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.3.3/dist/instantsearch-theme-algolia.min.css" as="style">

<link rel="dns-prefetch" href="https://www.google-analytics.com">
<link rel="dns-prefetch" href="https://googleads.g.doubleclick.net">
<link rel="dns-prefetch" href="https://pagead2.googlesyndication.com">
<link rel="dns-prefetch" href="https://adservice.google.com">
<link rel="dns-prefetch" href="http://5xvqigedj8-dsn.algolia.net">

<link rel="preconnnect" href="https://www.google-analytics.com">
<link rel="preconnnect" href="https://googleads.g.doubleclick.net">
<link rel="preconnnect" href="https://pagead2.googlesyndication.com">
<link rel="preconnnect" href="https://adservice.google.com">
<link rel="preconnnect" href="https://5xvqigedj8-dsn.algolia.net">


<!-- end custom head snippets -->

  </head>

  <body class="layout--single">

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->

    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        
          <a class="site-logo webfeedsFeaturedVisual" href="/"><img src="/assets/images/edgecloud.png" alt="Edge Cloud"></a>
        
        <a class="site-title" href="/"> On the edge of cloud computing</a>
        <ul class="visible-links">
<li class="masthead__menu-item">
              <a href="/">Home</a>
            </li>
<li class="masthead__menu-item">
              <a href="/tags/#aws">AWS</a>
            </li>
<li class="masthead__menu-item">
              <a href="/tags/#ipv6">IPv6</a>
            </li>
<li class="masthead__menu-item">
              <a href="/tags/">Tags</a>
            </li>
<li class="masthead__menu-item">
              <a href="/about/">About</a>
            </li>
</ul>
        
        <button class="search__toggle" type="button">
          <span class="visually-hidden">Toggle search</span>
          <svg class="icon" width="16" height="16" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 15.99 16">
            <path d="M15.5,13.12L13.19,10.8a1.69,1.69,0,0,0-1.28-.55l-0.06-.06A6.5,6.5,0,0,0,5.77,0,6.5,6.5,0,0,0,2.46,11.59a6.47,6.47,0,0,0,7.74.26l0.05,0.05a1.65,1.65,0,0,0,.5,1.24l2.38,2.38A1.68,1.68,0,0,0,15.5,13.12ZM6.4,2A4.41,4.41,0,1,1,2,6.4,4.43,4.43,0,0,1,6.4,2Z" transform="translate(-.01)"></path>
          </svg>
        </button>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Toggle menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


    <div class="initial-content">
      



<div id="main" role="main">
  
  <div class="sidebar sticky">
  


<div itemscope itemtype="https://schema.org/Person">

  
    <div class="author__avatar">
      

      
        <img src="/assets/images/chriselsen.jpg" alt="Christian Elsen" itemprop="image">
      
    </div>
  

  <div class="author__content">
    
      <h3 class="author__name" itemprop="name">Christian Elsen</h3>
    
    
      <p class="author__bio" itemprop="description">
        Technology Generalist
      </p>
    
  </div>

  <div class="author__urls-wrapper">
    <button class="btn btn--inverse">Follow</button>
    <ul class="author__urls social-icons">
      
        <li itemprop="homeLocation" itemscope itemtype="https://schema.org/Place">
          <i class="fas fa-fw fa-map-marker-alt" aria-hidden="true"></i> <span itemprop="name">San Francisco, CA</span>
        </li>
      

      
        
          
            <li><a href="https://chris.elsen.xyz" rel="noopener noreferrer" target="_blank"><i class="fas fa-fw fa-link" aria-hidden="true"></i> Website</a></li>
          
        
          
            <li><a href="https://twitter.com/ChristianElsen" rel="noopener noreferrer" target="_blank"><i class="fab fa-fw fa-twitter-square" aria-hidden="true"></i> Twitter</a></li>
          
        
          
            <li><a href="https://www.linkedin.com/in/christianelsen/" rel="noopener noreferrer" target="_blank"><i class="fab fa-fw fa-linkedin" aria-hidden="true"></i> LinkedIn</a></li>
          
        
          
            <li><a href="https://github.com/chriselsen/" rel="noopener noreferrer" target="_blank"><i class="fab fa-fw fa-github" aria-hidden="true"></i> GitHub</a></li>
          
        
      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      <!--
  <li>
    <a href="http://link-to-whatever-social-network.com/user/" itemprop="sameAs" rel="nofollow noopener noreferrer">
      <i class="fas fa-fw" aria-hidden="true"></i> Custom Social Profile Link
    </a>
  </li>
-->
    </ul>
  </div>
</div>

  
  </div>


  <article class="page" itemscope itemtype="https://schema.org/CreativeWork">
    <meta itemprop="headline" content="Limitations of Anycast for distributed content delivery">
    <meta itemprop="description" content="Exploring the limitations of Anycast using AWS Global Accelerator and RIPE Atlas, through visualizing the real life results.">
    <meta itemprop="datePublished" content="April 08, 2019">
    

    <div class="page__inner-wrap">
      
        <header>
          <h1 id="page-title" class="page__title" itemprop="headline">Limitations of Anycast for distributed content delivery
</h1>
          
        </header>
      

      <section class="page__content" itemprop="text">
        
          <aside class="sidebar__right ">
            <nav class="toc">
              <header><h4 class="nav__title">
<i class="fas fa-file-alt"></i> On this page</h4></header>
              <ul class="toc__menu">
  <li>
<a href="#anycast">Anycast</a>
    <ul>
      <li><a href="#aws-global-accelerator">AWS Global Accelerator</a></li>
    </ul>
  </li>
  <li><a href="#ripe-atlas">RIPE Atlas</a></li>
  <li>
<a href="#test-setup">Test Setup</a>
    <ul>
      <li><a href="#aws-global-accelerator-setup">AWS Global Accelerator Setup</a></li>
      <li><a href="#ripe-atlas-setup">RIPE Atlas setup</a></li>
    </ul>
  </li>
  <li>
<a href="#test-results">Test Results</a>
    <ul>
      <li><a href="#overview">Overview</a></li>
      <li><a href="#probe-details">Probe Details</a></li>
      <li><a href="#explore-the-geojson">Explore the GeoJSON</a></li>
      <li><a href="#the-good-bad-and-ugly">The good, bad and ugly</a></li>
    </ul>
  </li>
  <li><a href="#summary">Summary</a></li>
</ul>
            </nav>
          </aside>
        
        <p>In the previous article on <a href="/2019/03/01/limitations-of-geo-dns/">Limitations of DNS-based geographic routing</a> we have explored how DNS-based geographic routing works and especially what limitations you have to consider and accept, while using such a solution. In this article we will have a look at using Anycast instead. We will use the same set of origin locations within AWS and <a href="https://atlas.ripe.net/" target="_blank" rel="noopener noreferrer">RIPE Atlas</a> test probes as with the above referenced DNS-based geographic routing setup, to discover limitations of Anycast.</p>

<h1 id="anycast">Anycast</h1>

<p>The network and routing methodology of <a href="https://en.wikipedia.org/wiki/Anycast" target="_blank" rel="noopener noreferrer">Anycast</a> provides multiple routing to multiple endpoints for a single destination. Routers will select the desired path on the basis of number of hops, distance, lowest cost, latency measurements or based on the least congested route. This is in contrary to the typical <a href="https://en.wikipedia.org/wiki/Unicast" target="_blank" rel="noopener noreferrer">Unicast</a> network and routing methodology, where each destination address uniquely identifies a single receiver endpoint (See Figure 1).</p>

<figure class="">








<a href="/content/uploads/2019/04/Anycast.png" title="Figure 1: Unicast vs. Anycast " class="image-popup">
<picture>
  <source width="850" type="image/webp" data-srcset="

    
    /content/resized/2019/04/Anycast-320.webp 320w, 

    
    /content/resized/2019/04/Anycast-384.webp 384w, 

    
    /content/resized/2019/04/Anycast-512.webp 512w, 

    
    /content/resized/2019/04/Anycast-683.webp 683w, 

    
    /content/resized/2019/04/Anycast-800.webp 800w, 

 /content/uploads/2019/04/Anycast.webp 850w" sizes="850px"></source>
  <source width="850" data-srcset="

    /content/resized/2019/04/Anycast-320.png 320w, 

    /content/resized/2019/04/Anycast-384.png 384w, 

    /content/resized/2019/04/Anycast-512.png 512w, 

    /content/resized/2019/04/Anycast-683.png 683w, 

    /content/resized/2019/04/Anycast-800.png 800w, 

 /content/uploads/2019/04/Anycast.png 850w" sizes="850px"></source>
  <img src="//:0" data-src="/content/uploads/2019/04/Anycast.png" class="blur-up lazyautosizes lazyload" alt="Figure 1: Unicast vs. Anycast ">
</picture>
</a>



  <figcaption>Figure 1: Unicast vs. Anycast
</figcaption>

</figure>

<p>Anycast networks are widely used for content delivery network (CDN) products to bring their content closer to the end user, but also large public DNS resolvers make use of this concept.
In the case of e.g. the <a href="https://developers.google.com/speed/public-dns/" target="_blank" rel="noopener noreferrer">Google Public DNS</a> offering, the well-known IPv4 address of 8.8.8.8 is provided via Anycast from hundreds of Google locations, thus providing low latency DNS lookups from around the world.</p>

<h2 id="aws-global-accelerator">AWS Global Accelerator</h2>

<p><a href="https://aws.amazon.com/global-accelerator/" target="_blank" rel="noopener noreferrer">AWS Global Accelerator</a> is a networking service offering from Amazon Web Services that aims at improving the availability and performance of the applications that you offer to your global users. It does so by using Anycast with a set of static IPv4 addresses that act as a fixed entry point into the AWS global network (See Figure 2).</p>

<figure class="">








<a href="/content/uploads/2019/04/Global-Accelerator-Concept.png" title="Figure 2: Concept of AWS Global Accelerator " class="image-popup">
<picture>
  <source width="661" type="image/webp" data-srcset="

    
    /content/resized/2019/04/Global-Accelerator-Concept-320.webp 320w, 

    
    /content/resized/2019/04/Global-Accelerator-Concept-384.webp 384w, 

    
    /content/resized/2019/04/Global-Accelerator-Concept-512.webp 512w, 

 /content/uploads/2019/04/Global-Accelerator-Concept.webp 661w" sizes="661px"></source>
  <source width="661" data-srcset="

    /content/resized/2019/04/Global-Accelerator-Concept-320.png 320w, 

    /content/resized/2019/04/Global-Accelerator-Concept-384.png 384w, 

    /content/resized/2019/04/Global-Accelerator-Concept-512.png 512w, 

 /content/uploads/2019/04/Global-Accelerator-Concept.png 661w" sizes="661px"></source>
  <img src="//:0" data-src="/content/uploads/2019/04/Global-Accelerator-Concept.png" class="blur-up lazyautosizes lazyload" alt="Figure 2: Concept of AWS Global Accelerator ">
</picture>
</a>



  <figcaption>Figure 2: Concept of AWS Global Accelerator
</figcaption>

</figure>

<p>When you set up AWS Global Accelerator, you associate anycasted static IP addresses to regional endpoints - such as Elastic IPv4 addresses, Network Load Balancers, and Application Load Balancers - in one or more AWS Regions. The static anycasted IPv4 addresses accept incoming traffic onto the AWS global network from the edge location that is closest to your users. From there, traffic for your application is routed to the desired AWS endpoint based on several factors, including the user’s location, the health of the endpoint, and the endpoint weights that you configure.</p>

<p class="notice--info"><strong>Note:</strong> AWS Global Accelerator unfortunately does not support IPv6 as of today.</p>

<h1 id="ripe-atlas">RIPE Atlas</h1>

<p>In this post we will use RIPE Atlas to check the performance of a geographic routing enabled DNS entry.</p>

<p><a href="https://atlas.ripe.net/" target="_blank" rel="noopener noreferrer">RIPE Atlas</a> is a global network of hardware devices, called probes and anchors, that actively measure Internet connectivity. Anyone can access this data via Internet traffic maps, streaming data visualisations, and an API. RIPE Atlas users can also perform customised measurements to gain valuable data about their own networks.</p>

<p>I highly recommend you to consider <a href="https://atlas.ripe.net/get-involved/become-a-host/" target="_blank" rel="noopener noreferrer">hosting a RIPE Atlas probe</a> yourself. Not only will you benefit from the data that it collects on your Internet connection, but it will also allow you to run customized measurements against various Internet targets. And in the end every additional RIPE Atlas probe will benefit the overall Internet community.</p>

<p>Here we will be using RIPE Atlas customized measurements to investigate the performance of DNS-based geographic routing.</p>

<h1 id="test-setup">Test Setup</h1>

<p>For this article the test setup will consist of fictional origins where we want to steer traffic to via geographic routing. The test will focus on the US with one origin in the US East coast and one origin in the US West coast.</p>

<p>While investigating DNS-based geographic routing, we were able to leverage the RIPE Atlas <a href="https://atlas.ripe.net/docs/udm/#creating-a-new-measurement" target="_blank" rel="noopener noreferrer">DNS test</a>. Unfortunately here this test won’t provide us the information that we are looking for as Anycast doesn’t depend on DNS. Instead we have to leverage one of the other RIPE Atlas test mechanism. The <a href="https://atlas.ripe.net/docs/udm/#creating-a-new-measurement" target="_blank" rel="noopener noreferrer">SSL test</a> will provide us a mapping of RIPE Atlas probe location to origin endpoint if we assign a different TLS/SSL certificate to each of the two origin locations.</p>

<h2 id="aws-global-accelerator-setup">AWS Global Accelerator Setup</h2>

<p>For this test we will create a single <a href="https://docs.aws.amazon.com/global-accelerator/latest/dg/about-accelerators.html" target="_blank" rel="noopener noreferrer">accelerator</a> within AWS Global Accelerator along with a single <a href="https://docs.aws.amazon.com/global-accelerator/latest/dg/about-listeners.html" target="_blank" rel="noopener noreferrer">Listener</a>. This listener is configured on Port 443 for the protocol TCP, as we want to make use of HTTPS for this test run (See Figure 3).</p>

<figure class="">








<a href="/content/uploads/2019/04/Test-Setup.png" title="Figure 3: Test Setup with AWS Global Accelerator and two origins " class="image-popup">
<picture>
  <source width="585" type="image/webp" data-srcset="

    
    /content/resized/2019/04/Test-Setup-320.webp 320w, 

    
    /content/resized/2019/04/Test-Setup-384.webp 384w, 

    
    /content/resized/2019/04/Test-Setup-512.webp 512w, 

 /content/uploads/2019/04/Test-Setup.webp 585w" sizes="585px"></source>
  <source width="585" data-srcset="

    /content/resized/2019/04/Test-Setup-320.png 320w, 

    /content/resized/2019/04/Test-Setup-384.png 384w, 

    /content/resized/2019/04/Test-Setup-512.png 512w, 

 /content/uploads/2019/04/Test-Setup.png 585w" sizes="585px"></source>
  <img src="//:0" data-src="/content/uploads/2019/04/Test-Setup.png" class="blur-up lazyautosizes lazyload" alt="Figure 3: Test Setup with AWS Global Accelerator and two origins ">
</picture>
</a>



  <figcaption>Figure 3: Test Setup with AWS Global Accelerator and two origins
</figcaption>

</figure>

<p>Before we can add <a href="https://docs.aws.amazon.com/global-accelerator/latest/dg/about-endpoint-groups.html" target="_blank" rel="noopener noreferrer">Endpoint Groups</a> and <a href="https://docs.aws.amazon.com/global-accelerator/latest/dg/about-endpoints.html" target="_blank" rel="noopener noreferrer">Endpoints</a>, we have to actually create these endpoints. And as mentioned before we want to create these endpoints with a separate TLS/SSL certificate, so that we can differentiate to which origin a given RIPE Atlas probe was steered towards.</p>

<p>The easiest approach is to create a <a href="https://aws.amazon.com/elasticloadbalancing/" target="_blank" rel="noopener noreferrer">Network Load Balancer (NLB)</a> with TLS termination and a certificate issued by <a href="https://aws.amazon.com/certificate-manager/" target="_blank" rel="noopener noreferrer">AWS Certificate Manager</a>. Again, keep in mind that the NLB in US-East-2 and the NLB in US-West-2 need to be issued individual certificates for our test.</p>

<p>In real life you would issue either the same or different certificates to the origin endpoint, but leverage the same common name, based on the DNS hostname that you configured for your Anycast addresses. As this is not a production setup, but a test, the actual certificate common name doesn’t matter here.</p>

<h2 id="ripe-atlas-setup">RIPE Atlas setup</h2>

<p>The RIPE Atlas test is configured as a <a href="https://atlas.ripe.net/docs/udm/#creating-a-new-measurement" target="_blank" rel="noopener noreferrer">SSL</a> measurement against one of the anycasted IPv4 addresses of your AWS Global Accelerator setup. As each of the anycasted IPv4 addresses is announced via BGP from the same set of AWS Edge nodes, it is irrelevant which one you pick.</p>

<h1 id="test-results">Test Results</h1>

<h2 id="overview">Overview</h2>

<p>With some Python code the gathered results can easily be turned into a GeoJSON file (See Figure 4).</p>

<figure class="">








<a href="/content/uploads/2019/04/RIPE-Atlas-Probes-Anycast.png" title="Figure 4: Mapping of RIPE Atlas probes to Origins " class="image-popup">
<picture>
  <source type="image/webp" data-srcset="

    
    /content/resized/2019/04/RIPE-Atlas-Probes-Anycast-320.webp 320w, 

    
    /content/resized/2019/04/RIPE-Atlas-Probes-Anycast-384.webp 384w, 

    
    /content/resized/2019/04/RIPE-Atlas-Probes-Anycast-512.webp 512w, 

    
    /content/resized/2019/04/RIPE-Atlas-Probes-Anycast-683.webp 683w, 

    
    /content/resized/2019/04/RIPE-Atlas-Probes-Anycast-800.webp 800w, 

    
    /content/resized/2019/04/RIPE-Atlas-Probes-Anycast-960.webp 960w, 

" sizes="1467px"></source>
  <source data-srcset="

    /content/resized/2019/04/RIPE-Atlas-Probes-Anycast-320.png 320w, 

    /content/resized/2019/04/RIPE-Atlas-Probes-Anycast-384.png 384w, 

    /content/resized/2019/04/RIPE-Atlas-Probes-Anycast-512.png 512w, 

    /content/resized/2019/04/RIPE-Atlas-Probes-Anycast-683.png 683w, 

    /content/resized/2019/04/RIPE-Atlas-Probes-Anycast-800.png 800w, 

    /content/resized/2019/04/RIPE-Atlas-Probes-Anycast-960.png 960w, 

" sizes="1467px"></source>
  <img src="//:0" data-src="/content/uploads/2019/04/RIPE-Atlas-Probes-Anycast.png" class="blur-up lazyautosizes lazyload" alt="Figure 4: Mapping of RIPE Atlas probes to Origins ">
</picture>
</a>



  <figcaption>Figure 4: Mapping of RIPE Atlas probes to Origins
</figcaption>

</figure>

<p>The location of each RIPE Atlas probe as reported by the probe’s host is leveraged in this visualization. The pin representing the location is colored in depending on the result for the Route 53 geographic routing test:</p>

<ul>
  <li>
<strong>Red pin:</strong> Represents a response with the SSL certificate that is assigned to the “US-West-2” origin. Traffic from this probe is therefore served by the AWS US-West-2 (Oregon) region. In this setup this represents 31% of the probes, which is 2 percentage points higher than with DNS-based geographic routing for the same set of probes.</li>
  <li>
<strong>Blue pin:</strong> Represents a response with the SSL certificate that is assigned to the “US-East-2” origin. Traffic from this probe is therefore served by the AWS US-East-2 (Ohio) region. Here this represents 61% of the probes, which is 2 percentage points lower than with DNS-based geographic routing for the same set of probes.</li>
</ul>

<p>We can see that most of the US-East coast based probes are correctly routed to the US-East coast origin (depicted in blue) and most of the US-West coast probes are also correctly routed to the US-West coast origin (depicted in red). But we do see a few blue pins on the US-West coast, meaning that the corresponding probe is routed to the US-East coast instead of the closer US-West coast. Similarly we also see a few red pins on the US-East coast. This clearly shows some non-optimal routing behavior. Later on we will look in more detail into the reasons for this behavior.</p>

<h2 id="probe-details">Probe Details</h2>

<p>The way that I’ve setup the GeoJSON is to also display relevant information for each of the RIPE Atlas Probes (Figure 5).</p>

<figure class="">








<a href="/content/uploads/2019/04/RIPE-Atlas-Probe-Detail.png" title="Figure 5: Detail view of RIPE Atlas probe results " class="image-popup">
<picture>
  <source width="371" type="image/webp" data-srcset="

    
    /content/resized/2019/04/RIPE-Atlas-Probe-Detail-320.webp 320w, 

 /content/uploads/2019/04/RIPE-Atlas-Probe-Detail.webp 371w" sizes="371px"></source>
  <source width="371" data-srcset="

    /content/resized/2019/04/RIPE-Atlas-Probe-Detail-320.png 320w, 

 /content/uploads/2019/04/RIPE-Atlas-Probe-Detail.png 371w" sizes="371px"></source>
  <img src="//:0" data-src="/content/uploads/2019/04/RIPE-Atlas-Probe-Detail.png" class="blur-up lazyautosizes lazyload" alt="Figure 5: Detail view of RIPE Atlas probe results ">
</picture>
</a>



  <figcaption>Figure 5: Detail view of RIPE Atlas probe results
</figcaption>

</figure>

<p>After clicking on one of the pins you’re able to see:</p>

<ul>
  <li>
<strong>Atlas-ID:</strong> The RIPE Atlas ID of the probe linked to RIPE ATLAS API’s “Probe Detail” view.</li>
  <li>
<strong>Traceroute:</strong> Traceroute results from the RIPE Atlas probe to the AWS Edge location serving the anycasted address.</li>
  <li>
<strong>ASN:</strong> <a href="https://en.wikipedia.org/wiki/Autonomous_system_(Internet)" target="_blank" rel="noopener noreferrer">The Autonomous System Number (ASN)</a>, allowing you to identify the Internet Service Provider of the probes host.</li>
  <li>
<strong>Origin:</strong> Result of the certificate lookup against the entry. This will either be “US-West-2” or “US-East-2” and corresponds to the color of the pin.</li>
</ul>

<p>This setup will later help us drill down deeper into some of the RIPE Atlas locations that showed sub-optmal routing behavior.</p>

<h2 id="explore-the-geojson">Explore the GeoJSON</h2>

<p>You can explore this GeoJSON yourself below, as it is published as a <a href="https://gist.github.com/chriselsen/4756c3fb8c4f1ba3b3d14e2c22617665" target="_blank" rel="noopener noreferrer">Gist to Github</a>.</p>

<script src="https://gist.github.com/chriselsen/4756c3fb8c4f1ba3b3d14e2c22617665.js"></script>

<p>Give it a try and see what you’ll discover!</p>

<h2 id="the-good-bad-and-ugly">The good, bad and ugly</h2>

<p>Let’s drill down on two RIPE Atlas probes to explore the limitations of Anycast routing.</p>

<p>The first case is for a probe at the <a href="https://www.psu.edu/" target="_blank" rel="noopener noreferrer">PennState university</a> in University Park, PA. While this location is only around 500 km away from the AWS US-East-2 (Ohio) region and around 4,500 km from the AWS US-West-2 (Oregon) region, the probe is steered to the US-West-2 (Oregon) region by Anycast.
Looking at the Traceroute results for this probe, we can see that it uses the <a href="https://www.internet2.edu/" target="_blank" rel="noopener noreferrer">Internet2 Network</a>, an IP network that delivers network services for research and education. Further we can see that the Internet2 Network peers with AWS at <a href="https://www.seattleix.net/" target="_blank" rel="noopener noreferrer">Seattle Internet Exchange (SIX)</a> in Seattle, WA (See Figure 6).</p>

<figure class="">








<a href="/content/uploads/2019/04/RIPE-Atlas-Internet2.png" title="Figure 6: Example of RIPE Atlas probe on US East Coast preferring the origin in US-West-2 " class="image-popup">
<picture>
  <source width="976" type="image/webp" data-srcset="

    
    /content/resized/2019/04/RIPE-Atlas-Internet2-320.webp 320w, 

    
    /content/resized/2019/04/RIPE-Atlas-Internet2-384.webp 384w, 

    
    /content/resized/2019/04/RIPE-Atlas-Internet2-512.webp 512w, 

    
    /content/resized/2019/04/RIPE-Atlas-Internet2-683.webp 683w, 

    
    /content/resized/2019/04/RIPE-Atlas-Internet2-800.webp 800w, 

    
    /content/resized/2019/04/RIPE-Atlas-Internet2-960.webp 960w, 

 /content/uploads/2019/04/RIPE-Atlas-Internet2.webp 976w" sizes="976px"></source>
  <source width="976" data-srcset="

    /content/resized/2019/04/RIPE-Atlas-Internet2-320.png 320w, 

    /content/resized/2019/04/RIPE-Atlas-Internet2-384.png 384w, 

    /content/resized/2019/04/RIPE-Atlas-Internet2-512.png 512w, 

    /content/resized/2019/04/RIPE-Atlas-Internet2-683.png 683w, 

    /content/resized/2019/04/RIPE-Atlas-Internet2-800.png 800w, 

    /content/resized/2019/04/RIPE-Atlas-Internet2-960.png 960w, 

 /content/uploads/2019/04/RIPE-Atlas-Internet2.png 976w" sizes="976px"></source>
  <img src="//:0" data-src="/content/uploads/2019/04/RIPE-Atlas-Internet2.png" class="blur-up lazyautosizes lazyload" alt="Figure 6: Example of RIPE Atlas probe on US East Coast preferring the origin in US-West-2 ">
</picture>
</a>



  <figcaption>Figure 6: Example of RIPE Atlas probe on US East Coast preferring the origin in US-West-2
</figcaption>

</figure>

<p>Looking at <a href="https://bgp.he.net/AS3999#_peers" target="_blank" rel="noopener noreferrer">ASN 3999</a>, the ASN for the Pennsylvania State University, we can see IPv4 peering with two different Internet2 ASNs. There is <a href="https://bgp.he.net/AS11537#_asinfo" target="_blank" rel="noopener noreferrer">ASN 11537</a>, which participates <a href="https://www.peeringdb.com/net/923" target="_blank" rel="noopener noreferrer">in a single public Internet Exchange</a>. Also there is <a href="https://bgp.he.net/AS11164#_asinfo" target="_blank" rel="noopener noreferrer">ASN 11164</a>, which participates in <a href="https://www.peeringdb.com/net/937" target="_blank" rel="noopener noreferrer">10 public Internet Exchanges</a>.</p>

<p>It appears that the Pennsylvania State University - potentially due to financial reasons - made the decision to route all IPv4 traffic to AWS via ASN 11537 and therefore the Seattle Internet Exchange, leading to increased latency for accessing AWS’ US East coast regions as well as CDN PoPs.</p>

<p>Next we have a RIPE Atlas probe whose host is a customer of <a href="https://www.spectrum.com/" target="_blank" rel="noopener noreferrer">Charter Communications</a>. Here we can see that Charter routes the traffic from this Gillroy, CA based customer via Denver, CA and St. Louis, MO to the AWS Edge at an unknown location (See Figure 7).</p>

<figure class="">








<a href="/content/uploads/2019/04/RIPE-Atlas-Charter.png" title="Figure 7: Example of RIPE Atlas probe on US West Coast preferring the origin in US-East-2 " class="image-popup">
<picture>
  <source width="976" type="image/webp" data-srcset="

    
    /content/resized/2019/04/RIPE-Atlas-Charter-320.webp 320w, 

    
    /content/resized/2019/04/RIPE-Atlas-Charter-384.webp 384w, 

    
    /content/resized/2019/04/RIPE-Atlas-Charter-512.webp 512w, 

    
    /content/resized/2019/04/RIPE-Atlas-Charter-683.webp 683w, 

    
    /content/resized/2019/04/RIPE-Atlas-Charter-800.webp 800w, 

    
    /content/resized/2019/04/RIPE-Atlas-Charter-960.webp 960w, 

 /content/uploads/2019/04/RIPE-Atlas-Charter.webp 976w" sizes="976px"></source>
  <source width="976" data-srcset="

    /content/resized/2019/04/RIPE-Atlas-Charter-320.png 320w, 

    /content/resized/2019/04/RIPE-Atlas-Charter-384.png 384w, 

    /content/resized/2019/04/RIPE-Atlas-Charter-512.png 512w, 

    /content/resized/2019/04/RIPE-Atlas-Charter-683.png 683w, 

    /content/resized/2019/04/RIPE-Atlas-Charter-800.png 800w, 

    /content/resized/2019/04/RIPE-Atlas-Charter-960.png 960w, 

 /content/uploads/2019/04/RIPE-Atlas-Charter.png 976w" sizes="976px"></source>
  <img src="//:0" data-src="/content/uploads/2019/04/RIPE-Atlas-Charter.png" class="blur-up lazyautosizes lazyload" alt="Figure 7: Example of RIPE Atlas probe on US West Coast preferring the origin in US-East-2 ">
</picture>
</a>



  <figcaption>Figure 7: Example of RIPE Atlas probe on US West Coast preferring the origin in US-East-2
</figcaption>

</figure>

<p>Once again this routing decision could be based on financial reasons. Nevertheless Charter’s customer in this case will experience higher latency and therefore a reduced experience as a result of this decision.</p>

<h1 id="summary">Summary</h1>

<p>This article provided a closer look at the limitations of Anycast routing. Using AWS Global Accelerator and RIPE Atlas we were able to visualize the real life results of Anycast-based routing and dive deeper into some of the unwanted effects. Also we were able to contrast these results with a similar DNS-based geographic routing setup.
Similar to the test setup of DNS-based geographic routing, even with an Anycast base approach we see inefficient routings, where customers are directed to leverage an origin across the continental US even though another origin is closer by.
But what performs better, DNS-based geographic routing or traffic steering via Anycast? Overall it appears that both perform in a similar way with each having some corner cases that provide a reduced end-user experience.</p>

        
      </section>

      <footer class="page__meta">
        
        
  


  
  
  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-tags" aria-hidden="true"></i> Tags: </strong>
    <span itemprop="keywords">
    
      
      
      <a href="/tags/#aws" class="page__taxonomy-item" rel="tag">AWS</a><span class="sep">, </span>
    
      
      
      <a href="/tags/#network" class="page__taxonomy-item" rel="tag">Network</a>
    
    </span>
  </p>




        
          <p class="page__date"><strong><i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> Updated:</strong> <time datetime="2019-04-08T00:00:00-07:00">April 08, 2019</time></p>
        
      </footer>

      <section class="page__share">
  
    <h4 class="page__share-title">Share on</h4>
  

  <a href="https://twitter.com/intent/tweet?via=ChristianElsen&amp;text=Limitations+of+Anycast+for+distributed+content+delivery%20https%3A%2F%2Fwww.edge-cloud.net%2F2019%2F04%2F08%2Flimitations-of-anycast%2F" class="btn share-button btn--twitter" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Twitter" target="_blank" rel="noopener noreferrer"><i class="fab fa-fw fa-twitter" aria-hidden="true"></i><span> Twitter</span></a>

  <a href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fwww.edge-cloud.net%2F2019%2F04%2F08%2Flimitations-of-anycast%2F" class="btn share-button btn--facebook" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Facebook" target="_blank" rel="noopener noreferrer"><i class="fab fa-fw fa-facebook" aria-hidden="true"></i><span> Facebook</span></a>

  <a href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3A%2F%2Fwww.edge-cloud.net%2F2019%2F04%2F08%2Flimitations-of-anycast%2F" class="btn share-button btn--linkedin" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on LinkedIn" target="_blank" rel="noopener noreferrer"><i class="fab fa-fw fa-linkedin" aria-hidden="true"></i><span> LinkedIn</span></a>
  
  <a href="https://getpocket.com/save?url=https%3A%2F%2Fwww.edge-cloud.net%2F2019%2F04%2F08%2Flimitations-of-anycast%2F&amp;title=Limitations+of+Anycast+for+distributed+content+delivery" class="btn share-button btn--pocket" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Pocket" target="_blank" rel="noopener noreferrer"><i class="fab fa-fw fa-get-pocket" aria-hidden="true"></i><span> Pocket</span></a>
</section>


      
  <nav class="pagination">
    
      <a href="/2019/03/01/limitations-of-geo-dns/" class="pagination--pager" title="Limitations of DNS-based geographic routing
">Previous</a>
    
    
      <a href="/2019/07/18/aws-site-2-site-vpn-with-strongswan-frrouting/" class="pagination--pager" title="AWS Site-to-Site VPN with IPSec VPN (Strongwan) and BGP (FRRouting)
">Next</a>
    
  </nav>

    </div>

    
  </article>

  
  
    <div class="page__related">
      <h4 class="page__related-title">You may also enjoy</h4>
      <div class="grid__wrapper">
        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="/2020/09/28/understanding-bgp/" rel="permalink">Better understanding BGP
</a>
      
    </h2>
    
    <p class="archive__item-excerpt" itemprop="description">Primer to better understanding BGP
</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="/2020/09/18/understanding-routing/" rel="permalink">Better understanding IP Routing
</a>
      
    </h2>
    
    <p class="archive__item-excerpt" itemprop="description">Look at fundamental principles of IP routing to better design and troubleshoot networks
</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="/2020/09/11/aws-ipsec-vpn-ipv6/" rel="permalink">AWS Site-to-Site VPN (IPSec) with IPv6
</a>
      
    </h2>
    
    <p class="archive__item-excerpt" itemprop="description">How to setup the AWS Site-to-Site VPN (IPSec) with IPv6
</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="/2020/05/01/tgw-multicast-intro/" rel="permalink">Multicast with AWS Transit Gateway
</a>
      
    </h2>
    
    <p class="archive__item-excerpt" itemprop="description">Walkthrough for setup and testing IP Multicast with AWS Transit Gateway (TGW)
</p>
  </article>
</div>

        
      </div>
    </div>
  
  
  
  
  
</div>






    </div>

    
      <div class="search-content">
        <div class="search-content__inner-wrap">
<script src="https://cdn.jsdelivr.net/npm/instantsearch.js@2.3.3/dist/instantsearch.min.js"></script>
    <div class="search-searchbar"></div>
    <div class="search-hits"></div>
</div>

      </div>
    
    
    <div class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->

        <div align="center" class="page__footer-follow">
  <ul class="social-icons">
    
      <li><strong>Follow:</strong></li>
    

    
      
        
          <li><a href="http://twitter.com/ChristianElsen" rel="noopener noreferrer" target="_blank"><i class="fab fa-fw fa-twitter-square" aria-hidden="true"></i> Twitter</a></li>
        
      
        
          <li><a href="https://www.linkedin.com/in/christianelsen/" rel="noopener noreferrer" target="_blank"><i class="fab fa-fw fa-linkedin" aria-hidden="true"></i> LinkedIn</a></li>
        
      
        
          <li><a href="https://github.com/chriselsen/" rel="noopener noreferrer" target="_blank"><i class="fab fa-fw fa-github" aria-hidden="true"></i> Github</a></li>
        
      
    

    <li><a href="/feed.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
  </ul>
</div>

<div align="center" class="page__footer-copyright">© 2013 - 2021 Christian Elsen. <a href="/terms/">Terms &amp; Privacy Policy</a>.</div>

      </footer>
    </div>

    
  <script src="/assets/js/main.min.js"></script>
  <script src="/assets/js/lazysizes.min.js"></script>

  <script defer src="https://use.fontawesome.com/releases/v5.6.0/js/all.js" integrity="sha384-z9ZOvGHHo21RqN5De4rfJMoAxYpaVoiYhuJXPyVmSs8yn20IE3PmBM534CffwSJI" crossorigin="anonymous"></script>





<!-- Including InstantSearch.js library and styling -->
<script async src="https://cdn.jsdelivr.net/npm/instantsearch.js@2.3.3/dist/instantsearch.min.js"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.3.3/dist/instantsearch.min.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.3.3/dist/instantsearch-theme-algolia.min.css">

<script>
// Instanciating InstantSearch.js with Algolia credentials
const search = instantsearch({
  appId: '5XVQIGEDJ8',
  apiKey: '4e0733cbaacd194a6cf59b61024f966f',
  indexName: 'edge-cloud-net',
  searchParameters: {
    restrictSearchableAttributes: [
      'title',
      'content'
    ]
  }
});

const hitTemplate = function(hit) {
  const url = hit.url;
  const title = hit._highlightResult.title.value;
  const content = hit._highlightResult.html.value;

  return `
    <div class="list__item">
      <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
        <h2 class="archive__item-title" itemprop="headline"><a href="${url}">${title}</a></h2>
        <div class="archive__item-excerpt" itemprop="description">${content}</div>
      </article>
    </div>
  `;
}

// Adding searchbar and results widgets
search.addWidget(
  instantsearch.widgets.searchBox({
    container: '.search-searchbar',
    poweredBy: true,
    placeholder: 'Enter your search term...'
  })
);
search.addWidget(
  instantsearch.widgets.hits({
    container: '.search-hits',
    templates: {
      item: hitTemplate
    }
  })
);

// Starting the search
search.start();
</script>





    <script>
  'use strict';

  (function() {
    var commentContainer = document.querySelector('#utterances-comments');

    if (!commentContainer) {
      return;
    }

    var script = document.createElement('script');
    script.setAttribute('src', 'https://utteranc.es/client.js');
    script.setAttribute('repo', 'edge-cloud/www.edge-cloud.net');
    script.setAttribute('issue-term', 'pathname');
    script.setAttribute('theme', 'github-light');
    script.setAttribute('crossorigin', 'anonymous');

    commentContainer.appendChild(script);
  })();
</script>

  



  </body>
</html>
