<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.15.1 by Michael Rose
  Copyright 2013-2019 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>AWS Site-to-Site VPN with IPSec VPN (Strongwan) and BGP (FRRouting) - Edge Cloud</title>
<meta name="description" content="Step-by-step guide to setup an AWS Site-to-Site VPN with Strongswan for IPSec VPN and FRRouting for BGP.">


  <meta name="author" content="Christian Elsen">


<meta property="og:type" content="article">
<meta property="og:locale" content="en_US">
<meta property="og:site_name" content="Edge Cloud">
<meta property="og:title" content="AWS Site-to-Site VPN with IPSec VPN (Strongwan) and BGP (FRRouting)">
<meta property="og:url" content="https://www.edge-cloud.net/2019/07/18/aws-site-2-site-vpn-with-strongswan-frrouting/">

<meta property="og:description" content="Step-by-step guide to setup an AWS Site-to-Site VPN with Strongswan for IPSec VPN and FRRouting for BGP.">


<meta property="og:image" content="https://www.edge-cloud.net/assets/images/og-image.jpg">



<meta name="twitter:site" content="@ChristianElsen">
<meta name="twitter:title" content="AWS Site-to-Site VPN with IPSec VPN (Strongwan) and BGP (FRRouting)">
<meta name="twitter:description" content="Step-by-step guide to setup an AWS Site-to-Site VPN with Strongswan for IPSec VPN and FRRouting for BGP.">
<meta name="twitter:url" content="https://www.edge-cloud.net/2019/07/18/aws-site-2-site-vpn-with-strongswan-frrouting/">
<meta name="twitter:card" content="summary">

<meta name="twitter:image" content="https://www.edge-cloud.net/assets/images/og-image.jpg">




<meta property="article:published_time" content="2019-07-18T00:00:00-07:00">







<link rel="canonical" href="https://www.edge-cloud.net/2019/07/18/aws-site-2-site-vpn-with-strongswan-frrouting/">





  <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "Organization",
      "url": "https://www.edge-cloud.net",
      "logo": "https://www.edge-cloud.net/assets/images/og-image.jpg"
    }
  </script>



  <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "Person",
      "name": "Christian Elsen",
      "url": "https://www.edge-cloud.net",
      "sameAs": ["https://twitter.com/ChristianElsen","https://www.linkedin.com/in/christianelsen/"]
    }
  </script>



  <meta name="google-site-verification" content="ZPKuOb9ie7OuRgxLoRK2REKxFW6bC0_7VaNFcTNQQxM" />





<!-- end _includes/seo.html -->


<link href="/feed.xml" type="application/atom+xml" rel="alternate" title="Edge Cloud Feed">

<!-- https://t.co/dKP3o1e -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">

<!--[if IE ]>
  <style>
    /* old IE unsupported flexbox fixes */
    .greedy-nav .site-title {
      padding-right: 3em;
    }
    .greedy-nav button {
      position: absolute;
      top: 0;
      right: 0;
      height: 100%;
    }
  </style>
<![endif]-->



    <!-- start custom head snippets -->

<!-- insert favicons. use https://realfavicongenerator.net/ -->
<link rel="apple-touch-icon" sizes="180x180" href="/assets/images/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/assets/images/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/assets/images/favicon-16x16.png">
<link rel="manifest" href="/assets/images/site.webmanifest">
<link rel="mask-icon" href="/assets/images/safari-pinned-tab.svg" color="#5bbad5">
<link rel="shortcut icon" href="/assets/images/favicon.ico">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="msapplication-config" content="/assets/images/browserconfig.xml">
<meta name="theme-color" content="#ffffff">

<link rel="preload" href="/assets/js/main.min.js" as="script">
<link rel="preload" href="/assets/js/lazysizes.min.js" as="script">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.3.3/dist/instantsearch.min.js" as="script">

<link rel="preload" href="/assets/css/main.css" as="style">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.3.3/dist/instantsearch.min.css" as="style">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.3.3/dist/instantsearch-theme-algolia.min.css" as="style">

<link rel="dns-prefetch" href="https://www.google-analytics.com">
<link rel="dns-prefetch" href="https://googleads.g.doubleclick.net">
<link rel="dns-prefetch" href="https://pagead2.googlesyndication.com">
<link rel="dns-prefetch" href="https://adservice.google.com">
<link rel="dns-prefetch" href="http://5xvqigedj8-dsn.algolia.net">

<link rel="preconnnect" href="https://www.google-analytics.com">
<link rel="preconnnect" href="https://googleads.g.doubleclick.net">
<link rel="preconnnect" href="https://pagead2.googlesyndication.com">
<link rel="preconnnect" href="https://adservice.google.com">
<link rel="preconnnect" href="https://5xvqigedj8-dsn.algolia.net">

<!-- end custom head snippets -->

  </head>

  <body class="layout--single">

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->

    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        
          <a class="site-logo webfeedsFeaturedVisual" href="/"><img src="/assets/images/edgecloud.png" alt="Edge Cloud"></a>
        
        <a class="site-title" href="/"> On the edge of cloud computing</a>
        <ul class="visible-links">
<li class="masthead__menu-item">
              <a href="/">Home</a>
            </li>
<li class="masthead__menu-item">
              <a href="/tags/#aws">AWS</a>
            </li>
<li class="masthead__menu-item">
              <a href="/tags/#ipv6">IPv6</a>
            </li>
<li class="masthead__menu-item">
              <a href="/tags/">Tags</a>
            </li>
<li class="masthead__menu-item">
              <a href="/about/">About</a>
            </li>
</ul>
        
        <button class="search__toggle" type="button">
          <span class="visually-hidden">Toggle search</span>
          <svg class="icon" width="16" height="16" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 15.99 16">
            <path d="M15.5,13.12L13.19,10.8a1.69,1.69,0,0,0-1.28-.55l-0.06-.06A6.5,6.5,0,0,0,5.77,0,6.5,6.5,0,0,0,2.46,11.59a6.47,6.47,0,0,0,7.74.26l0.05,0.05a1.65,1.65,0,0,0,.5,1.24l2.38,2.38A1.68,1.68,0,0,0,15.5,13.12ZM6.4,2A4.41,4.41,0,1,1,2,6.4,4.43,4.43,0,0,1,6.4,2Z" transform="translate(-.01)"></path>
          </svg>
        </button>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Toggle menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


    <div class="initial-content">
      



<div id="main" role="main">
  
  <div class="sidebar sticky">
  


<div itemscope itemtype="https://schema.org/Person">

  
    <div class="author__avatar">
      

      
        <img src="/assets/images/chriselsen.jpg" alt="Christian Elsen" itemprop="image">
      
    </div>
  

  <div class="author__content">
    
      <h3 class="author__name" itemprop="name">Christian Elsen</h3>
    
    
      <p class="author__bio" itemprop="description">
        Technology Generalist
      </p>
    
  </div>

  <div class="author__urls-wrapper">
    <button class="btn btn--inverse">Follow</button>
    <ul class="author__urls social-icons">
      
        <li itemprop="homeLocation" itemscope itemtype="https://schema.org/Place">
          <i class="fas fa-fw fa-map-marker-alt" aria-hidden="true"></i> <span itemprop="name">San Francisco, CA</span>
        </li>
      

      
        
          
            <li><a href="https://chris.elsen.xyz" rel="noopener noreferrer" target="_blank"><i class="fas fa-fw fa-link" aria-hidden="true"></i> Website</a></li>
          
        
          
            <li><a href="https://twitter.com/ChristianElsen" rel="noopener noreferrer" target="_blank"><i class="fab fa-fw fa-twitter-square" aria-hidden="true"></i> Twitter</a></li>
          
        
          
            <li><a href="https://www.linkedin.com/in/christianelsen/" rel="noopener noreferrer" target="_blank"><i class="fab fa-fw fa-linkedin" aria-hidden="true"></i> LinkedIn</a></li>
          
        
          
            <li><a href="https://github.com/chriselsen/" rel="noopener noreferrer" target="_blank"><i class="fab fa-fw fa-github" aria-hidden="true"></i> GitHub</a></li>
          
        
      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      <!--
  <li>
    <a href="http://link-to-whatever-social-network.com/user/" itemprop="sameAs" rel="nofollow noopener noreferrer">
      <i class="fas fa-fw" aria-hidden="true"></i> Custom Social Profile Link
    </a>
  </li>
-->
    </ul>
  </div>
</div>

  
  </div>


  <article class="page" itemscope itemtype="https://schema.org/CreativeWork">
    <meta itemprop="headline" content="AWS Site-to-Site VPN with IPSec VPN (Strongwan) and BGP (FRRouting)">
    <meta itemprop="description" content="Step-by-step guide to setup an AWS Site-to-Site VPN with Strongswan for IPSec VPN and FRRouting for BGP.">
    <meta itemprop="datePublished" content="July 18, 2019">
    

    <div class="page__inner-wrap">
      
        <header>
          <h1 id="page-title" class="page__title" itemprop="headline">AWS Site-to-Site VPN with IPSec VPN (Strongwan) and BGP (FRRouting)
</h1>
          
        </header>
      

      <section class="page__content" itemprop="text">
        
          <aside class="sidebar__right ">
            <nav class="toc">
              <header><h4 class="nav__title">
<i class="fas fa-file-alt"></i> On this page</h4></header>
              <ul class="toc__menu">
  <li>
<a href="#aws-transit-gateway">AWS Transit Gateway</a>
    <ul>
      <li><a href="#transit-gateway-and-site-to-site-vpn-setup">Transit Gateway and Site-to-Site VPN setup</a></li>
    </ul>
  </li>
  <li>
<a href="#linux-based-router">Linux-based Router</a>
    <ul>
      <li>
<a href="#interface-setup">Interface Setup</a>
        <ul>
          <li><a href="#source-or-destination-checking">Source or Destination checking</a></li>
          <li><a href="#security-group-setup">Security Group setup</a></li>
        </ul>
      </li>
      <li>
<a href="#strongswan-setup">Strongswan setup</a>
        <ul>
          <li><a href="#strongswan-validation">Strongswan validation</a></li>
        </ul>
      </li>
      <li><a href="#frrouting-setup">FRRouting Setup</a></li>
    </ul>
  </li>
  <li>
<a href="#validation">Validation</a>
    <ul>
      <li><a href="#ec2-based-router">EC2-Based Router</a></li>
      <li><a href="#aws-console">AWS Console</a></li>
    </ul>
  </li>
  <li><a href="#summary">Summary</a></li>
</ul>
            </nav>
          </aside>
        
        <p>This blog post walks through the setup of an EC2-based VPN endpoint - using Ubuntu Linux 18.04 with <a href="https://www.strongswan.org/" target="_blank" rel="noopener noreferrer">Strongswan</a> and <a href="https://frrouting.org/" target="_blank" rel="noopener noreferrer">FRRouting</a> - for a Site-to-Site VPN connection to AWS with <a href="https://en.wikipedia.org/wiki/Border_Gateway_Protocol" target="_blank" rel="noopener noreferrer">BGP</a> routing.
It will allow you to experiment with BGP in your AWS account, test out new AWS features such as <a href="https://aws.amazon.com/transit-gateway/" target="_blank" rel="noopener noreferrer">AWS Transit Gateway</a> or use it for many other things.
Especially if you are interested in learning more about the interaction of BGP over a Site-to-Site VPN with AWS Transit Gateway, this is an easy way to do so.</p>

<p>The desired final setup will look like depicted in Figure 1. The AWS Transit Gateway connects on one side to a VPC with the CIDR 172.31.0.0/16 and on the other side to an <a href="https://docs.aws.amazon.com/vpn/latest/s2svpn/VPC_VPN.html" target="_blank" rel="noopener noreferrer">AWS Site-to-Site VPN</a>. This AWS Site-to-Site VPN connects to an EC2-based router, which uses Strongswan for IPSec and FRRouting for BGP. To make things interesting the EC2-based router has a second network interface on a private subnet of 10.16.16.0/24, which can be announced via BGP.</p>

<figure class="">








<a href="/content/uploads/2019/07/EC2-Based-Router-BGP.png" title="Figure 1: Setup Overview of EC2-based VPN endpoint for Site-to-Site VPN with AWS " class="image-popup">
<picture>
  <source type="image/webp" data-srcset="

    
    /content/resized/2019/07/EC2-Based-Router-BGP-320.webp 320w, 

    
    /content/resized/2019/07/EC2-Based-Router-BGP-384.webp 384w, 

    
    /content/resized/2019/07/EC2-Based-Router-BGP-512.webp 512w, 

    
    /content/resized/2019/07/EC2-Based-Router-BGP-683.webp 683w, 

    
    /content/resized/2019/07/EC2-Based-Router-BGP-800.webp 800w, 

    
    /content/resized/2019/07/EC2-Based-Router-BGP-960.webp 960w, 

" sizes="1792px"></source>
  <source data-srcset="

    /content/resized/2019/07/EC2-Based-Router-BGP-320.png 320w, 

    /content/resized/2019/07/EC2-Based-Router-BGP-384.png 384w, 

    /content/resized/2019/07/EC2-Based-Router-BGP-512.png 512w, 

    /content/resized/2019/07/EC2-Based-Router-BGP-683.png 683w, 

    /content/resized/2019/07/EC2-Based-Router-BGP-800.png 800w, 

    /content/resized/2019/07/EC2-Based-Router-BGP-960.png 960w, 

" sizes="1792px"></source>
  <img src="//:0" data-src="/content/uploads/2019/07/EC2-Based-Router-BGP.png" class="blur-up lazyautosizes lazyload" alt="Figure 1: Setup Overview of EC2-based VPN endpoint for Site-to-Site VPN with AWS ">
</picture>
</a>



  <figcaption>Figure 1: Setup Overview of EC2-based VPN endpoint for Site-to-Site VPN with AWS
</figcaption>

</figure>

<p>While Transit Gateway and EC2 instance can reside in the same AWS account and even AWS region, the EC2 instance should reside in a different VPC than connected to the Transit Gateway.</p>

<h1 id="aws-transit-gateway">AWS Transit Gateway</h1>

<p><a href="https://aws.amazon.com/transit-gateway/" target="_blank" rel="noopener noreferrer">AWS Transit Gateway</a> is a service that enables customers to connect their Amazon Virtual Private Clouds (VPCs) and their on-premises networks to a single gateway. For on-premises connectivity the AWS Transit Gateway allows you to leverage AWS Site-to-Site VPNs (IPSec) or AWS Direct Connect via <a href="https://docs.aws.amazon.com/directconnect/latest/UserGuide/Welcome.html" target="_blank" rel="noopener noreferrer">AWS Direct Connect Gateways</a> (See Figure 2).</p>

<figure class="">








<a href="/content/uploads/2019/07/AWS-Transit-GW.png" title="Figure 2: AWS Transit Gateway provides dynamic routing between VPCs, Site-to-Site VPNs, and AWS Direct Connect Gateways " class="image-popup">
<picture>
  <source width="1185" type="image/webp" data-srcset="

    
    /content/resized/2019/07/AWS-Transit-GW-320.webp 320w, 

    
    /content/resized/2019/07/AWS-Transit-GW-384.webp 384w, 

    
    /content/resized/2019/07/AWS-Transit-GW-512.webp 512w, 

    
    /content/resized/2019/07/AWS-Transit-GW-683.webp 683w, 

    
    /content/resized/2019/07/AWS-Transit-GW-800.webp 800w, 

    
    /content/resized/2019/07/AWS-Transit-GW-960.webp 960w, 

 /content/uploads/2019/07/AWS-Transit-GW.webp 1185w" sizes="1185px"></source>
  <source width="1185" data-srcset="

    /content/resized/2019/07/AWS-Transit-GW-320.png 320w, 

    /content/resized/2019/07/AWS-Transit-GW-384.png 384w, 

    /content/resized/2019/07/AWS-Transit-GW-512.png 512w, 

    /content/resized/2019/07/AWS-Transit-GW-683.png 683w, 

    /content/resized/2019/07/AWS-Transit-GW-800.png 800w, 

    /content/resized/2019/07/AWS-Transit-GW-960.png 960w, 

 /content/uploads/2019/07/AWS-Transit-GW.png 1185w" sizes="1185px"></source>
  <img src="//:0" data-src="/content/uploads/2019/07/AWS-Transit-GW.png" class="blur-up lazyautosizes lazyload" alt="Figure 2: AWS Transit Gateway provides dynamic routing between VPCs, Site-to-Site VPNs, and AWS Direct Connect Gateways ">
</picture>
</a>



  <figcaption>Figure 2: AWS Transit Gateway provides dynamic routing between VPCs, Site-to-Site VPNs, and AWS Direct Connect Gateways
</figcaption>

</figure>

<p>A transit gateway acts as a regional virtual router for traffic flowing between your virtual private clouds (VPC) and VPN or DX connections. A transit gateway scales elastically based on the volume of network traffic. Routing through a transit gateway operates at layer 3, where the packets are sent to a specific next-hop attachment, based on their destination IP addresses.</p>

<p>The AWS Transit Gateway’s hub and spoke model simplifies management and reduces operational costs because each network only has to connect to the Transit Gateway and not to every other network. Any new VPC is simply connected to the Transit Gateway and is then automatically available to every other network that is connected to the Transit Gateway. This ease of connectivity makes it easy to scale your network as you grow.</p>

<h2 id="transit-gateway-and-site-to-site-vpn-setup">Transit Gateway and Site-to-Site VPN setup</h2>

<p>Follow the AWS documentation for <a href="https://docs.aws.amazon.com/vpc/latest/tgw/tgw-getting-started.html" target="_blank" rel="noopener noreferrer">setting up the AWS Transit Gateway</a> and <a href="https://docs.aws.amazon.com/vpc/latest/tgw/tgw-vpn-attachments.html" target="_blank" rel="noopener noreferrer">attaching it to an AWS Site-to-Site VPN</a>.</p>

<p>It is recommended to configure <em>“VPN ECMP support”</em> with <em>“enable”</em> to enable <a href="https://docs.aws.amazon.com/vpc/latest/tgw/tgw-transit-gateways.html" target="_blank" rel="noopener noreferrer">Equal Cost Multipath (ECMP) routing support between VPN connections</a>. This will allow you to use both tunnels of the AWS Sit-to-Site VPN connection at the same time.</p>

<h1 id="linux-based-router">Linux-based Router</h1>

<p>This setup uses Ubuntu 16.04-LTS, Xenial Xerus as the Linux distribution for the EC2-based VPN gateway and router. <a href="https://www.strongswan.org/" target="_blank" rel="noopener noreferrer">Strongswan</a> provides the IPSec termination for the AWS Site-to-Site VPN connection. And <a href="https://frrouting.org/" target="_blank" rel="noopener noreferrer">FRRouting</a> provides the dynamic routing capabilities for BGP.</p>

<h2 id="interface-setup">Interface Setup</h2>

<p>As mentioned earlier the Ubuntu Linux EC2 instance uses a secondary network interface on a private subnet. This subnet is announced via BGP towards the AWS Transit Gateway. AWS Premium Support provides a detailed instruction on <a href="https://aws.amazon.com/premiumsupport/knowledge-center/ec2-ubuntu-secondary-network-interface/" target="_blank" rel="noopener noreferrer">how to make a secondary network interface work in Ubuntu EC2 instances</a>. The presented concepts are used here.</p>

<p>First create a configuration file for the secondary interface at <em>/etc/network/interfaces.d/99-eth1.cfg</em>. his example uses a secondary interface of ‘eth1’. Be sure to change ‘eth1’ to match your secondary interface name.</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>#
# /etc/network/interfaces.d/99-eth1.cfg
#

auto eth1
iface eth1 inet dhcp

# control-alias eth0
iface eth1 inet6 dhcp

</code></pre></div></div>

<p>Next create the restrict-default-gw file to prevent the default gateway from being overwritten on the main table via the <em>/etc/dhcp/dhclient-enter-hooks.d/restrict-default-gw</em> file.</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>#
# /etc/dhcp/dhclient-enter-hooks.d/restrict-default-gw
#

case ${interface} in
  eth0)
    ;;
  *)
    unset new_routers
    ;;
esac

</code></pre></div></div>

<p>After restarting your network the secondary interface should acquire an IPv4 and IPv6 address.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@host:~# systemctl restart networking
root@host:~# ifconfig eth1
eth1      Link encap:Ethernet  HWaddr 02:7b:35:90:92:ae
          inet addr:10.16.16.254  Bcast:10.16.16.255  Mask:255.255.255.0
          inet6 addr: fe80::7b:35ff:fe90:92ae/64 Scope:Link
          inet6 addr: 2600:1f16:f2d:1211:2c35:28f7:7d5d:f776/128 Scope:Global
          UP BROADCAST RUNNING MULTICAST  MTU:9001  Metric:1
          RX packets:9081 errors:0 dropped:0 overruns:0 frame:0
          TX packets:2143 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:1000
          RX bytes:854331 (854.3 KB)  TX bytes:213798 (213.7 KB)
</code></pre></div></div>

<h3 id="source-or-destination-checking">Source or Destination checking</h3>

<p>In AWS the Source or Destination checking attribute on an interface determines whether an instance can handle network traffic that isn’t specifically destined for the instance.</p>

<p>Before installing Strongswan on your EC2 instance <a href="https://docs.aws.amazon.com/vpc/latest/userguide/VPC_NAT_Instance.html#EIP_Disable_SrcDestCheck" target="_blank" rel="noopener noreferrer">disable Source/Destination Checks</a> for this instance.
Keep in mind that this needs to be done for both interfaces (ENIs) separately.</p>

<h3 id="security-group-setup">Security Group setup</h3>

<p>Within the security group for the external interface: Make sure to allow inbound traffic using UDP port 500 (ISAKMP) and 4500 (IPsec NAT-Traversal) from both of the AWS Virtual Private Gateways.</p>

<p>For the security group on the internal interface: Here you want to allow any traffic that you want to be transported inside of the AWS Site-to-Site VPN tunnels.</p>

<h2 id="strongswan-setup">Strongswan setup</h2>

<p>Next use <em>apt-get update &amp;&amp; apt-get install -y strongswan</em> to install Strongswan on the Ubuntu Linux 16.04 instance.</p>

<p>Update the configuration file <em>/etc/ipsec.conf</em> with generic settings for an AWS Site-to-Site VPN, as well as the specific settings for the two tunnels that each AWS Site-to-Site VPN provides.
 Make sure to replace the relevant IPv4 addresses from this example with your IPv4 addresses.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> #
 # /etc/ipsec.conf
 #
 conn %default
         # Authentication Method : Pre-Shared Key
         leftauth=psk
         rightauth=psk
         # Encryption Algorithm : aes-128-cbc
         # Authentication Algorithm : sha1
         # Perfect Forward Secrecy : Diffie-Hellman Group 2
         ike=aes128-sha1-modp1024!
         # Lifetime : 28800 seconds
         ikelifetime=28800s
         # Phase 1 Negotiation Mode : main
         aggressive=no
         # Protocol : esp
         # Encryption Algorithm : aes-128-cbc
         # Authentication Algorithm : hmac-sha1-96
         # Perfect Forward Secrecy : Diffie-Hellman Group 2
         esp=aes128-sha1-modp1024!
         # Lifetime : 3600 seconds
         lifetime=3600s
         # Mode : tunnel
         type=tunnel
         # DPD Interval : 10
         dpddelay=10s
         # DPD Retries : 3
         dpdtimeout=30s
         # Tuning Parameters for AWS Virtual Private Gateway:
         keyexchange=ikev1
         rekey=yes
         reauth=no
         dpdaction=restart
         closeaction=restart
         leftsubnet=0.0.0.0/0,::/0
         rightsubnet=0.0.0.0/0,::/0
         leftupdown=/etc/ipsec-vti.sh
         installpolicy=yes
         compress=no
         mobike=no
conn AWS-VPC-GW1
         # Customer Gateway: :
         left=10.16.1.254
         leftid=18.123.45.67
         # Virtual Private Gateway :
         right=35.98.76.54
         rightid=35.98.76.54
         auto=start
         mark=100
         #reqid=1
conn AWS-VPC-GW2
         # Customer Gateway: :
         left=10.16.1.254
         leftid=18.123.45.67
         # Virtual Private Gateway :
         right=54.98.76.54
         rightid=54.98.76.54
         auto=start
         mark=200
</code></pre></div></div>

<p>Next update the configuration file <em>/etc/ipsec.secrets</em> with the Pre-Shared Keys of your AWS Site-to-Site VPN. Here also ensure that you update the IPv4 addresses from this example with the IPv4 addresses of your setup.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>#
# /etc/ipsec.secrets
#

# This file holds shared secrets or RSA private keys for authentication.

# RSA private key for this host, authenticating it to any other host
# which knows the public part.
18.123.45.67 35.98.76.54 : PSK "7?-Mun7^XC3JUswf$f$mm=8s@v2U=-aG"
18.123.45.67 54.98.76.54 : PSK "!yTF%t$nQTwp++6rB9#qft?Vfa%KAhnU"
</code></pre></div></div>

<p>As we want to run a dynamic routing protocol with BGP over this AWS Site-to-Site VPN, we need to use a <a href="https://wiki.strongswan.org/projects/strongswan/wiki/RouteBasedVPN" target="_blank" rel="noopener noreferrer">route-based VPN</a> setup instead of a policy-based one.</p>

<p>The bash script in file <strong>/etc/ipsec-vti.sh</strong> sets up the virtual tunnel interfaces for a route-based IPSec VPN. Also here make sure to replace the IPv4 addresses of this example with the IPv4 addresses of your setup.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>#!/bin/bash

#
# /etc/ipsec-vti.sh
#

IP=$(which ip)
IPTABLES=$(which iptables)

PLUTO_MARK_OUT_ARR=(${PLUTO_MARK_OUT//// })
PLUTO_MARK_IN_ARR=(${PLUTO_MARK_IN//// })
case "$PLUTO_CONNECTION" in
AWS-VPC-GW1)
VTI_INTERFACE=vti1
VTI_LOCALADDR=169.254.12.38/30
VTI_REMOTEADDR=169.254.12.37/30
;;
AWS-VPC-GW2)
VTI_INTERFACE=vti2
VTI_LOCALADDR=169.254.14.230/30
VTI_REMOTEADDR=169.254.14.229/30
;;
esac

case "${PLUTO_VERB}" in
up-client)
#$IP tunnel add ${VTI_INTERFACE} mode vti local ${PLUTO_ME} remote ${PLUTO_PEER} okey ${PLUTO_MARK_OUT_ARR[0]} ikey ${PLUTO_MARK_IN_ARR[0]}
$IP link add ${VTI_INTERFACE} type vti local ${PLUTO_ME} remote ${PLUTO_PEER} okey ${PLUTO_MARK_OUT_ARR[0]} ikey ${PLUTO_MARK_IN_ARR[0]}
sysctl -w net.ipv4.conf.${VTI_INTERFACE}.disable_policy=1
sysctl -w net.ipv4.conf.${VTI_INTERFACE}.rp_filter=2 || sysctl -w net.ipv4.conf.${VTI_INTERFACE}.rp_filter=0
$IP addr add ${VTI_LOCALADDR} remote ${VTI_REMOTEADDR} dev ${VTI_INTERFACE}
$IP link set ${VTI_INTERFACE} up mtu 1436
$IPTABLES -t mangle -I FORWARD -o ${VTI_INTERFACE} -p tcp -m tcp --tcp-flags SYN,RST SYN -j TCPMSS --clamp-mss-to-pmtu
$IPTABLES -t mangle -I INPUT -p esp -s ${PLUTO_PEER} -d ${PLUTO_ME} -j MARK --set-xmark ${PLUTO_MARK_IN}
$IP route flush table 220
#/etc/init.d/bgpd reload || /etc/init.d/quagga force-reload bgpd
;;
down-client)
#$IP tunnel del ${VTI_INTERFACE}
$IP link del ${VTI_INTERFACE}
$IPTABLES -t mangle -D FORWARD -o ${VTI_INTERFACE} -p tcp -m tcp --tcp-flags SYN,RST SYN -j TCPMSS --clamp-mss-to-pmtu
$IPTABLES -t mangle -D INPUT -p esp -s ${PLUTO_PEER} -d ${PLUTO_ME} -j MARK --set-xmark ${PLUTO_MARK_IN}
;;
esac

# Enable IPv4 forwarding
sysctl -w net.ipv4.ip_forward=1
sysctl -w net.ipv4.conf.eth0.disable_xfrm=1
sysctl -w net.ipv4.conf.eth0.disable_policy=1

</code></pre></div></div>

<p>As this is a bash script, don’t forget to make the file executable:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>chmod +x /etc/ipsec-vti.sh
</code></pre></div></div>

<p>Afterwards restart the Strongwan daemon to load the configuration changes and establish the tunnels:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>systemctl restart strongswan
</code></pre></div></div>

<h3 id="strongswan-validation">Strongswan validation</h3>

<p>You can validate that the two tunnel interfaces vti1 and vti2 are up and running with the commands <code class="language-plaintext highlighter-rouge">ip -s tunnel show</code> or
<code class="language-plaintext highlighter-rouge">ifconfig vti1</code>. You should see the IP address of the tunnels displayed within the 169.254.0.0/16 range.</p>

<p>Looing at the tunnel status you should see bytes being send (TX) and received (RX) for both tunnels.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ubuntu@host:~$ ip -s tunnel show
vti1: ip/ip remote 35.98.76.54 local 18.123.45.67 ttl inherit nopmtudisc key 100
RX: Packets    Bytes        Errors CsumErrs OutOfSeq Mcasts
    12         792          0      0        0        0
TX: Packets    Bytes        Errors DeadLoop NoRoute  NoBufs
    12         714          7      0        7        0
vti2: ip/ip remote 54.98.76.54 local 18.123.45.67 ttl inherit nopmtudisc key 200
RX: Packets    Bytes        Errors CsumErrs OutOfSeq Mcasts
    4          240          0      0        0        0
TX: Packets    Bytes        Errors DeadLoop NoRoute  NoBufs
    4          160          7      0        7        0
ip_vti0: ip/ip remote any local any ttl inherit nopmtudisc key 0
RX: Packets    Bytes        Errors CsumErrs OutOfSeq Mcasts
    0          0            0      0        0        0
TX: Packets    Bytes        Errors DeadLoop NoRoute  NoBufs
    0          0            0      0        0        0
</code></pre></div></div>

<p>Similarly you should see the interface in an “UP” state.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ubuntu@host:~$ ifconfig vti1
vti1: flags=209&lt;UP,POINTOPOINT,RUNNING,NOARP&gt;  mtu 1436
        inet 169.254.12.38  netmask 255.255.255.252  destination 169.254.12.37
        inet6 fe80::5efe:ac1f:27e0  prefixlen 64  scopeid 0x20&lt;link&gt;
        tunnel   txqueuelen 1000  (IPIP Tunnel)
        RX packets 12  bytes 792 (792.0 B)
        RX errors 0  dropped 0  overruns 0  frame 0
        TX packets 12  bytes 714 (714.0 B)
        TX errors 7  dropped 0 overruns 0  carrier 7  collisions 0
</code></pre></div></div>

<h2 id="frrouting-setup">FRRouting Setup</h2>

<p>Follow the FFRouting <a href="http://docs.frrouting.org/projects/dev-guide/en/latest/building-frr-for-ubuntu1804.html" target="_blank" rel="noopener noreferrer">documentation</a> for installing FFRouting on Ubuntu 18.04 or have a look at my <a href="https://gist.github.com/chriselsen/a0aec32f615da8047fbd04e6afca305b" target="_blank" rel="noopener noreferrer">installation script</a>.</p>

<p>When configuring the <em>/etc/frr/daemons</em> file, ensure to enable the <em>bgpd</em> daemon.</p>

<p>You can now connect via the vtysh Modal CLI to the router process.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ubuntu@host:~$ sudo vtysh

Hello, this is FRRouting (version 4.0+cl3u10).
Copyright 1996-2005 Kunihiro Ishiguro, et al.

</code></pre></div></div>

<p>First we configure the BGP process with the provided AS number and the two VPN-based peers. We also chose to announce our local private subnet 10.16.16.0/24.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>host# conf t
host(config)# router bgp 65016
host(config-router)# bgp ebgp-requires-policy
host(config-router)# neighbor 169.254.12.229 remote-as 64512
host(config-router)# neighbor 169.254.14.37 remote-as 64512
host(config-router)# address-family ipv4 unicast
host(config-router-af)# neighbor 169.254.12.229 soft-reconfiguration inbound
host(config-router-af)# neighbor 169.254.14.37 soft-reconfiguration inbound
host(config-router-af)# network 10.16.16.0/24
host(config-router-af)# end
host# wr
</code></pre></div></div>

<p>Next we can check if all interfaces are up and running. Besides eth0 and eth1 with IPv4 and IPv6 addresses, we should also see vti1 and vti2 for the IPSec tunnel interfacces.</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>host# sh int brief
Interface       Status  VRF             Addresses
---------       ------  ---             ---------
eth0            up      default         10.16.1.254/24
                                        + 2600:1f16:e4d:1a01:fbe6:fa0b:929b:4d72/128
eth1            up      default         10.16.16.254/24
                                        + 2600:1f16:e4d:1a11:2c38:23f7:7a5d:f773/128
ip_vti0         down    default
lo              up      default
vti1            up      default         169.254.12.38/32
vti2            up      default         169.254.14.230/32

</code></pre></div></div>

<h1 id="validation">Validation</h1>

<h2 id="ec2-based-router">EC2-Based Router</h2>

<p>Now it’s time to validate that the AWS Transit Gateway is providing us with routes over BGP. Here we can see that the route for the VPC attached to the Transit Gateway is propagated via BGP to us.</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>host# sh ip route bgp
Codes: K - kernel route, C - connected, S - static, R - RIP,
       O - OSPF, I - IS-IS, B - BGP, E - EIGRP, N - NHRP,
       T - Table, v - VNC, V - VNC-Direct, A - Babel, D - SHARP,
       F - PBR,
       &gt; - selected route, * - FIB route

B&gt;* 172.31.0.0/16 [20/100] via 169.254.14.229, vti2, 00:23:10
  *                        via 169.254.12.37, vti1, 00:23:10
</code></pre></div></div>

<p>Notice that in case you configured the AWS Transit Gateway with <a href="https://en.wikipedia.org/wiki/Equal-cost_multi-path_routing" target="_blank" rel="noopener noreferrer">Equal-cost multi-path routing (ECMP)</a>, you will see the remote VPCs CIDR of 172.31.0.0/16 announced over both AWS Site-to-Site VPN tunnels.</p>

<h2 id="aws-console">AWS Console</h2>

<p>Within the AWS Console you should also be able to see the VPN connections for both tunnels in the state “UP” and should see 1 BGP route - which is the 10.16.16.0/24 network to be received over each tunnel (See Figure 3).</p>

<figure class="">








<a href="/content/uploads/2019/07/AWS-VPN-Up.jpg" title="Figure 3: AWS Site-to-Site VPN showing as &lt;strong&gt;UP&lt;/strong&gt; with routes being received. " class="image-popup">
<picture>
  <source width="855" type="image/webp" data-srcset="

    
    /content/resized/2019/07/AWS-VPN-Up-320.webp 320w, 

    
    /content/resized/2019/07/AWS-VPN-Up-384.webp 384w, 

    
    /content/resized/2019/07/AWS-VPN-Up-512.webp 512w, 

    
    /content/resized/2019/07/AWS-VPN-Up-683.webp 683w, 

    
    /content/resized/2019/07/AWS-VPN-Up-800.webp 800w, 

 /content/uploads/2019/07/AWS-VPN-Up.webp 855w" sizes="855px"></source>
  <source width="855" data-srcset="

    /content/resized/2019/07/AWS-VPN-Up-320.jpg 320w, 

    /content/resized/2019/07/AWS-VPN-Up-384.jpg 384w, 

    /content/resized/2019/07/AWS-VPN-Up-512.jpg 512w, 

    /content/resized/2019/07/AWS-VPN-Up-683.jpg 683w, 

    /content/resized/2019/07/AWS-VPN-Up-800.jpg 800w, 

 /content/uploads/2019/07/AWS-VPN-Up.jpg 855w" sizes="855px"></source>
  <img src="//:0" data-src="/content/uploads/2019/07/AWS-VPN-Up.jpg" class="blur-up lazyautosizes lazyload" alt="Figure 3: AWS Site-to-Site VPN showing as &lt;strong&gt;UP&lt;/strong&gt; with routes being received. ">
</picture>
</a>



  <figcaption>Figure 3: AWS Site-to-Site VPN showing as <strong>UP</strong> with routes being received.
</figcaption>

</figure>

<p>At this point you are all set and your VPN connection along with BGP routing is ready to be used.</p>

<h1 id="summary">Summary</h1>

<p>This blog post showed you the setup of an EC2-based VPN endpoint while using Ubuntu Linux 16.04 with Strongswan for a Site-to-Site VPN connection and and FRRouting for BGP. This setup allows you to experiment with BGP in your AWS account. Especially if you are interested in learning more about the interaction of BGP over a Site-to-Site VPN with AWS Transit Gateway, the resulting setup is a great start to do so.</p>

        
      </section>

      <footer class="page__meta">
        
        
  


  
  
  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-tags" aria-hidden="true"></i> Tags: </strong>
    <span itemprop="keywords">
    
      
      
      <a href="/tags/#aws" class="page__taxonomy-item" rel="tag">AWS</a><span class="sep">, </span>
    
      
      
      <a href="/tags/#network" class="page__taxonomy-item" rel="tag">Network</a>
    
    </span>
  </p>




        
          <p class="page__date"><strong><i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> Updated:</strong> <time datetime="2019-07-18T00:00:00-07:00">July 18, 2019</time></p>
        
      </footer>

      <section class="page__share">
  
    <h4 class="page__share-title">Share on</h4>
  

  <a href="https://twitter.com/intent/tweet?via=ChristianElsen&amp;text=AWS+Site-to-Site+VPN+with+IPSec+VPN+%28Strongwan%29+and+BGP+%28FRRouting%29%20https%3A%2F%2Fwww.edge-cloud.net%2F2019%2F07%2F18%2Faws-site-2-site-vpn-with-strongswan-frrouting%2F" class="btn share-button btn--twitter" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Twitter" target="_blank" rel="noopener noreferrer"><i class="fab fa-fw fa-twitter" aria-hidden="true"></i><span> Twitter</span></a>

  <a href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fwww.edge-cloud.net%2F2019%2F07%2F18%2Faws-site-2-site-vpn-with-strongswan-frrouting%2F" class="btn share-button btn--facebook" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Facebook" target="_blank" rel="noopener noreferrer"><i class="fab fa-fw fa-facebook" aria-hidden="true"></i><span> Facebook</span></a>

  <a href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3A%2F%2Fwww.edge-cloud.net%2F2019%2F07%2F18%2Faws-site-2-site-vpn-with-strongswan-frrouting%2F" class="btn share-button btn--linkedin" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on LinkedIn" target="_blank" rel="noopener noreferrer"><i class="fab fa-fw fa-linkedin" aria-hidden="true"></i><span> LinkedIn</span></a>
  
  <a href="https://getpocket.com/save?url=https%3A%2F%2Fwww.edge-cloud.net%2F2019%2F07%2F18%2Faws-site-2-site-vpn-with-strongswan-frrouting%2F&amp;title=AWS+Site-to-Site+VPN+with+IPSec+VPN+%28Strongwan%29+and+BGP+%28FRRouting%29" class="btn share-button btn--pocket" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Pocket" target="_blank" rel="noopener noreferrer"><i class="fab fa-fw fa-get-pocket" aria-hidden="true"></i><span> Pocket</span></a>
</section>


      
  <nav class="pagination">
    
      <a href="/2019/04/08/limitations-of-anycast/" class="pagination--pager" title="Limitations of Anycast for distributed content delivery
">Previous</a>
    
    
      <a href="/2019/08/07/bgp-route-summary-with-tgw/" class="pagination--pager" title="BGP route summarization with AWS Transit Gateway
">Next</a>
    
  </nav>

    </div>

    
  </article>

  
  
    <div class="page__related">
      <h4 class="page__related-title">You may also enjoy</h4>
      <div class="grid__wrapper">
        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="/2020/09/28/understanding-bgp/" rel="permalink">Better understanding BGP
</a>
      
    </h2>
    
    <p class="archive__item-excerpt" itemprop="description">Primer to better understanding BGP
</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="/2020/09/18/understanding-routing/" rel="permalink">Better understanding IP Routing
</a>
      
    </h2>
    
    <p class="archive__item-excerpt" itemprop="description">Look at fundamental principles of IP routing to better design and troubleshoot networks
</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="/2020/09/11/aws-ipsec-vpn-ipv6/" rel="permalink">AWS Site-to-Site VPN (IPSec) with IPv6
</a>
      
    </h2>
    
    <p class="archive__item-excerpt" itemprop="description">How to setup the AWS Site-to-Site VPN (IPSec) with IPv6
</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="/2020/05/01/tgw-multicast-intro/" rel="permalink">Multicast with AWS Transit Gateway
</a>
      
    </h2>
    
    <p class="archive__item-excerpt" itemprop="description">Walkthrough for setup and testing IP Multicast with AWS Transit Gateway (TGW)
</p>
  </article>
</div>

        
      </div>
    </div>
  
  
  
  
  
</div>






    </div>

    
      <div class="search-content">
        <div class="search-content__inner-wrap">
<script src="https://cdn.jsdelivr.net/npm/instantsearch.js@2.3.3/dist/instantsearch.min.js"></script>
    <div class="search-searchbar"></div>
    <div class="search-hits"></div>
</div>

      </div>
    
    
    <div class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->

        <div align="center" class="page__footer-follow">
  <ul class="social-icons">
    
      <li><strong>Follow:</strong></li>
    

    
      
        
          <li><a href="http://twitter.com/ChristianElsen" rel="noopener noreferrer" target="_blank"><i class="fab fa-fw fa-twitter-square" aria-hidden="true"></i> Twitter</a></li>
        
      
        
          <li><a href="https://www.linkedin.com/in/christianelsen/" rel="noopener noreferrer" target="_blank"><i class="fab fa-fw fa-linkedin" aria-hidden="true"></i> LinkedIn</a></li>
        
      
        
          <li><a href="https://github.com/chriselsen/" rel="noopener noreferrer" target="_blank"><i class="fab fa-fw fa-github" aria-hidden="true"></i> Github</a></li>
        
      
    

    <li><a href="/feed.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
  </ul>
</div>

<div align="center" class="page__footer-copyright">© 2013 - 2021 Christian Elsen. <a href="/terms/">Terms &amp; Privacy Policy</a>.</div>

      </footer>
    </div>

    
  <script src="/assets/js/main.min.js"></script>
  <script src="/assets/js/lazysizes.min.js"></script>

  <script defer src="https://use.fontawesome.com/releases/v5.6.0/js/all.js" integrity="sha384-z9ZOvGHHo21RqN5De4rfJMoAxYpaVoiYhuJXPyVmSs8yn20IE3PmBM534CffwSJI" crossorigin="anonymous"></script>





<!-- Including InstantSearch.js library and styling -->
<script async src="https://cdn.jsdelivr.net/npm/instantsearch.js@2.3.3/dist/instantsearch.min.js"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.3.3/dist/instantsearch.min.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.3.3/dist/instantsearch-theme-algolia.min.css">

<script>
// Instanciating InstantSearch.js with Algolia credentials
const search = instantsearch({
  appId: '5XVQIGEDJ8',
  apiKey: '4e0733cbaacd194a6cf59b61024f966f',
  indexName: 'edge-cloud-net',
  searchParameters: {
    restrictSearchableAttributes: [
      'title',
      'content'
    ]
  }
});

const hitTemplate = function(hit) {
  const url = hit.url;
  const title = hit._highlightResult.title.value;
  const content = hit._highlightResult.html.value;

  return `
    <div class="list__item">
      <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
        <h2 class="archive__item-title" itemprop="headline"><a href="${url}">${title}</a></h2>
        <div class="archive__item-excerpt" itemprop="description">${content}</div>
      </article>
    </div>
  `;
}

// Adding searchbar and results widgets
search.addWidget(
  instantsearch.widgets.searchBox({
    container: '.search-searchbar',
    poweredBy: true,
    placeholder: 'Enter your search term...'
  })
);
search.addWidget(
  instantsearch.widgets.hits({
    container: '.search-hits',
    templates: {
      item: hitTemplate
    }
  })
);

// Starting the search
search.start();
</script>





    <script>
  'use strict';

  (function() {
    var commentContainer = document.querySelector('#utterances-comments');

    if (!commentContainer) {
      return;
    }

    var script = document.createElement('script');
    script.setAttribute('src', 'https://utteranc.es/client.js');
    script.setAttribute('repo', 'edge-cloud/www.edge-cloud.net');
    script.setAttribute('issue-term', 'pathname');
    script.setAttribute('theme', 'github-light');
    script.setAttribute('crossorigin', 'anonymous');

    commentContainer.appendChild(script);
  })();
</script>

  



  </body>
</html>
