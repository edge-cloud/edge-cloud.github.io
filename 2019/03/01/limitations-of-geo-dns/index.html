<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.15.1 by Michael Rose
  Copyright 2013-2019 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>Limitations of DNS-based geographic routing - Edge Cloud</title>
<meta name="description" content="Exploring the limitations of DNS-based geographic routing using AWS Route 53 and RIPE Atlas, through visualizing the real life results.">


  <meta name="author" content="Christian Elsen">


<meta property="og:type" content="article">
<meta property="og:locale" content="en_US">
<meta property="og:site_name" content="Edge Cloud">
<meta property="og:title" content="Limitations of DNS-based geographic routing">
<meta property="og:url" content="https://www.edge-cloud.net/2019/03/01/limitations-of-geo-dns/">


  <meta property="og:description" content="Exploring the limitations of DNS-based geographic routing using AWS Route 53 and RIPE Atlas, through visualizing the real life results.">



  <meta property="og:image" content="https://www.edge-cloud.net/assets/images/og-image.jpg">

<meta property="og:image:width" content="198">
<meta property="og:image:height" content="297">


  <meta name="twitter:site" content="@ChristianElsen">
  <meta name="twitter:title" content="Limitations of DNS-based geographic routing">
  <meta name="twitter:description" content="Exploring the limitations of DNS-based geographic routing using AWS Route 53 and RIPE Atlas, through visualizing the real life results.">
  <meta name="twitter:url" content="https://www.edge-cloud.net/2019/03/01/limitations-of-geo-dns/">

  
    <meta name="twitter:card" content="summary">
    
      <meta name="twitter:image" content="https://www.edge-cloud.net/assets/images/og-image.jpg">
    
  

  



  <meta property="article:published_time" content="2019-03-01T00:00:00-08:00">





  

  


<link rel="canonical" href="https://www.edge-cloud.net/2019/03/01/limitations-of-geo-dns/">





  <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "Organization",
      "url": "https://www.edge-cloud.net",
      "logo": "https://www.edge-cloud.net/assets/images/og-image.jpg"
    }
  </script>



  <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "Person",
      "name": "Christian Elsen",
      "url": "https://www.edge-cloud.net",
      "sameAs": ["https://twitter.com/ChristianElsen","https://www.linkedin.com/in/christianelsen/"]
    }
  </script>



  <meta name="google-site-verification" content="ZPKuOb9ie7OuRgxLoRK2REKxFW6bC0_7VaNFcTNQQxM" />





<!-- end _includes/seo.html -->


<link href="/feed.xml" type="application/atom+xml" rel="alternate" title="Edge Cloud Feed">

<!-- https://t.co/dKP3o1e -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">

<!--[if IE ]>
  <style>
    /* old IE unsupported flexbox fixes */
    .greedy-nav .site-title {
      padding-right: 3em;
    }
    .greedy-nav button {
      position: absolute;
      top: 0;
      right: 0;
      height: 100%;
    }
  </style>
<![endif]-->



    <!-- start custom head snippets -->

<!-- insert favicons. use https://realfavicongenerator.net/ -->
<link rel="apple-touch-icon" sizes="180x180" href="/assets/images/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/assets/images/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/assets/images/favicon-16x16.png">
<link rel="manifest" href="/assets/images/site.webmanifest">
<link rel="mask-icon" href="/assets/images/safari-pinned-tab.svg" color="#5bbad5">
<link rel="shortcut icon" href="/assets/images/favicon.ico">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="msapplication-config" content="/assets/images/browserconfig.xml">
<meta name="theme-color" content="#ffffff">

<link rel="preload" href="/assets/js/main.min.js" as="script">
<link rel="preload" href="/assets/js/lazysizes.min.js" as="script">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.3.3/dist/instantsearch.min.js" as="script">

<link rel="preload" href="/assets/css/main.css" as="style">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.3.3/dist/instantsearch.min.css" as="style">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.3.3/dist/instantsearch-theme-algolia.min.css" as="style">

<link rel="dns-prefetch" href="https://www.google-analytics.com">
<link rel="dns-prefetch" href="https://googleads.g.doubleclick.net">
<link rel="dns-prefetch" href="https://pagead2.googlesyndication.com">
<link rel="dns-prefetch" href="https://adservice.google.com">
<link rel="dns-prefetch" href="http://5xvqigedj8-dsn.algolia.net">

<link rel="preconnnect" href="https://www.google-analytics.com">
<link rel="preconnnect" href="https://googleads.g.doubleclick.net">
<link rel="preconnnect" href="https://pagead2.googlesyndication.com">
<link rel="preconnnect" href="https://adservice.google.com">
<link rel="preconnnect" href="http://5xvqigedj8-dsn.algolia.net">


<!-- end custom head snippets -->

  </head>

  <body class="layout--single">

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->

    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        
          <a class="site-logo" href="/"><img src="/assets/images/edgecloud.png" alt="Edge Cloud"></a>
        
        <a class="site-title" href="/"> On the edge of cloud computing</a>
        <ul class="visible-links">
<li class="masthead__menu-item">
              <a href="/">Home</a>
            </li>
<li class="masthead__menu-item">
              <a href="/tags/#aws">AWS</a>
            </li>
<li class="masthead__menu-item">
              <a href="/tags/#ipv6">IPv6</a>
            </li>
<li class="masthead__menu-item">
              <a href="/tags/">Tags</a>
            </li>
<li class="masthead__menu-item">
              <a href="/about/">About</a>
            </li>
</ul>
        
        <button class="search__toggle" type="button">
          <span class="visually-hidden">Toggle search</span>
          <svg class="icon" width="16" height="16" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 15.99 16">
            <path d="M15.5,13.12L13.19,10.8a1.69,1.69,0,0,0-1.28-.55l-0.06-.06A6.5,6.5,0,0,0,5.77,0,6.5,6.5,0,0,0,2.46,11.59a6.47,6.47,0,0,0,7.74.26l0.05,0.05a1.65,1.65,0,0,0,.5,1.24l2.38,2.38A1.68,1.68,0,0,0,15.5,13.12ZM6.4,2A4.41,4.41,0,1,1,2,6.4,4.43,4.43,0,0,1,6.4,2Z" transform="translate(-.01)"></path>
          </svg>
        </button>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Toggle menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


    <div class="initial-content">
      



<div id="main" role="main">
  
  <div class="sidebar sticky">
  


<div itemscope itemtype="https://schema.org/Person">

  
    <div class="author__avatar">
      

      
        <img src="/assets/images/chriselsen.jpg" alt="Christian Elsen" itemprop="image">
      
    </div>
  

  <div class="author__content">
    
      <h3 class="author__name" itemprop="name">Christian Elsen</h3>
    
    
      <p class="author__bio" itemprop="description">
        Technology Generalist
      </p>
    
  </div>

  <div class="author__urls-wrapper">
    <button class="btn btn--inverse">Follow</button>
    <ul class="author__urls social-icons">
      
        <li itemprop="homeLocation" itemscope itemtype="https://schema.org/Place">
          <i class="fas fa-fw fa-map-marker-alt" aria-hidden="true"></i> <span itemprop="name">San Francisco, CA</span>
        </li>
      

      
        
          
            <li><a href="https://chris.elsen.xyz" rel="noopener noreferrer" target="_blank"><i class="fas fa-fw fa-link" aria-hidden="true"></i> Website</a></li>
          
        
          
            <li><a href="https://twitter.com/ChristianElsen" rel="noopener noreferrer" target="_blank"><i class="fab fa-fw fa-twitter-square" aria-hidden="true"></i> Twitter</a></li>
          
        
          
            <li><a href="https://www.linkedin.com/in/christianelsen/" rel="noopener noreferrer" target="_blank"><i class="fab fa-fw fa-linkedin" aria-hidden="true"></i> LinkedIn</a></li>
          
        
          
            <li><a href="https://github.com/chriselsen/" rel="noopener noreferrer" target="_blank"><i class="fab fa-fw fa-github" aria-hidden="true"></i> GitHub</a></li>
          
        
      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      <!--
  <li>
    <a href="http://link-to-whatever-social-network.com/user/" itemprop="sameAs" rel="nofollow noopener noreferrer">
      <i class="fas fa-fw" aria-hidden="true"></i> Custom Social Profile Link
    </a>
  </li>
-->
    </ul>
  </div>
</div>

  
  </div>


  <article class="page" itemscope itemtype="https://schema.org/CreativeWork">
    <meta itemprop="headline" content="Limitations of DNS-based geographic routing">
    <meta itemprop="description" content="Exploring the limitations of DNS-based geographic routing using AWS Route 53 and RIPE Atlas, through visualizing the real life results.">
    <meta itemprop="datePublished" content="March 01, 2019">
    

    <div class="page__inner-wrap">
      
        <header>
          <h1 id="page-title" class="page__title" itemprop="headline">Limitations of DNS-based geographic routing
</h1>
          
        </header>
      

      <section class="page__content" itemprop="text">
        
          <aside class="sidebar__right ">
            <nav class="toc">
              <header><h4 class="nav__title">
<i class="fas fa-file-alt"></i> On this page</h4></header>
              <ul class="toc__menu">
  <li>
<a href="#geographic-routing">Geographic Routing</a>
    <ul>
      <li><a href="#limitations-of-the-dns-resolver-location-information">Limitations of the DNS Resolver location information</a></li>
      <li><a href="#edns0-client-subnet-extension">EDNS0-Client-Subnet extension</a></li>
    </ul>
  </li>
  <li><a href="#ripe-atlas">RIPE Atlas</a></li>
  <li>
<a href="#test-setup">Test Setup</a>
    <ul>
      <li><a href="#amazon-route-53-setup">Amazon Route 53 Setup</a></li>
      <li><a href="#ripe-atlas-setup">RIPE Atlas setup</a></li>
    </ul>
  </li>
  <li>
<a href="#test-results">Test Results</a>
    <ul>
      <li><a href="#overview">Overview</a></li>
      <li><a href="#probe-details">Probe Details</a></li>
      <li><a href="#explore-the-geojson">Explore the GeoJSON</a></li>
      <li><a href="#the-good-bad-and-ugly">The good, bad and ugly</a></li>
    </ul>
  </li>
  <li><a href="#summary">Summary</a></li>
</ul>
            </nav>
          </aside>
        
        <p>Various Internet services and offerings - such as <a href="https://aws.amazon.com/cloudfront/" target="_blank" rel="noopener noreferrer">AWS CloudFront </a> - rely on geographic routing, also known as geolocation or geo-locational routing. And with <a href="https://aws.amazon.com/route53/" target="_blank" rel="noopener noreferrer">Amazon Route 53</a> you can build your own geographic routing enabled services. The basic concept behind this capability is to return a DNS answer for an endpoint that is physically closest to the requestor. In the case of AWS CloudFront this would be the closest <a href="https://aws.amazon.com/cloudfront/features/" target="_blank" rel="noopener noreferrer">edge location</a>, while for a service that you build yourself it might be the decision between an <a href="https://aws.amazon.com/elasticloadbalancing/" target="_blank" rel="noopener noreferrer">Amazon Elastic Load Balancer</a> endpoint in the us-west-2 (Oregon) or in the us-east-2 (Ohio) region.</p>

<p>This post will look at how geographic routing works, how you can validate the interaction of it with your service and what the expected limitations of the service are.</p>

<h1 id="geographic-routing">Geographic Routing</h1>
<p>To understand how geographic routing works we first need to have a look at <a href="https://en.wikipedia.org/wiki/Domain_Name_System#Address_resolution_mechanism" target="_blank" rel="noopener noreferrer">DNS resolution</a> via <a href="https://en.wikipedia.org/wiki/Domain_Name_System#DNS_resolvers" target="_blank" rel="noopener noreferrer">DNS Resolver</a>. Figure 1 shows a simplified representation of this mechanism, where a client connects to a local DNS Resolver, which then initiates and sequences the queries that ultimately lead to a full resolution (translation) of the resource sought. While depicted in an overly simplified way, this includes querying the Authoritative Nameserver for the interested record by the DNS Resolver.</p>

<figure class="">








<a href="/content/uploads/2019/02/DNS-Resolver.png" title="Figure 1: DNS Resolver and authoritative name server " class="image-popup">
<picture>
  <source width="600" type="image/webp" data-srcset="

    
    /content/resized/2019/02/DNS-Resolver-320.webp 320w, 

    
    /content/resized/2019/02/DNS-Resolver-384.webp 384w, 

    
    /content/resized/2019/02/DNS-Resolver-512.webp 512w, 

 /content/uploads/2019/02/DNS-Resolver.webp 600w" sizes="600px"></source>
  <source width="600" data-srcset="

    /content/resized/2019/02/DNS-Resolver-320.png 320w, 

    /content/resized/2019/02/DNS-Resolver-384.png 384w, 

    /content/resized/2019/02/DNS-Resolver-512.png 512w, 

 /content/uploads/2019/02/DNS-Resolver.png 600w" sizes="600px"></source>
  <img src="//:0" data-src="/content/uploads/2019/02/DNS-Resolver.png" class="blur-up lazyautosizes lazyload" alt="Figure 1: DNS Resolver and authoritative name server ">
</picture>
</a>



  <figcaption>Figure 1: DNS Resolver and authoritative name server
</figcaption>

</figure>

<p>For geographic routing the “magic” happens during this interaction of the DNS Resolver and the Authoritative Nameserver: The Authoritative Nameserver will respond with a record set that depends on the querying DNS Resolver, ideally its location. In order to accomplish this, the Authoritative Nameserver must be able to calculate the desired mapping based on the location information of the DNS Resolver and the desired mapping of a certain location to an origins record set.</p>

<p>With this the Authoritative Nameserver would e.g. respond to the querry for <code class="highlighter-rouge">www.example.com</code> with <code class="highlighter-rouge">us-west-2.www.example.com</code> (and its subsequent resolution to an actual IPv4 or IPv6 address), while the DNS Resolver’s IP address is believed to be closer to the AWS Oregon region and with <code class="highlighter-rouge">us-east-2.www.example.com</code>, in case the Resolver is closer to the AWS Ohio region.</p>

<p>To do so, the Authoritative Nameserver will use the IP address information for the DNS Resolver to calculate the geographic location. A common service provider for IP Address to location mapping data is <a href="https://www.maxmind.com/" target="_blank" rel="noopener noreferrer">Maxmind</a>, which is frequently used for this purpose. An example is the Howto Guide for <a href="https://geoip.site/" target="_blank" rel="noopener noreferrer">implementing geographical routing with BIND</a>, which incorporates this GeoIP database.</p>

<p>And while AWS does not publicly divulge information about the source of the used IP address mapping data, Amazon Route 53 uses the same principle.</p>

<h2 id="limitations-of-the-dns-resolver-location-information">Limitations of the DNS Resolver location information</h2>

<p>At this point you probably already guessed that the Authoritative Nameserver making a routing decision based on the DNS Resolvers location might not be the best approach. That’s because Client and Authoritative Nameserver might not actually be geographically close to each other. What if a client in San Francisco, CA is using a DNS Resolver in New York, NY? While we would want this client to be served by e.g. a CDN Edge location in the San Francisco, CA area, due to the location information attached to the DNS Resolver, that client is actually served by a CDN Edge location in New York, NY.</p>

<p>Looking at Figure 1 again, we can see that the cause for this undesired behavior is that the Authoritative Nameserver only “sees” the DNS Resolver via its IP source address. The Authoritative Nameserver is not aware of the client and therefore has no knowledge of its location. Wouldn’t it be great if the Authoritative Nameserver actually received information about the Client as part of the query request? This would allow the Authoritative Nameserver to respond based on the geolocation location information of the Client instead of the DNS Resolver. That’s where ENDS0-Client-Subnet (ECS) comes into the picture.</p>

<h2 id="edns0-client-subnet-extension">EDNS0-Client-Subnet extension</h2>

<p><a href="https://tools.ietf.org/html/rfc6891" target="_blank" rel="noopener noreferrer">EDNS0</a> is an extension mechanism for the DNS, which expands the size of several parameters of the DNS protocol for increasing functionality of the protocol. One such increased functionality is <a href="https://tools.ietf.org/html/rfc7871" target="_blank" rel="noopener noreferrer">EDNS0-Client-Subnet (ECS)</a>.
The EDNS0-Client-Subnet (ECS) extension allows a recursive DNS Resolver to specify the network subnet for the host on which behalf it is making a DNS query. Therefore the Authoritative Nameserver will gain insight into the location of the client based on GeoIP information.</p>

<p>Unfortunately not all DNS Resolvers support EDNS0-Client-Subnet. You can find support in frequently used public resolvers, such as <a href="https://developers.google.com/speed/public-dns/docs/ecs" target="_blank" rel="noopener noreferrer">Google’s Public DNS</a> Resolver, <a href="http://www.afasterinternet.com/" target="_blank" rel="noopener noreferrer">OpenDNS</a>, and <a href="https://www.quad9.net/faq/" target="_blank" rel="noopener noreferrer">Quad9</a>. Other public resolvers such as <a href="https://developers.cloudflare.com/1.1.1.1/nitty-gritty-details/" target="_blank" rel="noopener noreferrer">CloudFlare</a> do not support it.</p>

<p>If you want to check if your Resolver supports EDNS0-Client-Subnet (ECS), you can use a special Google debugging hostname as outlined in the AWS Support article <a href="https://aws.amazon.com/premiumsupport/knowledge-center/troubleshoot-latency-based-records/" target="_blank" rel="noopener noreferrer">“How do I troubleshoot issues with latency-based resource records and Route 53?”</a>. With this hostname the command <code class="highlighter-rouge">dig +nocl TXT o-o.myaddr.l.google.com @&lt;DNS Resolver&gt;</code> will not only show you the IPv4 or IPv6 address of the DNS Resolver that is seen by Google’s Authoritative Nameserver. If supported it will also show the client subnet as provided via EDNS0-Client-Subnet (ECS).</p>

<p>Below is an example run from an Amazon EC2 instance within the US-West-2 (Oregon) region against the <a href="https://developers.google.com/speed/public-dns/docs/intro" target="_blank" rel="noopener noreferrer">Google Public DNS resolver</a>:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ubuntu@ubuntu:~$ dig +nocl +short TXT o-o.myaddr.l.google.com @8.8.8.8
"2607:f8b0:400e:c09::10f"
"edns0-client-subnet 54.186.33.212/32"
</code></pre></div></div>

<p>We can clearly see that Google’s Resolver supports EDNS0-Client-Subnet (ECS).</p>

<p>Similarly on the CDN side support to actually leverage the EDNS0-Client-Subnet provided information is not universal. Amazon CloudFront <a href="https://aws.amazon.com/about-aws/whats-new/2014/04/02/amazon-cloudfront-announces-support-for-edns-client-subnet/" target="_blank" rel="noopener noreferrer">added support in 2014</a>.
Also <a href="https://docs.aws.amazon.com/Route53/latest/DeveloperGuide/routing-policy.html#routing-policy-edns0" target="_blank" rel="noopener noreferrer">Amazon Route 53 supports EDNS0-Client-Subnet</a> as part of routing policies.</p>

<h1 id="ripe-atlas">RIPE Atlas</h1>

<p>In this post we will use RIPE Atlas to check the performance of a geographic routing enabled DNS entry.</p>

<p><a href="https://atlas.ripe.net/" target="_blank" rel="noopener noreferrer">RIPE Atlas</a> is a global network of hardware devices, called probes and anchors, that actively measure Internet connectivity. Anyone can access this data via Internet traffic maps, streaming data visualisations, and an API. RIPE Atlas users can also perform customised measurements to gain valuable data about their own networks.</p>

<p>I highly recommend you to consider <a href="https://atlas.ripe.net/get-involved/become-a-host/" target="_blank" rel="noopener noreferrer">hosting a RIPE Atlas probe</a> yourself. Not only will you benefit from the data that it collects on your Internet connection, but it will also allow you to run customized measurements against various Internet targets. And in the end every additional RIPE Atlas probe will benefit the overall Internet community.</p>

<p>Here we will be using RIPE Atlas customized measurements to investigate the performance of DNS-based geographic routing.</p>

<h1 id="test-setup">Test Setup</h1>

<h2 id="amazon-route-53-setup">Amazon Route 53 Setup</h2>

<p>For this article the test setup will consist of fictional origins where we want to steer traffic to via geographic routing. The test will focus on the US with one origin in the US East coast and one origin in the US West coast.</p>

<p>A third origin will be placed into Kansas. With IP location based data a mostly unknown lake in Kansas takes over a special meaning: <a href="https://en.wikipedia.org/wiki/Cheney_Reservoir" target="_blank" rel="noopener noreferrer">The Cheney Reservoir</a> is close to the geographical center of the continental US. As such the IP location company <a href="https://www.maxmind.com/" target="_blank" rel="noopener noreferrer">Maxmind</a> places all IP addresses for which it has no more information than that it is located somewhere in the US, at this location. It is estimated that over 600 Million Internet IP addresses point to Cheney Reservoir.
In the past Maxmind placed these IP addresses into the backyard of a Kansas family, whose life was <a href="https://www.theguardian.com/technology/2016/aug/09/maxmind-mapping-lawsuit-kansas-farm-ip-address" target="_blank" rel="noopener noreferrer">turned upside down</a> as a result.</p>

<p>We will model this setup with AWS Route 53 <a href="https://docs.aws.amazon.com/Route53/latest/DeveloperGuide/routing-policy.html#routing-policy-geoproximity" target="_blank" rel="noopener noreferrer">Geoproximity routing</a>, where the AWS regions US-East-2 (Ohio) - as the US East coast location - and US-West-2 (Oregon) - as the US West coast location - receive neutral bias of 0. The origin at Cheney Reservoir receives a large negative bias, to create a small circle of a few miles around this area.</p>

<p>The expected geoproximity routing should look like depicted in Figure 2.</p>

<figure class="">








<a href="/content/uploads/2019/02/R53_Setup.png" title="Figure 2: Desired Geoproximity Routing " class="image-popup">
<picture>
  <source width="753" type="image/webp" data-srcset="

    
    /content/resized/2019/02/R53_Setup-320.webp 320w, 

    
    /content/resized/2019/02/R53_Setup-384.webp 384w, 

    
    /content/resized/2019/02/R53_Setup-512.webp 512w, 

    
    /content/resized/2019/02/R53_Setup-683.webp 683w, 

 /content/uploads/2019/02/R53_Setup.webp 753w" sizes="753px"></source>
  <source width="753" data-srcset="

    /content/resized/2019/02/R53_Setup-320.png 320w, 

    /content/resized/2019/02/R53_Setup-384.png 384w, 

    /content/resized/2019/02/R53_Setup-512.png 512w, 

    /content/resized/2019/02/R53_Setup-683.png 683w, 

 /content/uploads/2019/02/R53_Setup.png 753w" sizes="753px"></source>
  <img src="//:0" data-src="/content/uploads/2019/02/R53_Setup.png" class="blur-up lazyautosizes lazyload" alt="Figure 2: Desired Geoproximity Routing ">
</picture>
</a>



  <figcaption>Figure 2: Desired Geoproximity Routing
</figcaption>

</figure>

<p>The idea behind this test setup is to create a TXT DNS record which will return one of possible three results depending on the Client DNS resolver and EDNS0-Client-Subnet provided location:</p>
<ul>
  <li>
<strong>US-West-2</strong> for clients or resolvers located closest to the AWS region US-West-2 (Oregon) based on IP Geolocation data.</li>
  <li>
<strong>US-East-2</strong> for clients or resolvers located closest to the AWS region US-East-2 (Ohio) based on IP Geolocation data.</li>
  <li>
<strong>Unknown</strong> for clients or resolvers where IP Geolocation data only indicates them to be somewhere in the US and therefore places them into Kansas.</li>
</ul>

<p>In the test setup here the “Unknown” location for IP Geolocation data (yellow dot in Figure 2) is within the area that would be steered towards the US-East coast origin. Therefore even clients located in Portland, OR might get directed to the Ohio origin if their resolver’s or EDNS0-provided client subnet cannot be correctly located.
Breaking these clients out separately in the test setup will allow us to visualize this issue later.</p>

<h2 id="ripe-atlas-setup">RIPE Atlas setup</h2>

<p>Next we create a <a href="https://atlas.ripe.net/about/customised-measurements/" target="_blank" rel="noopener noreferrer">RIPE Atlas customized measurement</a> that will leverage up to 500 randomly selected probes within the US against the DNS hostname that was setup for geographic routing with Route 53 above. We expect each probe to report back a result of either “US-West-2”, “US-East-2”, or “Unknown”.</p>

<p>Similar the same set of up to 500 US-based RIPE Atlas probes will be used in a second customized DNS measurement. This measurement will resolve the above introduced TXT-based record for thr special hostname of <code class="highlighter-rouge">TXT o-o.myaddr.l.google.com</code>. With this RIPE Atlas measurement we can find out for each probe whether EDNS0-Client-Subnet (ECS) is supported and what the provided subnet is.
Also we can find out the IP address of the DNS Resolver for each probe as seen by the Authoritative Nameserver. This information is especially of interest for the case where the DNS Resolver does not support EDNS0-Client-Subnet (ECS).</p>

<h1 id="test-results">Test Results</h1>
<h2 id="overview">Overview</h2>
<p>With some Python code the gathered results can easily be turned into a <a href="http://geojson.org/" target="_blank" rel="noopener noreferrer">GeoJSON</a> file (See Figure 3).</p>

<figure class="">








<a href="/content/uploads/2019/02/RIPE-Atlas-US-Probes.png" title="Figure 3: Mapping of RIPE Atlas probes to Origins " class="image-popup">
<picture>
  <source width="1223" type="image/webp" data-srcset="

    
    /content/resized/2019/02/RIPE-Atlas-US-Probes-320.webp 320w, 

    
    /content/resized/2019/02/RIPE-Atlas-US-Probes-384.webp 384w, 

    
    /content/resized/2019/02/RIPE-Atlas-US-Probes-512.webp 512w, 

    
    /content/resized/2019/02/RIPE-Atlas-US-Probes-683.webp 683w, 

    
    /content/resized/2019/02/RIPE-Atlas-US-Probes-800.webp 800w, 

    
    /content/resized/2019/02/RIPE-Atlas-US-Probes-960.webp 960w, 

 /content/uploads/2019/02/RIPE-Atlas-US-Probes.webp 1223w" sizes="1223px"></source>
  <source width="1223" data-srcset="

    /content/resized/2019/02/RIPE-Atlas-US-Probes-320.png 320w, 

    /content/resized/2019/02/RIPE-Atlas-US-Probes-384.png 384w, 

    /content/resized/2019/02/RIPE-Atlas-US-Probes-512.png 512w, 

    /content/resized/2019/02/RIPE-Atlas-US-Probes-683.png 683w, 

    /content/resized/2019/02/RIPE-Atlas-US-Probes-800.png 800w, 

    /content/resized/2019/02/RIPE-Atlas-US-Probes-960.png 960w, 

 /content/uploads/2019/02/RIPE-Atlas-US-Probes.png 1223w" sizes="1223px"></source>
  <img src="//:0" data-src="/content/uploads/2019/02/RIPE-Atlas-US-Probes.png" class="blur-up lazyautosizes lazyload" alt="Figure 3: Mapping of RIPE Atlas probes to Origins ">
</picture>
</a>



  <figcaption>Figure 3: Mapping of RIPE Atlas probes to Origins
</figcaption>

</figure>

<p>The location of each RIPE Atlas probe as reported by the probe’s host is leveraged in this visualization. The pin representing the location is colored in depending on the result for the Route 53 geographic routing test:</p>

<ul>
  <li>
<strong>Red pin:</strong> Represents a response by Route 53 of “US-West-2” and would therefore route traffic from this probe to the AWS US-West-2 (Oregon) region. In this setup this represents 29% of the probes.</li>
  <li>
<strong>Blue pin:</strong> Represents a response by Route 53 of “US-East-2” and would therefore route traffic from this probe to the AWS US-East-2 (Ohio) region. Here this represents 59% of the probes.</li>
  <li>
<strong>Green pin:</strong> Represents a response by Route 53 of “Unknown”. While traffic from this probe would also be routed to the AWS US-East-2 (Ohio) region, this is effectively due to Route 53 not being able to locate the probe beyond “somewhere in the US”. For this setup 12% of the probes could therefore not be located.</li>
</ul>

<p>We can see that most of the US-East coast based probes would correctly route to the US-East coast origin (depicted in blue) and most of the US-West coast probes would also correctly route to the US-West coast origin (depicted in red). But we do see a few blue pins on the US-West coast, meaning that the corresponding probe would be routed to the US-East coast instead of the closer US-West coast. Similarly we also see a few red pins on the US-East coast. This clearly shows some non-optimal routing behavior. Later on we will look in more detail into the reasons for this behavior.</p>

<h2 id="probe-details">Probe Details</h2>
<p>The way that I’ve setup the GeoJSON is to also display relevant information for each of the RIPE Atlas Probes (Figure 4).</p>

<figure class="">








<a href="/content/uploads/2019/02/RIPE-Atlas-Probe.png" title="Figure 4: Detail view of RIPE Atlas probe results " class="image-popup">
<picture>
  <source width="983" type="image/webp" data-srcset="

    
    /content/resized/2019/02/RIPE-Atlas-Probe-320.webp 320w, 

    
    /content/resized/2019/02/RIPE-Atlas-Probe-384.webp 384w, 

    
    /content/resized/2019/02/RIPE-Atlas-Probe-512.webp 512w, 

    
    /content/resized/2019/02/RIPE-Atlas-Probe-683.webp 683w, 

    
    /content/resized/2019/02/RIPE-Atlas-Probe-800.webp 800w, 

    
    /content/resized/2019/02/RIPE-Atlas-Probe-960.webp 960w, 

 /content/uploads/2019/02/RIPE-Atlas-Probe.webp 983w" sizes="983px"></source>
  <source width="983" data-srcset="

    /content/resized/2019/02/RIPE-Atlas-Probe-320.png 320w, 

    /content/resized/2019/02/RIPE-Atlas-Probe-384.png 384w, 

    /content/resized/2019/02/RIPE-Atlas-Probe-512.png 512w, 

    /content/resized/2019/02/RIPE-Atlas-Probe-683.png 683w, 

    /content/resized/2019/02/RIPE-Atlas-Probe-800.png 800w, 

    /content/resized/2019/02/RIPE-Atlas-Probe-960.png 960w, 

 /content/uploads/2019/02/RIPE-Atlas-Probe.png 983w" sizes="983px"></source>
  <img src="//:0" data-src="/content/uploads/2019/02/RIPE-Atlas-Probe.png" class="blur-up lazyautosizes lazyload" alt="Figure 4: Detail view of RIPE Atlas probe results ">
</picture>
</a>



  <figcaption>Figure 4: Detail view of RIPE Atlas probe results
</figcaption>

</figure>

<p>After clicking on one of the pins you’re able to see:</p>

<ul>
  <li>
<strong>Atlas-ID:</strong> The RIPE Atlas ID of the probe linked to RIPE ATLAS API’s “Probe Detail” view.</li>
  <li>
<strong>Resolver:</strong> IPv4 or IPv6 address of the DNS Resolver for the probe as seen by an Authoritative Nameserver.</li>
  <li>
<strong>Client Subnet:</strong> EDNS0-Client-Subnet (ECS) provided client subnet if supported by the probe’s resolver.</li>
  <li>
<strong>Origin:</strong> Result of the DNS lookup against the Amazon Route 53 test entry. This will either be “US-West-2”, “US-East-2”, or “Unknown” and corresponds to the color of the pin.</li>
</ul>

<h2 id="explore-the-geojson">Explore the GeoJSON</h2>

<p>You can explore this GeoJSON yourself below, as it is published as a <a href="https://gist.github.com/chriselsen/ff5d0d535781e61d879ff154e785259a" target="_blank" rel="noopener noreferrer">Gist to Github</a>.</p>

<script src="https://gist.github.com/chriselsen/ff5d0d535781e61d879ff154e785259a.js"></script>

<p>Give it a try and see what you’ll discover!</p>

<h2 id="the-good-bad-and-ugly">The good, bad and ugly</h2>

<p>Let’s drill down on four RIPE Atlas probes to explore how geographic routing works and what the limitations are (See Figure 5).</p>

<figure class="">








<a href="/content/uploads/2019/02/RIPE-Atlas-Details.png" title="Figure 5: Zoom into subset of RIPE Atlas probe results " class="image-popup">
<picture>
  <source width="1220" type="image/webp" data-srcset="

    
    /content/resized/2019/02/RIPE-Atlas-Details-320.webp 320w, 

    
    /content/resized/2019/02/RIPE-Atlas-Details-384.webp 384w, 

    
    /content/resized/2019/02/RIPE-Atlas-Details-512.webp 512w, 

    
    /content/resized/2019/02/RIPE-Atlas-Details-683.webp 683w, 

    
    /content/resized/2019/02/RIPE-Atlas-Details-800.webp 800w, 

    
    /content/resized/2019/02/RIPE-Atlas-Details-960.webp 960w, 

 /content/uploads/2019/02/RIPE-Atlas-Details.webp 1220w" sizes="1220px"></source>
  <source width="1220" data-srcset="

    /content/resized/2019/02/RIPE-Atlas-Details-320.png 320w, 

    /content/resized/2019/02/RIPE-Atlas-Details-384.png 384w, 

    /content/resized/2019/02/RIPE-Atlas-Details-512.png 512w, 

    /content/resized/2019/02/RIPE-Atlas-Details-683.png 683w, 

    /content/resized/2019/02/RIPE-Atlas-Details-800.png 800w, 

    /content/resized/2019/02/RIPE-Atlas-Details-960.png 960w, 

 /content/uploads/2019/02/RIPE-Atlas-Details.png 1220w" sizes="1220px"></source>
  <img src="//:0" data-src="/content/uploads/2019/02/RIPE-Atlas-Details.png" class="blur-up lazyautosizes lazyload" alt="Figure 5: Zoom into subset of RIPE Atlas probe results ">
</picture>
</a>



  <figcaption>Figure 5: Zoom into subset of RIPE Atlas probe results
</figcaption>

</figure>

<p>These probes are all located in the San Diego, CA area and should therefore be routed to the US-West-2 location, represented by a red pin on the map. This location and the resulting probes were selected as they represent typical cases observed with geographic routing.</p>

<p>We will be using Maxmind’s <a href="https://www.maxmind.com/en/geoip-demo" target="_blank" rel="noopener noreferrer">GeoIP2 City Database Demo</a> to lookup GeoIP data associated with the IPv4 and IPv6 addresses that are discovered for these probes as part of this test.</p>

<ul>
  <li>
    <p><strong>Location 1:</strong> This probe is <em>correctly</em> routed to the US-West-2 origin. The DNS Resolver IPv4 address for this probe is located in <em>The Dalles, Oregon</em> and also resides on Google’s <a href="https://en.wikipedia.org/wiki/Autonomous_system_(Internet)" target="_blank" rel="noopener noreferrer">Autonomous System Number (ASN)</a>. It therefore appears to be one of Google’s Public DNS Resolver nodes. Further we can see that for this RIPE Atlas probe the client subnet is provided. Using Maxmind the corresponding IPv4 address can be mapped to the location <em>Coronado, California</em> and the ISP to <em>Cox</em>.
This location is therefore an excellent example for how the EDNS0-Client-Subnet (ECS) improves the end-user experience, while using a DNS resolver that is physically located far away from the actual customer location.</p>
  </li>
  <li>
    <p><strong>Location 2:</strong> This probe is also <em>correctly</em> routed to the US-West-2 origin. Based on Maxmind data the DNS Resolver IPv4 address is located in <em>Palo Alto, California</em> and with the ISP <em>WoodyNet</em>. In this case the DNS Resolver does not support EDNS0-Client-Subnet (ECS) and therefore Amazon Route 53 is forced to make a routing decision solely based on the DNS Resolver location information. Despite the geographic distance of a few hundred miles between client and DNS resolver, the DNS geographic routing is nevertheless correct here.</p>
  </li>
  <li>
    <p><strong>Location 3:</strong> This probe is <em>incorrectly routed</em> to the US-East-2 origin and therefore provides the end-user a reduced experience. The DNS Resolver’s IPv4 address is located in <em>Saint Paul, Minnesota</em> belonging to the ASN for <em>Bethel University</em>. The question why this probe would use a DNS Resolver from this organization and in this location is probably answered by looking at the RIPE Atlas probe’s name of <em>Bethel Seminary</em>. This name correlation lets us assume that there is a relation between the two. As with location 2, this DNS Resolver also does not support EDNS0-Client-Subnet (ECS). But in contrary to location 2, here the geographic distance between client and DNS Resolver is a few thousand miles. In this case Amazon Route 53 is also forced to make a routing decision solely based on the DNS Resolver location in Saint Paul, Minnesota. Therefore this probe is routed across the country to the Ohio origin instead of the more efficient Oregon origin.
With DNS geographic routing based CDNs - like AWS CloudFront - the end-user experience is even more degradeded. Instead of leveraging a CDN Edge location in Los Angeles - less than 150 miles away - a CDN Edge location in Minneapolis, MN - more than 1,500 miles away - is being used. This added distance will lead to higher latency and <a href="/2013/06/07/measuring-network-throughput/">lower throughput</a>.</p>
  </li>
  <li>
    <p><strong>Location 4:</strong> This last location - at the University of California, San Diego (UCSD) - <em>cannot be identified</em> by AWS Route 53 and is therefore <em>routed incorrectly</em> to the US-East-2 (Ohio) location instead of the closer US-West-2 (Oregon) location. Looking at the GeoIP information for the DNS Resolver’s IPv6 address we can see that Maxmind is indeed not able to locate this IP address beyond being somewhere in the US. Furthermore we can see that this DNS Resolver also does not support EDNS0-Client-Subnet (ECS). Looking at the RIPE Atlas probe’s actual IPv6 address, Maxmind is not able to locate this either. Therefore EDNS0-Client-Subnet (ECS) would not have provided any benefits here. Only the probe’s IPv4 address can be located correctly by Maxmind to be in San Diego, CA.This probe is an excellent example for Route 53 placing US-based clients or DNS Resolvers at the above mentioned Cheney reservoir location. And due to Cheney reservoir falling within the area that is closer to the US-East-2 (Ohio) origin, traffic is routed there.</p>
  </li>
</ul>

<h1 id="summary">Summary</h1>

<p>This article provided a closer look at how DNS geographic routing - such as provided by AWS Route 53, but also leveraged by numerous CDNs - works. Using AWS Route 53 and RIPE Atlas we were able to visualize the real life results of a geographic routing DNS setup and dive deeper into some of the wanted and unwanted effects. A question that will need to remain to be explored in an upcoming post, is how these results compare to an <a href="https://en.wikipedia.org/wiki/Anycast" target="_blank" rel="noopener noreferrer">Anycast</a> based routing approach for the same set of Origins, leveraging e.g. the <a href="https://aws.amazon.com/blogs/aws/new-aws-global-accelerator-for-availability-and-performance/" target="_blank" rel="noopener noreferrer">AWS Global Accelerator</a>.</p>

        
      </section>

      <footer class="page__meta">
        
        
  


  
  
  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-tags" aria-hidden="true"></i> Tags: </strong>
    <span itemprop="keywords">
    
      
      
      <a href="/tags/#aws" class="page__taxonomy-item" rel="tag">AWS</a><span class="sep">, </span>
    
      
      
      <a href="/tags/#dns" class="page__taxonomy-item" rel="tag">DNS</a><span class="sep">, </span>
    
      
      
      <a href="/tags/#network" class="page__taxonomy-item" rel="tag">Network</a>
    
    </span>
  </p>




        
          <p class="page__date"><strong><i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> Updated:</strong> <time datetime="2019-03-01T00:00:00-08:00">March 01, 2019</time></p>
        
      </footer>

      <section class="page__share">
  
    <h4 class="page__share-title">Share on</h4>
  

  <a href="https://twitter.com/intent/tweet?via=ChristianElsen&amp;text=Limitations+of+DNS-based+geographic+routing%20https%3A%2F%2Fwww.edge-cloud.net%2F2019%2F03%2F01%2Flimitations-of-geo-dns%2F" class="btn share-button btn--twitter" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Twitter" target="_blank" rel="noopener noreferrer"><i class="fab fa-fw fa-twitter" aria-hidden="true"></i><span> Twitter</span></a>

  <a href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fwww.edge-cloud.net%2F2019%2F03%2F01%2Flimitations-of-geo-dns%2F" class="btn share-button btn--facebook" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Facebook" target="_blank" rel="noopener noreferrer"><i class="fab fa-fw fa-facebook" aria-hidden="true"></i><span> Facebook</span></a>

  <a href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3A%2F%2Fwww.edge-cloud.net%2F2019%2F03%2F01%2Flimitations-of-geo-dns%2F" class="btn share-button btn--linkedin" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on LinkedIn" target="_blank" rel="noopener noreferrer"><i class="fab fa-fw fa-linkedin" aria-hidden="true"></i><span> LinkedIn</span></a>
  
  <a href="https://getpocket.com/save?url=https%3A%2F%2Fwww.edge-cloud.net%2F2019%2F03%2F01%2Flimitations-of-geo-dns%2F&amp;title=Limitations+of+DNS-based+geographic+routing" class="btn share-button btn--pocket" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Pocket" target="_blank" rel="noopener noreferrer"><i class="fab fa-fw fa-get-pocket" aria-hidden="true"></i><span> Pocket</span></a>
</section>


      
  <nav class="pagination">
    
      <a href="/2019/02/13/how-att-broke-my-ipv6/" class="pagination--pager" title="How AT&amp;T broke my IPv6 Internet connection
">Previous</a>
    
    
      <a href="/2019/04/08/limitations-of-anycast/" class="pagination--pager" title="Limitations of Anycast for distributed content delivery
">Next</a>
    
  </nav>

    </div>

    
  </article>

  
  
    <div class="page__related">
      <h4 class="page__related-title">You may also enjoy</h4>
      <div class="grid__wrapper">
        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="/2020/05/01/tgw-multicast-intro/" rel="permalink">Multicast with AWS Transit Gateway
</a>
      
    </h2>
    
    <p class="archive__item-excerpt" itemprop="description">Walkthrough for setup and testing IP Multicast with AWS Transit Gateway (TGW)
</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="/2020/04/19/drawing-monitor-for-network-diagrams/" rel="permalink">Drawing monitor for network diagrams
</a>
      
    </h2>
    
    <p class="archive__item-excerpt" itemprop="description">Home office setup with Huion Kamvas Pro 12 drawing monitor for network diagrams
</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="/2019/12/27/aws-dx-connect-on-premises/" rel="permalink">Enabling connectivity between on-premises locations connected to AWS through Direct Connect
</a>
      
    </h2>
    
    <p class="archive__item-excerpt" itemprop="description">Caveats for data flow between multiple on-premises locations, when using AWS with Direct Connect and Transit Gateway
</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="/2019/12/09/block-countries-with-route53/" rel="permalink">Block access from certain countries with Route 53 Geolocation
</a>
      
    </h2>
    
    <p class="archive__item-excerpt" itemprop="description">Use Amazon Route 53 Geolocation Routing to block access to services from certain countries. Leverage RIPE Atlas to validate the setup.
</p>
  </article>
</div>

        
      </div>
    </div>
  
  
  
  
  
</div>






    </div>

    
      <div class="search-content">
        <div class="search-content__inner-wrap">
<script src="https://cdn.jsdelivr.net/npm/instantsearch.js@2.3.3/dist/instantsearch.min.js"></script>
    <div class="search-searchbar"></div>
    <div class="search-hits"></div>
</div>

      </div>
    
    
    <div class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->

        <div align="center" class="page__footer-follow">
  <ul class="social-icons">
    
      <li><strong>Follow:</strong></li>
    

    
      
        
          <li><a href="http://twitter.com/ChristianElsen" rel="noopener noreferrer" target="_blank"><i class="fab fa-fw fa-twitter-square" aria-hidden="true"></i> Twitter</a></li>
        
      
        
          <li><a href="https://www.linkedin.com/in/christianelsen/" rel="noopener noreferrer" target="_blank"><i class="fab fa-fw fa-linkedin" aria-hidden="true"></i> LinkedIn</a></li>
        
      
        
          <li><a href="https://github.com/chriselsen/" rel="noopener noreferrer" target="_blank"><i class="fab fa-fw fa-github" aria-hidden="true"></i> Github</a></li>
        
      
    

    <li><a href="/feed.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
  </ul>
</div>

<div align="center" class="page__footer-copyright">© 2013 - 2020 Christian Elsen. <a href="/terms/">Terms &amp; Privacy Policy</a>.</div>

      </footer>
    </div>

    
  <script src="/assets/js/main.min.js"></script>
  <script src="/assets/js/lazysizes.min.js"></script>

  <script defer src="https://use.fontawesome.com/releases/v5.6.0/js/all.js" integrity="sha384-z9ZOvGHHo21RqN5De4rfJMoAxYpaVoiYhuJXPyVmSs8yn20IE3PmBM534CffwSJI" crossorigin="anonymous"></script>





<!-- Including InstantSearch.js library and styling -->
<script async src="https://cdn.jsdelivr.net/npm/instantsearch.js@2.3.3/dist/instantsearch.min.js"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.3.3/dist/instantsearch.min.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.3.3/dist/instantsearch-theme-algolia.min.css">

<script>
// Instanciating InstantSearch.js with Algolia credentials
const search = instantsearch({
  appId: '5XVQIGEDJ8',
  apiKey: '4e0733cbaacd194a6cf59b61024f966f',
  indexName: 'edge-cloud-net',
  searchParameters: {
    restrictSearchableAttributes: [
      'title',
      'content'
    ]
  }
});

const hitTemplate = function(hit) {
  const url = hit.url;
  const title = hit._highlightResult.title.value;
  const content = hit._highlightResult.html.value;

  return `
    <div class="list__item">
      <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
        <h2 class="archive__item-title" itemprop="headline"><a href="${url}">${title}</a></h2>
        <div class="archive__item-excerpt" itemprop="description">${content}</div>
      </article>
    </div>
  `;
}

// Adding searchbar and results widgets
search.addWidget(
  instantsearch.widgets.searchBox({
    container: '.search-searchbar',
    poweredBy: true,
    placeholder: 'Enter your search term...'
  })
);
search.addWidget(
  instantsearch.widgets.hits({
    container: '.search-hits',
    templates: {
      item: hitTemplate
    }
  })
);

// Starting the search
search.start();
</script>





    <script>
  'use strict';

  (function() {
    var commentContainer = document.querySelector('#utterances-comments');

    if (!commentContainer) {
      return;
    }

    var script = document.createElement('script');
    script.setAttribute('src', 'https://utteranc.es/client.js');
    script.setAttribute('repo', 'edge-cloud/www.edge-cloud.net');
    script.setAttribute('issue-term', 'pathname');
    script.setAttribute('theme', 'github-light');
    script.setAttribute('crossorigin', 'anonymous');

    commentContainer.appendChild(script);
  })();
</script>

  



  </body>
</html>
